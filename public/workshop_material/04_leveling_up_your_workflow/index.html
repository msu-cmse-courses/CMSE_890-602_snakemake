
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="NeSI" name="author"/>
<link href="https://nesi.github.io/snakemake_workshop/workshop_material/04_leveling_up_your_workflow/" rel="canonical"/>
<link href="../03_create_a_basic_workflow/" rel="prev"/>
<link href="../05_we_want_more/" rel="next"/>
<link href="../../theme_images_nesi_logo.png" rel="icon"/>
<meta content="mkdocs-1.4.3, mkdocs-material-9.1.15" name="generator"/>
<title>04 - Leveling up your workflow! - Automate Your Workflow With Snakemake</title>
<link href="../../assets/stylesheets/main.26e3688c.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.ecc896b0.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Mukta:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Mukta";--md-code-font:"Fira Code"}</style>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="custom" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#04-leveling-up-your-workflow">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Automate Your Workflow With Snakemake" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Automate Your Workflow With Snakemake">
<img alt="logo" src="../../theme_images/nesi_logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Automate Your Workflow With Snakemake
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              04 - Leveling up your workflow!
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="custom" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_3" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="custom" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to system preference" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="custom" data-md-color-scheme="slate" id="__palette_3" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to system preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/nesi/snakemake_workshop" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    nesi/snakemake_workshop
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Automate Your Workflow With Snakemake" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Automate Your Workflow With Snakemake">
<img alt="logo" src="../../theme_images/nesi_logo.png"/>
</a>
    Automate Your Workflow With Snakemake
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/nesi/snakemake_workshop" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    nesi/snakemake_workshop
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Online workflow code-along: Introduction to Snakemake
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Workshop material
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Workshop material
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../01_introduction/">
        01 - Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_setup/">
        02 - Setup
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03_create_a_basic_workflow/">
        03 - Create a basic workflow
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          04 - Leveling up your workflow!
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        04 - Leveling up your workflow!
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#catching-up">
    Catching up
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#41-use-a-profile-for-hpc">
    4.1 Use a profile for HPC
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-pull-out-parameters">
    4.2 Pull out parameters
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#43-pull-out-user-configurable-options">
    4.3 Pull out user configurable options
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#44-leave-messages-for-the-user">
    4.4 Leave messages for the user
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#45-create-temporary-files">
    4.5 Create temporary files
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#46-generating-a-snakemake-report">
    4.6 Generating a snakemake report
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#47-linting-your-workflow">
    4.7 Linting your workflow
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05_we_want_more/">
        05 - We want more!
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../99_appendix_setup_on_your_machine/">
        Appendix - Setup on your machine using conda
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../99_appendix_use_conda_environments/">
        Appendix - Use conda environments
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#catching-up">
    Catching up
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#41-use-a-profile-for-hpc">
    4.1 Use a profile for HPC
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-pull-out-parameters">
    4.2 Pull out parameters
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#43-pull-out-user-configurable-options">
    4.3 Pull out user configurable options
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#44-leave-messages-for-the-user">
    4.4 Leave messages for the user
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#45-create-temporary-files">
    4.5 Create temporary files
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#46-generating-a-snakemake-report">
    4.6 Generating a snakemake report
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#47-linting-your-workflow">
    4.7 Linting your workflow
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="04-leveling-up-your-workflow">04 - Leveling up your workflow!<a class="headerlink" href="#04-leveling-up-your-workflow" title="Permanent link">¶</a></h1>
<p style="text-align:left;">
<b><a class="btn" href="https://nesi.github.io/snakemake_workshop/workshop_material/03_create_a_basic_workflow.html" style="background: var(--bs-green);font-weight:bold">« 3 - Creating a Basic WF</a></b>
<span style="float:right;">
<b><a class="btn" href="https://nesi.github.io/snakemake_workshop/workshop_material/05_we_want_more.html" style="background: var(--bs-green);font-weight:bold">5 - More »</a></b>
</span>
</p>
<ul>
<li toc="toc">Do not remove this line (it will not be displayed)</li>
</ul>
<h2 id="catching-up">Catching up<a class="headerlink" href="#catching-up" title="Permanent link">¶</a></h2>
<p>From section 03, you should have the following Snakefile:</p>
<p>{% capture e4dot1 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># define samples from data directory using wildcards</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">"../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz"</span><span class="p">)</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="nb">input</span><span class="p">:</span>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>        <span class="s2">"../results/multiqc_report.html"</span><span class="p">,</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">"../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz"</span><span class="p">,</span> <span class="s2">"../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz"</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="c1"># workflow</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="nb">input</span><span class="p">:</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">"../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz"</span><span class="p">,</span>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">"../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz"</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="n">output</span><span class="p">:</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html"</span><span class="p">,</span> <span class="s2">"../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html"</span><span class="p">],</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip"</span><span class="p">,</span> <span class="s2">"../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip"</span><span class="p">]</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">log</span><span class="p">:</span>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a>        <span class="s2">"logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log"</span>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="s2">"FastQC/0.11.9"</span>
<a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">shell</span><span class="p">:</span>
<a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a>        <span class="s2">"fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">"</span>
<a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="nb">input</span><span class="p">:</span>
<a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">"../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip"</span><span class="p">,</span> <span class="s2">"../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip"</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">output</span><span class="p">:</span>
<a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="s2">"../results/multiqc_report.html"</span>
<a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">log</span><span class="p">:</span>
<a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="s2">"logs/multiqc/multiqc.log"</span>
<a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="s2">"MultiQC/1.9-gimkl-2020a-Python-3.8.2"</span>
<a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">shell</span><span class="p">:</span>
<a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="s2">"multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ &amp;&gt; </span><span class="si">{log}</span><span class="s2">"</span>
<a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a href="#__codelineno-0-38" id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a href="#__codelineno-0-39" id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="nb">input</span><span class="p">:</span>
<a href="#__codelineno-0-40" id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="p">[</span><span class="s2">"../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz"</span><span class="p">,</span> <span class="s2">"../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz"</span><span class="p">]</span>
<a href="#__codelineno-0-41" id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="n">output</span><span class="p">:</span>
<a href="#__codelineno-0-42" id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="p">[</span><span class="s2">"../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz"</span><span class="p">,</span> <span class="s2">"../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz"</span><span class="p">]</span>
<a href="#__codelineno-0-43" id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="n">log</span><span class="p">:</span>
<a href="#__codelineno-0-44" id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="s2">"logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log"</span>
<a href="#__codelineno-0-45" id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="n">envmodules</span><span class="p">:</span>
<a href="#__codelineno-0-46" id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="s2">"TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"</span>
<a href="#__codelineno-0-47" id="__codelineno-0-47" name="__codelineno-0-47"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a href="#__codelineno-0-48" id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="n">shell</span><span class="p">:</span>
<a href="#__codelineno-0-49" id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="s2">"trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ --paired --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">"</span>
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot1" content=e4dot1%}
<br/></p>
<h2 id="41-use-a-profile-for-hpc">4.1 Use a profile for HPC<a class="headerlink" href="#41-use-a-profile-for-hpc" title="Permanent link">¶</a></h2>
<p>In section 3.16, we have seen that a snakemake workflow can be run on an HPC cluster.
To reduce the boilerplate, we can use a <a href="https://snakemake.readthedocs.io/en/stable/executing/cli.html#profiles">configuration profile</a> to configure default options.
In this case, we use it to set the <code>--cluster</code> and the <code>--jobs</code> options.</p>
<p>Make a <code>slurm</code> profile folder</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># create the profile folder</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>mkdir<span class="w"> </span>slurm
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>touch<span class="w"> </span>slurm/config.yaml
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="c1"># write the following to config.yaml</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>jobs:<span class="w"> </span><span class="m">20</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>cluster:<span class="w"> </span><span class="s2">"sbatch --time 00:10:00 --mem 512MB --cpus-per-task 8 --account nesi99991"</span>
</code></pre></div>
<p>Then run the snakemake workflow using the <code>slurm</code> profile</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="c1"># run dryrun/run again</span>
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>snakemake<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div>
<p>If you interrupt the execution of a snakemake workflow using CTRL-C, already submitted Slurm jobs won't be cancelled.
We tell snakemake how to cancel Slurm jobs using <code>scancel</code> via the <code>--cluster-cancel</code> option and adding <code>--parsable</code> to the <code>sbatch</code> command, to make it return the job ID.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>jobs: 20
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="gd">- cluster: "sbatch --time 00:10:00 --mem 512MB --cpus-per-task 8"</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="gi">+ cluster: "sbatch --parsable --time 00:10:00 --mem 512MB --cpus-per-task 8"</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="gi">+ cluster-cancel: scancel</span>
</code></pre></div>
<p>You can specify different resources (memory, cpus, gpus, etc.) for each target in the workflow and refer to them in the <code>cluster</code> option using placeholders.
Default resources for all rules can also be set using the <code>default-resources</code> option.</p>
<p>Update the profile <code>slurm/config.yaml</code> file as follows (using a multiline option to improve readability)</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>jobs: 20
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="gd">- cluster: "sbatch --parsable --time 00:10:00 --mem 512MB --cpus-per-task 8"</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="gi">+ cluster:</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="gi">+     sbatch</span>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="gi">+         --parsable</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="gi">+         --time {resources.time_min}</span>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="gi">+         --mem {resources.mem_mb}</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="gi">+         --cpus-per-task {resources.cpus}</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="gi">+         --account nesi99991</span>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="gi">+ default-resources: [cpus=2, mem_mb=512, time_min=10]</span>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a>cluster-cancel: scancel
</code></pre></div>
<p>and add resources definitions in the workflow.
Here we give more CPU resources to <code>trim_galore</code> to make it run faster.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>rule all:
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w"> </span>   input:
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w"> </span>       "../results/multiqc_report.html",
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w"> </span>       expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a># workflow
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>rule fastqc:
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w"> </span>   input:
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w"> </span>   output:
<a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w"> </span>       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w"> </span>   log:
<a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-5-20" id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-5-21" id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-5-22" id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-5-23" id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w"> </span>   shell:
<a href="#__codelineno-5-24" id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-5-25" id="__codelineno-5-25" name="__codelineno-5-25"></a>
<a href="#__codelineno-5-26" id="__codelineno-5-26" name="__codelineno-5-26"></a>rule multiqc:
<a href="#__codelineno-5-27" id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w"> </span>   input:
<a href="#__codelineno-5-28" id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w"> </span>       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-5-29" id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="w"> </span>   output:
<a href="#__codelineno-5-30" id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-5-31" id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w"> </span>   log:
<a href="#__codelineno-5-32" id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="w"> </span>       "logs/multiqc/multiqc.log"
<a href="#__codelineno-5-33" id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-5-34" id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="w"> </span>       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-5-35" id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="w"> </span>   shell:
<a href="#__codelineno-5-36" id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="w"> </span>       "multiqc {input} -o ../results/ &amp;&gt; {log}"
<a href="#__codelineno-5-37" id="__codelineno-5-37" name="__codelineno-5-37"></a>
<a href="#__codelineno-5-38" id="__codelineno-5-38" name="__codelineno-5-38"></a>rule trim_galore:
<a href="#__codelineno-5-39" id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="w"> </span>   input:
<a href="#__codelineno-5-40" id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="w"> </span>       ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-5-41" id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="w"> </span>   output:
<a href="#__codelineno-5-42" id="__codelineno-5-42" name="__codelineno-5-42"></a><span class="w"> </span>       ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-5-43" id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="w"> </span>   log:
<a href="#__codelineno-5-44" id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="w"> </span>       "logs/trim_galore/{sample}.log"
<a href="#__codelineno-5-45" id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-5-46" id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="w"> </span>       "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-5-47" id="__codelineno-5-47" name="__codelineno-5-47"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-5-48" id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="gi">+   resources:</span>
<a href="#__codelineno-5-49" id="__codelineno-5-49" name="__codelineno-5-49"></a><span class="gi">+       cpus=8</span>
<a href="#__codelineno-5-50" id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="w"> </span>   shell:
<a href="#__codelineno-5-51" id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="w"> </span>       "trim_galore {input} -o ../results/trimmed/ --paired --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>Current slurm profile:</p>
<p>{% capture e4dot2 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>jobs: 20
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>cluster:
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>    sbatch
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>        --parsable
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>        --time {resources.time_min}
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>        --mem {resources.mem_mb}
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>        --cpus-per-task {resources.cpus}
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>        --account nesi99991
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>default-resources: [cpus=2, mem_mb=512, time_min=10]
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>cluster-cancel: scancel
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot2" content=e4dot2%}
<br/></p>
<p>Current snakefile:</p>
<p>{% capture e4dot3 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a>rule all:
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>    input:
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>        "../results/multiqc_report.html",
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>        expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a># workflow
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a>rule fastqc:
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a>    input:
<a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a>    output:
<a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a>    log:
<a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a>    threads: 2
<a href="#__codelineno-7-21" id="__codelineno-7-21" name="__codelineno-7-21"></a>    envmodules:
<a href="#__codelineno-7-22" id="__codelineno-7-22" name="__codelineno-7-22"></a>        "FastQC/0.11.9"
<a href="#__codelineno-7-23" id="__codelineno-7-23" name="__codelineno-7-23"></a>    shell:
<a href="#__codelineno-7-24" id="__codelineno-7-24" name="__codelineno-7-24"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-7-25" id="__codelineno-7-25" name="__codelineno-7-25"></a>
<a href="#__codelineno-7-26" id="__codelineno-7-26" name="__codelineno-7-26"></a>rule multiqc:
<a href="#__codelineno-7-27" id="__codelineno-7-27" name="__codelineno-7-27"></a>    input:
<a href="#__codelineno-7-28" id="__codelineno-7-28" name="__codelineno-7-28"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-7-29" id="__codelineno-7-29" name="__codelineno-7-29"></a>    output:
<a href="#__codelineno-7-30" id="__codelineno-7-30" name="__codelineno-7-30"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-7-31" id="__codelineno-7-31" name="__codelineno-7-31"></a>    log:
<a href="#__codelineno-7-32" id="__codelineno-7-32" name="__codelineno-7-32"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-7-33" id="__codelineno-7-33" name="__codelineno-7-33"></a>    envmodules:
<a href="#__codelineno-7-34" id="__codelineno-7-34" name="__codelineno-7-34"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-7-35" id="__codelineno-7-35" name="__codelineno-7-35"></a>    shell:
<a href="#__codelineno-7-36" id="__codelineno-7-36" name="__codelineno-7-36"></a>        "multiqc {input} -o ../results/ &amp;&gt; {log}"
<a href="#__codelineno-7-37" id="__codelineno-7-37" name="__codelineno-7-37"></a>
<a href="#__codelineno-7-38" id="__codelineno-7-38" name="__codelineno-7-38"></a>rule trim_galore:
<a href="#__codelineno-7-39" id="__codelineno-7-39" name="__codelineno-7-39"></a>    input:
<a href="#__codelineno-7-40" id="__codelineno-7-40" name="__codelineno-7-40"></a>        ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-7-41" id="__codelineno-7-41" name="__codelineno-7-41"></a>    output:
<a href="#__codelineno-7-42" id="__codelineno-7-42" name="__codelineno-7-42"></a>        ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-7-43" id="__codelineno-7-43" name="__codelineno-7-43"></a>    log:
<a href="#__codelineno-7-44" id="__codelineno-7-44" name="__codelineno-7-44"></a>        "logs/trim_galore/{sample}.log"
<a href="#__codelineno-7-45" id="__codelineno-7-45" name="__codelineno-7-45"></a>    envmodules:
<a href="#__codelineno-7-46" id="__codelineno-7-46" name="__codelineno-7-46"></a>        "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-7-47" id="__codelineno-7-47" name="__codelineno-7-47"></a>    threads: 2
<a href="#__codelineno-7-48" id="__codelineno-7-48" name="__codelineno-7-48"></a>    resources:
<a href="#__codelineno-7-49" id="__codelineno-7-49" name="__codelineno-7-49"></a>        cpus=8
<a href="#__codelineno-7-50" id="__codelineno-7-50" name="__codelineno-7-50"></a>    shell:
<a href="#__codelineno-7-51" id="__codelineno-7-51" name="__codelineno-7-51"></a>        "trim_galore {input} -o ../results/trimmed/ --paired --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot3" content=e4dot3%}
<br/></p>
<p>Run the workflow again</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="c1"># run dryrun/run again</span>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>snakemake<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div>
<p>If you monitor the progress of your jobs using <code>squeue</code>, you will notice that some jobs now request 2 or 8 CPUs.</p>
<p>My output:</p>
<p>{% capture e4dot4 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>JOBID         USER     ACCOUNT   NAME        CPUS MIN_MEM PARTITI START_TIME     TIME_LEFT STATE    NODELIST(REASON)
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>26763281      lkemp    nesi99991 spawner-jupy   4      4G interac 2022-05-11T1     7:21:18 RUNNING  wbn003
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>26763492      lkemp    nesi99991 snakejob.fas   2    512M large   2022-05-11T1        9:59 RUNNING  wbn144
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>26763493      lkemp    nesi99991 snakejob.tri   8    512M large   2022-05-11T1        9:59 RUNNING  wbn212
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a>26763494      lkemp    nesi99991 snakejob.fas   2    512M large   2022-05-11T1        9:59 RUNNING  wbn145
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>26763495      lkemp    nesi99991 snakejob.fas   2    512M large   2022-05-11T1        9:59 RUNNING  wbn146
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a>26763496      lkemp    nesi99991 snakejob.tri   8    512M large   2022-05-11T1        9:59 RUNNING  wbn217
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>26763497      lkemp    nesi99991 snakejob.tri   8    512M large   2022-05-11T1        9:59 RUNNING  wbn229
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot4" content=e4dot4%}
<br/></p>
<p>Now looking at the content of our workflow folder, it is getting cluttered with Slurm log files:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>ls<span class="w"> </span>-lh
</code></pre></div>
<p>My output:</p>
<p>{% capture e4dot5 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>total 1.8M
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>-rw-rw----+ 1 lkemp nesi99991 4.2K May 11 12:10 dag_1.png
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a>-rw-rw----+ 1 lkemp nesi99991 3.8K May 11 12:13 dag_2.png
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a>-rw-rw----+ 1 lkemp nesi99991  12K May 11 12:16 dag_3.png
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a>-rw-rw----+ 1 lkemp nesi99991  20K May 11 12:19 dag_4.png
<a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a>-rw-rw----+ 1 lkemp nesi99991  15K May 11 12:21 dag_5.png
<a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a>-rw-rw----+ 1 lkemp nesi99991  12K May 11 12:23 dag_6.png
<a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a>-rw-rw----+ 1 lkemp nesi99991  26K May 11 12:24 dag_7.png
<a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a>drwxrws---+ 5 lkemp nesi99991 4.0K May 11 12:25 logs
<a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a>-rw-rw----+ 1 lkemp nesi99991  11K May 11 12:24 rulegraph_1.png
<a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a>drwxrws---+ 3 lkemp nesi99991 4.0K May 11 12:34 slurm
<a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a>-rw-rw----+ 1 lkemp nesi99991  837 May 11 12:27 slurm-26763403.out
<a href="#__codelineno-11-13" id="__codelineno-11-13" name="__codelineno-11-13"></a>-rw-rw----+ 1 lkemp nesi99991  809 May 11 12:27 slurm-26763404.out
<a href="#__codelineno-11-14" id="__codelineno-11-14" name="__codelineno-11-14"></a>-rw-rw----+ 1 lkemp nesi99991  837 May 11 12:27 slurm-26763405.out
<a href="#__codelineno-11-15" id="__codelineno-11-15" name="__codelineno-11-15"></a>-rw-rw----+ 1 lkemp nesi99991  837 May 11 12:27 slurm-26763406.out
<a href="#__codelineno-11-16" id="__codelineno-11-16" name="__codelineno-11-16"></a>-rw-rw----+ 1 lkemp nesi99991  809 May 11 12:27 slurm-26763407.out
<a href="#__codelineno-11-17" id="__codelineno-11-17" name="__codelineno-11-17"></a>-rw-rw----+ 1 lkemp nesi99991  809 May 11 12:27 slurm-26763408.out
<a href="#__codelineno-11-18" id="__codelineno-11-18" name="__codelineno-11-18"></a>-rw-rw----+ 1 lkemp nesi99991  865 May 11 12:29 slurm-26763409.out
<a href="#__codelineno-11-19" id="__codelineno-11-19" name="__codelineno-11-19"></a>-rw-rw----+ 1 lkemp nesi99991  837 May 11 12:30 slurm-26763418.out
<a href="#__codelineno-11-20" id="__codelineno-11-20" name="__codelineno-11-20"></a>-rw-rw----+ 1 lkemp nesi99991  809 May 11 12:30 slurm-26763419.out
<a href="#__codelineno-11-21" id="__codelineno-11-21" name="__codelineno-11-21"></a>-rw-rw----+ 1 lkemp nesi99991  837 May 11 12:30 slurm-26763420.out
<a href="#__codelineno-11-22" id="__codelineno-11-22" name="__codelineno-11-22"></a>-rw-rw----+ 1 lkemp nesi99991  837 May 11 12:30 slurm-26763421.out
<a href="#__codelineno-11-23" id="__codelineno-11-23" name="__codelineno-11-23"></a>-rw-rw----+ 1 lkemp nesi99991  809 May 11 12:30 slurm-26763422.out
<a href="#__codelineno-11-24" id="__codelineno-11-24" name="__codelineno-11-24"></a>-rw-rw----+ 1 lkemp nesi99991  809 May 11 12:30 slurm-26763423.out
<a href="#__codelineno-11-25" id="__codelineno-11-25" name="__codelineno-11-25"></a>-rw-rw----+ 1 lkemp nesi99991  865 May 11 12:32 slurm-26763431.out
<a href="#__codelineno-11-26" id="__codelineno-11-26" name="__codelineno-11-26"></a>-rw-rw----+ 1 lkemp nesi99991  837 May 11 12:33 slurm-26763435.out
<a href="#__codelineno-11-27" id="__codelineno-11-27" name="__codelineno-11-27"></a>-rw-rw----+ 1 lkemp nesi99991  809 May 11 12:34 slurm-26763436.out
<a href="#__codelineno-11-28" id="__codelineno-11-28" name="__codelineno-11-28"></a>-rw-rw----+ 1 lkemp nesi99991  837 May 11 12:33 slurm-26763437.out
<a href="#__codelineno-11-29" id="__codelineno-11-29" name="__codelineno-11-29"></a>-rw-rw----+ 1 lkemp nesi99991  837 May 11 12:34 slurm-26763438.out
<a href="#__codelineno-11-30" id="__codelineno-11-30" name="__codelineno-11-30"></a>-rw-rw----+ 1 lkemp nesi99991  809 May 11 12:34 slurm-26763439.out
<a href="#__codelineno-11-31" id="__codelineno-11-31" name="__codelineno-11-31"></a>-rw-rw----+ 1 lkemp nesi99991  809 May 11 12:34 slurm-26763440.out
<a href="#__codelineno-11-32" id="__codelineno-11-32" name="__codelineno-11-32"></a>-rw-rw----+ 1 lkemp nesi99991  865 May 11 12:35 slurm-26763444.out
<a href="#__codelineno-11-33" id="__codelineno-11-33" name="__codelineno-11-33"></a>-rw-rw----+ 1 lkemp nesi99991  857 May 11 12:36 slurm-26763447.out
<a href="#__codelineno-11-34" id="__codelineno-11-34" name="__codelineno-11-34"></a>-rw-rw----+ 1 lkemp nesi99991  829 May 11 12:36 slurm-26763448.out
<a href="#__codelineno-11-35" id="__codelineno-11-35" name="__codelineno-11-35"></a>-rw-rw----+ 1 lkemp nesi99991  857 May 11 12:36 slurm-26763449.out
<a href="#__codelineno-11-36" id="__codelineno-11-36" name="__codelineno-11-36"></a>-rw-rw----+ 1 lkemp nesi99991  857 May 11 12:36 slurm-26763450.out
<a href="#__codelineno-11-37" id="__codelineno-11-37" name="__codelineno-11-37"></a>-rw-rw----+ 1 lkemp nesi99991  829 May 11 12:36 slurm-26763451.out
<a href="#__codelineno-11-38" id="__codelineno-11-38" name="__codelineno-11-38"></a>-rw-rw----+ 1 lkemp nesi99991  829 May 11 12:36 slurm-26763452.out
<a href="#__codelineno-11-39" id="__codelineno-11-39" name="__codelineno-11-39"></a>-rw-rw----+ 1 lkemp nesi99991  885 May 11 12:37 slurm-26763454.out
<a href="#__codelineno-11-40" id="__codelineno-11-40" name="__codelineno-11-40"></a>-rw-rw----+ 1 lkemp nesi99991 1.8K May 11 12:34 Snakefile
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot5" content=e4dot5%}
<br/></p>
<p>Let's clean this and create a dedicated folder <code>logs/slurm</code> for future log files:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># remove slurm log files</span>
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>rm<span class="w"> </span>*.out
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>
<a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="c1"># create a new folder for Slurm log files</span>
<a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a>mkdir<span class="w"> </span>logs/slurm
</code></pre></div>
<p>then instruct Slurm to save its log files in it, in the profile <code>slurm/config.yaml</code> file</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>jobs: 20
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>cluster:
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w"> </span>   sbatch
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w"> </span>       --parsable
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w"> </span>       --time {resources.time_min}
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w"> </span>       --mem {resources.mem_mb}
<a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w"> </span>       --cpus-per-task {resources.cpus}
<a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="gi">+       --output logs/slurm/slurm-%j-{rule}.out</span>
<a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w"> </span>       --account nesi99991
<a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a>default-resources: [cpus=2, mem_mb=512, time_min=10]
<a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a>cluster-cancel: scancel
</code></pre></div>
<p>Note that <code>logs/slurm/slurm-%j-{rule}.out</code> contains a placeholder <code>{rule}</code>, which will be replaced by the name of the rule during the execution of the workflow.</p>
<p>Finally, to improve the communication between Snakemake and Slurm, we meed an additional script translating Slurm job status for Snakemake.
The <code>--cluster-status</code> option is used to tell Snakemake which script to use.</p>
<p>Create an executable <code>status.py</code> file</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># create an empty file</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>touch<span class="w"> </span>status.py
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="c1"># make it executable</span>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a>chmod<span class="w"> </span>+x<span class="w"> </span>status.py
</code></pre></div>
<p>and copy the following content in it</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>#!/usr/bin/env python
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>import subprocess
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>import sys
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a>jobid = sys.argv[1]
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a>output = str(subprocess.check_output("sacct -j %s --format State --noheader | head -1 | awk '{print $1}'" % jobid, shell=True).strip())
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a>
<a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a>running_status=["PENDING", "CONFIGURING", "COMPLETING", "RUNNING", "SUSPENDED"]
<a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a>if "COMPLETED" in output:
<a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a>    print("success")
<a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a>elif any(r in output for r in running_status):
<a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a>    print("running")
<a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a>else:
<a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a>    print("failed")
</code></pre></div>
<p>Then modify the profile <code>slurm/config.yaml</code> file</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>jobs: 20
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>cluster:
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w"> </span>   sbatch
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w"> </span>       --parsable
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w"> </span>       --time {resources.time_min}
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w"> </span>       --mem {resources.mem_mb}
<a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w"> </span>       --cpus-per-task {resources.cpus}
<a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w"> </span>       --output logs/slurm/slurm-%j-{rule}.out
<a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w"> </span>       --account nesi99991
<a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a>default-resources: [cpus=2, mem_mb=512, time_min=10]
<a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a>cluster-cancel: scancel
<a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="gi">+ cluster-status: ./status.py</span>
</code></pre></div>
<p>Current slurm profile:</p>
<p>{% capture e4dot6 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a>jobs: 20
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>cluster:
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>    sbatch
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>        --parsable
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>        --time {resources.time_min}
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>        --mem {resources.mem_mb}
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>        --cpus-per-task {resources.cpus}
<a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>        --output logs/slurm/slurm-%j-{rule}.out
<a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>        --account nesi99991
<a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a>default-resources: [cpus=2, mem_mb=512, time_min=10]
<a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>cluster-cancel: scancel
<a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a>cluster-status: ./status.py
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot6" content=e4dot6%}
<br/></p>
<p>Once all of this is in place, we can:</p>
<ul>
<li>submit Slurm jobs with the right resources per Snakemake rule,</li>
<li>cancel the workflow and Slurms jobs using CTRL-C,</li>
<li>keep all slurm jobs log files in a dedicated folder,</li>
<li>and make sure Snakemake reports Slurm jobs failures.</li>
</ul>
<blockquote>
<p><strong>Exercise:</strong></p>
<p>Run the snakemake workflow with Slurm jobs then use <code>scancel JOBID</code> to cancel some Slurm. See how Snakemake reacts with and without the <code>status.py</code> script.</p>
</blockquote>
<h2 id="42-pull-out-parameters">4.2 Pull out parameters<a class="headerlink" href="#42-pull-out-parameters" title="Permanent link">¶</a></h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a>rule all:
<a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w"> </span>   input:
<a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w"> </span>       "../results/multiqc_report.html",
<a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w"> </span>       expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a>
<a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a># workflow
<a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a>rule fastqc:
<a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w"> </span>   input:
<a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w"> </span>   output:
<a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w"> </span>       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-18-17" id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-18-18" id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="w"> </span>   log:
<a href="#__codelineno-18-19" id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-18-20" id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-18-21" id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-18-22" id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-18-23" id="__codelineno-18-23" name="__codelineno-18-23"></a><span class="w"> </span>   shell:
<a href="#__codelineno-18-24" id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-18-25" id="__codelineno-18-25" name="__codelineno-18-25"></a>
<a href="#__codelineno-18-26" id="__codelineno-18-26" name="__codelineno-18-26"></a>rule multiqc:
<a href="#__codelineno-18-27" id="__codelineno-18-27" name="__codelineno-18-27"></a><span class="w"> </span>   input:
<a href="#__codelineno-18-28" id="__codelineno-18-28" name="__codelineno-18-28"></a><span class="w"> </span>       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-18-29" id="__codelineno-18-29" name="__codelineno-18-29"></a><span class="w"> </span>   output:
<a href="#__codelineno-18-30" id="__codelineno-18-30" name="__codelineno-18-30"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-18-31" id="__codelineno-18-31" name="__codelineno-18-31"></a><span class="w"> </span>   log:
<a href="#__codelineno-18-32" id="__codelineno-18-32" name="__codelineno-18-32"></a><span class="w"> </span>       "logs/multiqc/multiqc.log"
<a href="#__codelineno-18-33" id="__codelineno-18-33" name="__codelineno-18-33"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-18-34" id="__codelineno-18-34" name="__codelineno-18-34"></a><span class="w"> </span>       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-18-35" id="__codelineno-18-35" name="__codelineno-18-35"></a><span class="w"> </span>   shell:
<a href="#__codelineno-18-36" id="__codelineno-18-36" name="__codelineno-18-36"></a><span class="w"> </span>       "multiqc {input} -o ../results/ &amp;&gt; {log}"
<a href="#__codelineno-18-37" id="__codelineno-18-37" name="__codelineno-18-37"></a>
<a href="#__codelineno-18-38" id="__codelineno-18-38" name="__codelineno-18-38"></a>rule trim_galore:
<a href="#__codelineno-18-39" id="__codelineno-18-39" name="__codelineno-18-39"></a><span class="w"> </span>   input:
<a href="#__codelineno-18-40" id="__codelineno-18-40" name="__codelineno-18-40"></a><span class="w"> </span>       ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-18-41" id="__codelineno-18-41" name="__codelineno-18-41"></a><span class="w"> </span>   output:
<a href="#__codelineno-18-42" id="__codelineno-18-42" name="__codelineno-18-42"></a><span class="w"> </span>       ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-18-43" id="__codelineno-18-43" name="__codelineno-18-43"></a><span class="gi">+   params:</span>
<a href="#__codelineno-18-44" id="__codelineno-18-44" name="__codelineno-18-44"></a><span class="gi">+       "--paired"</span>
<a href="#__codelineno-18-45" id="__codelineno-18-45" name="__codelineno-18-45"></a><span class="w"> </span>   log:
<a href="#__codelineno-18-46" id="__codelineno-18-46" name="__codelineno-18-46"></a><span class="w"> </span>       "logs/trim_galore/{sample}.log"
<a href="#__codelineno-18-47" id="__codelineno-18-47" name="__codelineno-18-47"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-18-48" id="__codelineno-18-48" name="__codelineno-18-48"></a><span class="w"> </span>       "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-18-49" id="__codelineno-18-49" name="__codelineno-18-49"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-18-50" id="__codelineno-18-50" name="__codelineno-18-50"></a><span class="w"> </span>   resources:
<a href="#__codelineno-18-51" id="__codelineno-18-51" name="__codelineno-18-51"></a><span class="w"> </span>       cpus=8
<a href="#__codelineno-18-52" id="__codelineno-18-52" name="__codelineno-18-52"></a><span class="w"> </span>   shell:
<a href="#__codelineno-18-53" id="__codelineno-18-53" name="__codelineno-18-53"></a><span class="gd">-       "trim_galore {input} -o ../results/trimmed/ --paired --cores {threads} &amp;&gt; {log}"</span>
<a href="#__codelineno-18-54" id="__codelineno-18-54" name="__codelineno-18-54"></a><span class="gi">+       "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"</span>
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e4dot7 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>rule all:
<a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a>    input:
<a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a>        "../results/multiqc_report.html",
<a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a>        expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a>
<a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a># workflow
<a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a>rule fastqc:
<a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a>    input:
<a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a>    output:
<a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-19-18" id="__codelineno-19-18" name="__codelineno-19-18"></a>    log:
<a href="#__codelineno-19-19" id="__codelineno-19-19" name="__codelineno-19-19"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-19-20" id="__codelineno-19-20" name="__codelineno-19-20"></a>    threads: 2
<a href="#__codelineno-19-21" id="__codelineno-19-21" name="__codelineno-19-21"></a>    envmodules:
<a href="#__codelineno-19-22" id="__codelineno-19-22" name="__codelineno-19-22"></a>        "FastQC/0.11.9"
<a href="#__codelineno-19-23" id="__codelineno-19-23" name="__codelineno-19-23"></a>    shell:
<a href="#__codelineno-19-24" id="__codelineno-19-24" name="__codelineno-19-24"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-19-25" id="__codelineno-19-25" name="__codelineno-19-25"></a>
<a href="#__codelineno-19-26" id="__codelineno-19-26" name="__codelineno-19-26"></a>rule multiqc:
<a href="#__codelineno-19-27" id="__codelineno-19-27" name="__codelineno-19-27"></a>    input:
<a href="#__codelineno-19-28" id="__codelineno-19-28" name="__codelineno-19-28"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-19-29" id="__codelineno-19-29" name="__codelineno-19-29"></a>    output:
<a href="#__codelineno-19-30" id="__codelineno-19-30" name="__codelineno-19-30"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-19-31" id="__codelineno-19-31" name="__codelineno-19-31"></a>    log:
<a href="#__codelineno-19-32" id="__codelineno-19-32" name="__codelineno-19-32"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-19-33" id="__codelineno-19-33" name="__codelineno-19-33"></a>    envmodules:
<a href="#__codelineno-19-34" id="__codelineno-19-34" name="__codelineno-19-34"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-19-35" id="__codelineno-19-35" name="__codelineno-19-35"></a>    shell:
<a href="#__codelineno-19-36" id="__codelineno-19-36" name="__codelineno-19-36"></a>        "multiqc {input} -o ../results/ &amp;&gt; {log}"
<a href="#__codelineno-19-37" id="__codelineno-19-37" name="__codelineno-19-37"></a>
<a href="#__codelineno-19-38" id="__codelineno-19-38" name="__codelineno-19-38"></a>rule trim_galore:
<a href="#__codelineno-19-39" id="__codelineno-19-39" name="__codelineno-19-39"></a>    input:
<a href="#__codelineno-19-40" id="__codelineno-19-40" name="__codelineno-19-40"></a>        ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-19-41" id="__codelineno-19-41" name="__codelineno-19-41"></a>    output:
<a href="#__codelineno-19-42" id="__codelineno-19-42" name="__codelineno-19-42"></a>        ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-19-43" id="__codelineno-19-43" name="__codelineno-19-43"></a>    params:
<a href="#__codelineno-19-44" id="__codelineno-19-44" name="__codelineno-19-44"></a>        "--paired"
<a href="#__codelineno-19-45" id="__codelineno-19-45" name="__codelineno-19-45"></a>    log:
<a href="#__codelineno-19-46" id="__codelineno-19-46" name="__codelineno-19-46"></a>        "logs/trim_galore/{sample}.log"
<a href="#__codelineno-19-47" id="__codelineno-19-47" name="__codelineno-19-47"></a>    envmodules:
<a href="#__codelineno-19-48" id="__codelineno-19-48" name="__codelineno-19-48"></a>        "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-19-49" id="__codelineno-19-49" name="__codelineno-19-49"></a>    threads: 2
<a href="#__codelineno-19-50" id="__codelineno-19-50" name="__codelineno-19-50"></a>    resources:
<a href="#__codelineno-19-51" id="__codelineno-19-51" name="__codelineno-19-51"></a>        cpus=8
<a href="#__codelineno-19-52" id="__codelineno-19-52" name="__codelineno-19-52"></a>    shell:
<a href="#__codelineno-19-53" id="__codelineno-19-53" name="__codelineno-19-53"></a>        "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot7" content=e4dot7%}
<br/></p>
<p>Run a dryrun to check it works</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="c1"># run dryrun again</span>
<a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div>
<h2 id="43-pull-out-user-configurable-options">4.3 Pull out user configurable options<a class="headerlink" href="#43-pull-out-user-configurable-options" title="Permanent link">¶</a></h2>
<p>We can separate the user configurable options away from the workflow. This supports reproducibility by minimising the chance the user makes changes to the core workflow.</p>
<p>Create a configuration file in a new directory <code>config/</code></p>
<p>File structure:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a>demo_workflow/
<a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">      </span><span class="p">|</span>_______results/
<a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">      </span><span class="p">|</span>_______workflow/
<a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______logs/
<a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______slurm/
<a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______Snakefile
<a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______status.py
<a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">      </span><span class="p">|</span>_______config
<a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">                 </span><span class="p">|</span>_______config.yaml
</code></pre></div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># create config directory</span>
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a>mkdir<span class="w"> </span>../config
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a>
<a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="c1"># create configuration file</span>
<a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a>touch<span class="w"> </span>../config/config.yaml
</code></pre></div>
<p>Now we need to pull out the parameters the user would likely need to configure. Let's give the user the option to pass any parameters they like to fastqc. In our <code>../config/config.yaml</code> file, add the configuration options and add a couple flags to be passed to fastqc and multiqc:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1"># set software parameters for...</span>
<a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="nt">PARAMS</span><span class="p">:</span>
<a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">  </span><span class="c1"># ... fastqc</span>
<a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">  </span><span class="nt">FASTQC</span><span class="p">:</span><span class="w"> </span><span class="s">"--kmers</span><span class="nv"> </span><span class="s">5"</span>
<a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">  </span><span class="c1"># ... multiqc</span>
<a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">  </span><span class="nt">MULTIQC</span><span class="p">:</span><span class="w"> </span><span class="s">"--flat"</span>
</code></pre></div>
<p>In the Snakefile, tell Snakemake to grab the variables <code>PARAMS</code> from <code>../config/config.yaml</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a>rule all:
<a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w"> </span>   input:
<a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w"> </span>       "../results/multiqc_report.html",
<a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w"> </span>       expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a>
<a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a># workflow
<a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a>rule fastqc:
<a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w"> </span>   input:
<a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-24-15" id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="w"> </span>   output:
<a href="#__codelineno-24-16" id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="w"> </span>       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-24-17" id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-24-18" id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="gi">+   params:</span>
<a href="#__codelineno-24-19" id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="gi">+       fastqc_params = config['PARAMS']['FASTQC']</span>
<a href="#__codelineno-24-20" id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="w"> </span>   log:
<a href="#__codelineno-24-21" id="__codelineno-24-21" name="__codelineno-24-21"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-24-22" id="__codelineno-24-22" name="__codelineno-24-22"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-24-23" id="__codelineno-24-23" name="__codelineno-24-23"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-24-24" id="__codelineno-24-24" name="__codelineno-24-24"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-24-25" id="__codelineno-24-25" name="__codelineno-24-25"></a><span class="w"> </span>   shell:
<a href="#__codelineno-24-26" id="__codelineno-24-26" name="__codelineno-24-26"></a><span class="gd">-       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"</span>
<a href="#__codelineno-24-27" id="__codelineno-24-27" name="__codelineno-24-27"></a><span class="gi">+       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}"</span>
<a href="#__codelineno-24-28" id="__codelineno-24-28" name="__codelineno-24-28"></a>
<a href="#__codelineno-24-29" id="__codelineno-24-29" name="__codelineno-24-29"></a>rule multiqc:
<a href="#__codelineno-24-30" id="__codelineno-24-30" name="__codelineno-24-30"></a><span class="w"> </span>   input:
<a href="#__codelineno-24-31" id="__codelineno-24-31" name="__codelineno-24-31"></a><span class="w"> </span>       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-24-32" id="__codelineno-24-32" name="__codelineno-24-32"></a><span class="w"> </span>   output:
<a href="#__codelineno-24-33" id="__codelineno-24-33" name="__codelineno-24-33"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-24-34" id="__codelineno-24-34" name="__codelineno-24-34"></a><span class="gi">+   params:</span>
<a href="#__codelineno-24-35" id="__codelineno-24-35" name="__codelineno-24-35"></a><span class="gi">+       multiqc_params = config['PARAMS']['MULTIQC']</span>
<a href="#__codelineno-24-36" id="__codelineno-24-36" name="__codelineno-24-36"></a><span class="w"> </span>   log:
<a href="#__codelineno-24-37" id="__codelineno-24-37" name="__codelineno-24-37"></a><span class="w"> </span>       "logs/multiqc/multiqc.log"
<a href="#__codelineno-24-38" id="__codelineno-24-38" name="__codelineno-24-38"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-24-39" id="__codelineno-24-39" name="__codelineno-24-39"></a><span class="w"> </span>       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-24-40" id="__codelineno-24-40" name="__codelineno-24-40"></a><span class="w"> </span>   shell:
<a href="#__codelineno-24-41" id="__codelineno-24-41" name="__codelineno-24-41"></a><span class="gd">-       "multiqc {input} -o ../results/ &amp;&gt; {log}"</span>
<a href="#__codelineno-24-42" id="__codelineno-24-42" name="__codelineno-24-42"></a><span class="gi">+       "multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}"</span>
<a href="#__codelineno-24-43" id="__codelineno-24-43" name="__codelineno-24-43"></a>
<a href="#__codelineno-24-44" id="__codelineno-24-44" name="__codelineno-24-44"></a>rule trim_galore:
<a href="#__codelineno-24-45" id="__codelineno-24-45" name="__codelineno-24-45"></a><span class="w"> </span>   input:
<a href="#__codelineno-24-46" id="__codelineno-24-46" name="__codelineno-24-46"></a><span class="w"> </span>       ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-24-47" id="__codelineno-24-47" name="__codelineno-24-47"></a><span class="w"> </span>   output:
<a href="#__codelineno-24-48" id="__codelineno-24-48" name="__codelineno-24-48"></a><span class="w"> </span>       ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-24-49" id="__codelineno-24-49" name="__codelineno-24-49"></a><span class="w"> </span>   params:
<a href="#__codelineno-24-50" id="__codelineno-24-50" name="__codelineno-24-50"></a><span class="w"> </span>       "--paired"
<a href="#__codelineno-24-51" id="__codelineno-24-51" name="__codelineno-24-51"></a><span class="w"> </span>   log:
<a href="#__codelineno-24-52" id="__codelineno-24-52" name="__codelineno-24-52"></a><span class="w"> </span>       "logs/trim_galore/{sample}.log"
<a href="#__codelineno-24-53" id="__codelineno-24-53" name="__codelineno-24-53"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-24-54" id="__codelineno-24-54" name="__codelineno-24-54"></a><span class="w"> </span>       "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-24-55" id="__codelineno-24-55" name="__codelineno-24-55"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-24-56" id="__codelineno-24-56" name="__codelineno-24-56"></a><span class="w"> </span>   resources:
<a href="#__codelineno-24-57" id="__codelineno-24-57" name="__codelineno-24-57"></a><span class="w"> </span>       cpus=8
<a href="#__codelineno-24-58" id="__codelineno-24-58" name="__codelineno-24-58"></a><span class="w"> </span>   shell:
<a href="#__codelineno-24-59" id="__codelineno-24-59" name="__codelineno-24-59"></a><span class="w"> </span>       "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e4dot8 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a>
<a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a>rule all:
<a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a>    input:
<a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a>        "../results/multiqc_report.html",
<a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a>        expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a>
<a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a># workflow
<a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a>rule fastqc:
<a href="#__codelineno-25-12" id="__codelineno-25-12" name="__codelineno-25-12"></a>    input:
<a href="#__codelineno-25-13" id="__codelineno-25-13" name="__codelineno-25-13"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-25-14" id="__codelineno-25-14" name="__codelineno-25-14"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-25-15" id="__codelineno-25-15" name="__codelineno-25-15"></a>    output:
<a href="#__codelineno-25-16" id="__codelineno-25-16" name="__codelineno-25-16"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-25-17" id="__codelineno-25-17" name="__codelineno-25-17"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-25-18" id="__codelineno-25-18" name="__codelineno-25-18"></a>    params:
<a href="#__codelineno-25-19" id="__codelineno-25-19" name="__codelineno-25-19"></a>        fastqc_params = config['PARAMS']['FASTQC']
<a href="#__codelineno-25-20" id="__codelineno-25-20" name="__codelineno-25-20"></a>    log:
<a href="#__codelineno-25-21" id="__codelineno-25-21" name="__codelineno-25-21"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-25-22" id="__codelineno-25-22" name="__codelineno-25-22"></a>    threads: 2
<a href="#__codelineno-25-23" id="__codelineno-25-23" name="__codelineno-25-23"></a>    envmodules:
<a href="#__codelineno-25-24" id="__codelineno-25-24" name="__codelineno-25-24"></a>        "FastQC/0.11.9"
<a href="#__codelineno-25-25" id="__codelineno-25-25" name="__codelineno-25-25"></a>    shell:
<a href="#__codelineno-25-26" id="__codelineno-25-26" name="__codelineno-25-26"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}"
<a href="#__codelineno-25-27" id="__codelineno-25-27" name="__codelineno-25-27"></a>
<a href="#__codelineno-25-28" id="__codelineno-25-28" name="__codelineno-25-28"></a>rule multiqc:
<a href="#__codelineno-25-29" id="__codelineno-25-29" name="__codelineno-25-29"></a>    input:
<a href="#__codelineno-25-30" id="__codelineno-25-30" name="__codelineno-25-30"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-25-31" id="__codelineno-25-31" name="__codelineno-25-31"></a>    output:
<a href="#__codelineno-25-32" id="__codelineno-25-32" name="__codelineno-25-32"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-25-33" id="__codelineno-25-33" name="__codelineno-25-33"></a>    params:
<a href="#__codelineno-25-34" id="__codelineno-25-34" name="__codelineno-25-34"></a>        multiqc_params = config['PARAMS']['MULTIQC']
<a href="#__codelineno-25-35" id="__codelineno-25-35" name="__codelineno-25-35"></a>    log:
<a href="#__codelineno-25-36" id="__codelineno-25-36" name="__codelineno-25-36"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-25-37" id="__codelineno-25-37" name="__codelineno-25-37"></a>    envmodules:
<a href="#__codelineno-25-38" id="__codelineno-25-38" name="__codelineno-25-38"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-25-39" id="__codelineno-25-39" name="__codelineno-25-39"></a>    shell:
<a href="#__codelineno-25-40" id="__codelineno-25-40" name="__codelineno-25-40"></a>        "multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}"
<a href="#__codelineno-25-41" id="__codelineno-25-41" name="__codelineno-25-41"></a>
<a href="#__codelineno-25-42" id="__codelineno-25-42" name="__codelineno-25-42"></a>rule trim_galore:
<a href="#__codelineno-25-43" id="__codelineno-25-43" name="__codelineno-25-43"></a>    input:
<a href="#__codelineno-25-44" id="__codelineno-25-44" name="__codelineno-25-44"></a>        ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-25-45" id="__codelineno-25-45" name="__codelineno-25-45"></a>    output:
<a href="#__codelineno-25-46" id="__codelineno-25-46" name="__codelineno-25-46"></a>        ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-25-47" id="__codelineno-25-47" name="__codelineno-25-47"></a>    params:
<a href="#__codelineno-25-48" id="__codelineno-25-48" name="__codelineno-25-48"></a>        "--paired"
<a href="#__codelineno-25-49" id="__codelineno-25-49" name="__codelineno-25-49"></a>    log:
<a href="#__codelineno-25-50" id="__codelineno-25-50" name="__codelineno-25-50"></a>        "logs/trim_galore/{sample}.log"
<a href="#__codelineno-25-51" id="__codelineno-25-51" name="__codelineno-25-51"></a>    envmodules:
<a href="#__codelineno-25-52" id="__codelineno-25-52" name="__codelineno-25-52"></a>        "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-25-53" id="__codelineno-25-53" name="__codelineno-25-53"></a>    threads: 2
<a href="#__codelineno-25-54" id="__codelineno-25-54" name="__codelineno-25-54"></a>    resources:
<a href="#__codelineno-25-55" id="__codelineno-25-55" name="__codelineno-25-55"></a>        cpus=8
<a href="#__codelineno-25-56" id="__codelineno-25-56" name="__codelineno-25-56"></a>    shell:
<a href="#__codelineno-25-57" id="__codelineno-25-57" name="__codelineno-25-57"></a>        "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot8" content=e4dot8%}
<br/></p>
<p>Let's use our configuration file! Run workflow again:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a>
<a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="c1"># run dryrun/run again</span>
<a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
<a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a>snakemake<span class="w"> </span>--profile<span class="w"> </span>slurm<span class="w"> </span>--use-envmodules
</code></pre></div>
<p>Didn't work?</p>
<p>My error:</p>
<p>{% capture e4dot9 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a>KeyError<span class="w"> </span><span class="k">in</span><span class="w"> </span>line<span class="w"> </span><span class="m">19</span><span class="w"> </span>of<span class="w"> </span>/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile:
<a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="s1">'PARAMS'</span>
<a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">  </span>File<span class="w"> </span><span class="s2">"/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile"</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">19</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot9" content=e4dot9%}
<br/></p>
<p>Snakemake can't find our 'Key' - we haven't told Snakemake where our config file is so it can't find our config variables. We can do this by passing the location of our config file to the <code>--configfile</code> flag</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a># remove output of last run
<a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a>rm -r ../results/
<a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a>
<a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a># run dryrun/run again
<a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="gd">- snakemake --dryrun --profile slurm --use-envmodules</span>
<a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="gd">- snakemake --profile slurm --use-envmodules</span>
<a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="gi">+ snakemake --dryrun --profile slurm --use-envmodules --configfile ../config/config.yaml</span>
<a href="#__codelineno-28-8" id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="gi">+ snakemake --profile slurm --use-envmodules --configfile ../config/config.yaml</span>
</code></pre></div>
<p>Alternatively, we can define our config file in our Snakefile in a situation where the configuration file is likely to always be named the same and be in the exact same location <code>../config/config.yaml</code> and you don't need the flexibility for the user to specify their own configuration files:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a># define our configuration file
<a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="gi">+ configfile: "../config/config.yaml"</span>
<a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a>
<a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a># define samples from data directory using wildcards
<a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a>
<a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a>rule all:
<a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w"> </span>   input:
<a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w"> </span>       "../results/multiqc_report.html",
<a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w"> </span>       expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-29-12" id="__codelineno-29-12" name="__codelineno-29-12"></a>
<a href="#__codelineno-29-13" id="__codelineno-29-13" name="__codelineno-29-13"></a># workflow
<a href="#__codelineno-29-14" id="__codelineno-29-14" name="__codelineno-29-14"></a>rule fastqc:
<a href="#__codelineno-29-15" id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w"> </span>   input:
<a href="#__codelineno-29-16" id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-29-17" id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-29-18" id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="w"> </span>   output:
<a href="#__codelineno-29-19" id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w"> </span>       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-29-20" id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-29-21" id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="w"> </span>   params:
<a href="#__codelineno-29-22" id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="w"> </span>       fastqc_params = config['PARAMS']['FASTQC']
<a href="#__codelineno-29-23" id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="w"> </span>   log:
<a href="#__codelineno-29-24" id="__codelineno-29-24" name="__codelineno-29-24"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-29-25" id="__codelineno-29-25" name="__codelineno-29-25"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-29-26" id="__codelineno-29-26" name="__codelineno-29-26"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-29-27" id="__codelineno-29-27" name="__codelineno-29-27"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-29-28" id="__codelineno-29-28" name="__codelineno-29-28"></a><span class="w"> </span>   shell:
<a href="#__codelineno-29-29" id="__codelineno-29-29" name="__codelineno-29-29"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}"
<a href="#__codelineno-29-30" id="__codelineno-29-30" name="__codelineno-29-30"></a>
<a href="#__codelineno-29-31" id="__codelineno-29-31" name="__codelineno-29-31"></a>rule multiqc:
<a href="#__codelineno-29-32" id="__codelineno-29-32" name="__codelineno-29-32"></a><span class="w"> </span>   input:
<a href="#__codelineno-29-33" id="__codelineno-29-33" name="__codelineno-29-33"></a><span class="w"> </span>       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-29-34" id="__codelineno-29-34" name="__codelineno-29-34"></a><span class="w"> </span>   output:
<a href="#__codelineno-29-35" id="__codelineno-29-35" name="__codelineno-29-35"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-29-36" id="__codelineno-29-36" name="__codelineno-29-36"></a><span class="w"> </span>   params:
<a href="#__codelineno-29-37" id="__codelineno-29-37" name="__codelineno-29-37"></a><span class="w"> </span>       multiqc_params = config['PARAMS']['MULTIQC']
<a href="#__codelineno-29-38" id="__codelineno-29-38" name="__codelineno-29-38"></a><span class="w"> </span>   log:
<a href="#__codelineno-29-39" id="__codelineno-29-39" name="__codelineno-29-39"></a><span class="w"> </span>       "logs/multiqc/multiqc.log"
<a href="#__codelineno-29-40" id="__codelineno-29-40" name="__codelineno-29-40"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-29-41" id="__codelineno-29-41" name="__codelineno-29-41"></a><span class="w"> </span>       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-29-42" id="__codelineno-29-42" name="__codelineno-29-42"></a><span class="w"> </span>   shell:
<a href="#__codelineno-29-43" id="__codelineno-29-43" name="__codelineno-29-43"></a><span class="w"> </span>       "multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}"
<a href="#__codelineno-29-44" id="__codelineno-29-44" name="__codelineno-29-44"></a>
<a href="#__codelineno-29-45" id="__codelineno-29-45" name="__codelineno-29-45"></a>rule trim_galore:
<a href="#__codelineno-29-46" id="__codelineno-29-46" name="__codelineno-29-46"></a><span class="w"> </span>   input:
<a href="#__codelineno-29-47" id="__codelineno-29-47" name="__codelineno-29-47"></a><span class="w"> </span>       ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-29-48" id="__codelineno-29-48" name="__codelineno-29-48"></a><span class="w"> </span>   output:
<a href="#__codelineno-29-49" id="__codelineno-29-49" name="__codelineno-29-49"></a><span class="w"> </span>       ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-29-50" id="__codelineno-29-50" name="__codelineno-29-50"></a><span class="w"> </span>   params:
<a href="#__codelineno-29-51" id="__codelineno-29-51" name="__codelineno-29-51"></a><span class="w"> </span>       "--paired"
<a href="#__codelineno-29-52" id="__codelineno-29-52" name="__codelineno-29-52"></a><span class="w"> </span>   log:
<a href="#__codelineno-29-53" id="__codelineno-29-53" name="__codelineno-29-53"></a><span class="w"> </span>       "logs/trim_galore/{sample}.log"
<a href="#__codelineno-29-54" id="__codelineno-29-54" name="__codelineno-29-54"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-29-55" id="__codelineno-29-55" name="__codelineno-29-55"></a><span class="w"> </span>       "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-29-56" id="__codelineno-29-56" name="__codelineno-29-56"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-29-57" id="__codelineno-29-57" name="__codelineno-29-57"></a><span class="w"> </span>   resources:
<a href="#__codelineno-29-58" id="__codelineno-29-58" name="__codelineno-29-58"></a><span class="w"> </span>       cpus=8
<a href="#__codelineno-29-59" id="__codelineno-29-59" name="__codelineno-29-59"></a><span class="w"> </span>   shell:
<a href="#__codelineno-29-60" id="__codelineno-29-60" name="__codelineno-29-60"></a><span class="w"> </span>       "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e4dot10 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a># define our configuration file
<a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a>configfile: "../config/config.yaml"
<a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a>
<a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a># define samples from data directory using wildcards
<a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a>
<a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a>rule all:
<a href="#__codelineno-30-9" id="__codelineno-30-9" name="__codelineno-30-9"></a>    input:
<a href="#__codelineno-30-10" id="__codelineno-30-10" name="__codelineno-30-10"></a>        "../results/multiqc_report.html",
<a href="#__codelineno-30-11" id="__codelineno-30-11" name="__codelineno-30-11"></a>        expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-30-12" id="__codelineno-30-12" name="__codelineno-30-12"></a>
<a href="#__codelineno-30-13" id="__codelineno-30-13" name="__codelineno-30-13"></a># workflow
<a href="#__codelineno-30-14" id="__codelineno-30-14" name="__codelineno-30-14"></a>rule fastqc:
<a href="#__codelineno-30-15" id="__codelineno-30-15" name="__codelineno-30-15"></a>    input:
<a href="#__codelineno-30-16" id="__codelineno-30-16" name="__codelineno-30-16"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-30-17" id="__codelineno-30-17" name="__codelineno-30-17"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-30-18" id="__codelineno-30-18" name="__codelineno-30-18"></a>    output:
<a href="#__codelineno-30-19" id="__codelineno-30-19" name="__codelineno-30-19"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-30-20" id="__codelineno-30-20" name="__codelineno-30-20"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-30-21" id="__codelineno-30-21" name="__codelineno-30-21"></a>    params:
<a href="#__codelineno-30-22" id="__codelineno-30-22" name="__codelineno-30-22"></a>        fastqc_params = config['PARAMS']['FASTQC']
<a href="#__codelineno-30-23" id="__codelineno-30-23" name="__codelineno-30-23"></a>    log:
<a href="#__codelineno-30-24" id="__codelineno-30-24" name="__codelineno-30-24"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-30-25" id="__codelineno-30-25" name="__codelineno-30-25"></a>    threads: 2
<a href="#__codelineno-30-26" id="__codelineno-30-26" name="__codelineno-30-26"></a>    envmodules:
<a href="#__codelineno-30-27" id="__codelineno-30-27" name="__codelineno-30-27"></a>        "FastQC/0.11.9"
<a href="#__codelineno-30-28" id="__codelineno-30-28" name="__codelineno-30-28"></a>    shell:
<a href="#__codelineno-30-29" id="__codelineno-30-29" name="__codelineno-30-29"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}"
<a href="#__codelineno-30-30" id="__codelineno-30-30" name="__codelineno-30-30"></a>
<a href="#__codelineno-30-31" id="__codelineno-30-31" name="__codelineno-30-31"></a>rule multiqc:
<a href="#__codelineno-30-32" id="__codelineno-30-32" name="__codelineno-30-32"></a>    input:
<a href="#__codelineno-30-33" id="__codelineno-30-33" name="__codelineno-30-33"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-30-34" id="__codelineno-30-34" name="__codelineno-30-34"></a>    output:
<a href="#__codelineno-30-35" id="__codelineno-30-35" name="__codelineno-30-35"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-30-36" id="__codelineno-30-36" name="__codelineno-30-36"></a>    params:
<a href="#__codelineno-30-37" id="__codelineno-30-37" name="__codelineno-30-37"></a>        multiqc_params = config['PARAMS']['MULTIQC']
<a href="#__codelineno-30-38" id="__codelineno-30-38" name="__codelineno-30-38"></a>    log:
<a href="#__codelineno-30-39" id="__codelineno-30-39" name="__codelineno-30-39"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-30-40" id="__codelineno-30-40" name="__codelineno-30-40"></a>    envmodules:
<a href="#__codelineno-30-41" id="__codelineno-30-41" name="__codelineno-30-41"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-30-42" id="__codelineno-30-42" name="__codelineno-30-42"></a>    shell:
<a href="#__codelineno-30-43" id="__codelineno-30-43" name="__codelineno-30-43"></a>        "multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}"
<a href="#__codelineno-30-44" id="__codelineno-30-44" name="__codelineno-30-44"></a>
<a href="#__codelineno-30-45" id="__codelineno-30-45" name="__codelineno-30-45"></a>rule trim_galore:
<a href="#__codelineno-30-46" id="__codelineno-30-46" name="__codelineno-30-46"></a>    input:
<a href="#__codelineno-30-47" id="__codelineno-30-47" name="__codelineno-30-47"></a>        ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-30-48" id="__codelineno-30-48" name="__codelineno-30-48"></a>    output:
<a href="#__codelineno-30-49" id="__codelineno-30-49" name="__codelineno-30-49"></a>        ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-30-50" id="__codelineno-30-50" name="__codelineno-30-50"></a>    params:
<a href="#__codelineno-30-51" id="__codelineno-30-51" name="__codelineno-30-51"></a>        "--paired"
<a href="#__codelineno-30-52" id="__codelineno-30-52" name="__codelineno-30-52"></a>    log:
<a href="#__codelineno-30-53" id="__codelineno-30-53" name="__codelineno-30-53"></a>        "logs/trim_galore/{sample}.log"
<a href="#__codelineno-30-54" id="__codelineno-30-54" name="__codelineno-30-54"></a>    envmodules:
<a href="#__codelineno-30-55" id="__codelineno-30-55" name="__codelineno-30-55"></a>        "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-30-56" id="__codelineno-30-56" name="__codelineno-30-56"></a>    threads: 2
<a href="#__codelineno-30-57" id="__codelineno-30-57" name="__codelineno-30-57"></a>    resources:
<a href="#__codelineno-30-58" id="__codelineno-30-58" name="__codelineno-30-58"></a>        cpus=8
<a href="#__codelineno-30-59" id="__codelineno-30-59" name="__codelineno-30-59"></a>    shell:
<a href="#__codelineno-30-60" id="__codelineno-30-60" name="__codelineno-30-60"></a>        "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot10" content=e4dot10%}
<br/></p>
<p>Then we don't need to specify where the configuration file is on the command line</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a># remove output of last run
<a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>rm -r ../results/*
<a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a>
<a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a># run dryrun/run again
<a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="gd">- snakemake --dryrun --profile slurm --use-envmodules --configfile ../config/config.yaml</span>
<a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="gd">- snakemake --profile slurm --use-envmodules --configfile ../config/config.yaml</span>
<a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="gi">+ snakemake --dryrun --profile slurm --use-envmodules</span>
<a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="gi">+ snakemake --profile slurm --use-envmodules</span>
</code></pre></div>
<h2 id="44-leave-messages-for-the-user">4.4 Leave messages for the user<a class="headerlink" href="#44-leave-messages-for-the-user" title="Permanent link">¶</a></h2>
<p>We can provide the user of our workflow more information on what is happening at each stage/rule of our workflow via the <code>message:</code> directive. We are able to call many variables such as:</p>
<ul>
<li>Input and output files <code>{input}</code> and <code>{output}</code></li>
<li>Specific input and output files such as <code>{input.R1}</code></li>
<li>Our <code>{params}</code>, <code>{log}</code> and <code>{threads}</code> directives</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a># define our configuration file
<a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a>configfile: "../config/config.yaml"
<a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a>
<a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a># define samples from data directory using wildcards
<a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a>
<a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a>rule all:
<a href="#__codelineno-32-9" id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="w"> </span>   input:
<a href="#__codelineno-32-10" id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="w"> </span>       "../results/multiqc_report.html",
<a href="#__codelineno-32-11" id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="w"> </span>       expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-32-12" id="__codelineno-32-12" name="__codelineno-32-12"></a>
<a href="#__codelineno-32-13" id="__codelineno-32-13" name="__codelineno-32-13"></a># workflow
<a href="#__codelineno-32-14" id="__codelineno-32-14" name="__codelineno-32-14"></a>rule fastqc:
<a href="#__codelineno-32-15" id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="w"> </span>   input:
<a href="#__codelineno-32-16" id="__codelineno-32-16" name="__codelineno-32-16"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-32-17" id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-32-18" id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="w"> </span>   output:
<a href="#__codelineno-32-19" id="__codelineno-32-19" name="__codelineno-32-19"></a><span class="w"> </span>       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-32-20" id="__codelineno-32-20" name="__codelineno-32-20"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-32-21" id="__codelineno-32-21" name="__codelineno-32-21"></a><span class="w"> </span>   params:
<a href="#__codelineno-32-22" id="__codelineno-32-22" name="__codelineno-32-22"></a><span class="w"> </span>       fastqc_params = config['PARAMS']['FASTQC']
<a href="#__codelineno-32-23" id="__codelineno-32-23" name="__codelineno-32-23"></a><span class="w"> </span>   log:
<a href="#__codelineno-32-24" id="__codelineno-32-24" name="__codelineno-32-24"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-32-25" id="__codelineno-32-25" name="__codelineno-32-25"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-32-26" id="__codelineno-32-26" name="__codelineno-32-26"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-32-27" id="__codelineno-32-27" name="__codelineno-32-27"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-32-28" id="__codelineno-32-28" name="__codelineno-32-28"></a><span class="gi">+   message:</span>
<a href="#__codelineno-32-29" id="__codelineno-32-29" name="__codelineno-32-29"></a><span class="gi">+       "Undertaking quality control checks {input}"</span>
<a href="#__codelineno-32-30" id="__codelineno-32-30" name="__codelineno-32-30"></a><span class="w"> </span>   shell:
<a href="#__codelineno-32-31" id="__codelineno-32-31" name="__codelineno-32-31"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}"
<a href="#__codelineno-32-32" id="__codelineno-32-32" name="__codelineno-32-32"></a>
<a href="#__codelineno-32-33" id="__codelineno-32-33" name="__codelineno-32-33"></a>rule multiqc:
<a href="#__codelineno-32-34" id="__codelineno-32-34" name="__codelineno-32-34"></a><span class="w"> </span>   input:
<a href="#__codelineno-32-35" id="__codelineno-32-35" name="__codelineno-32-35"></a><span class="w"> </span>       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-32-36" id="__codelineno-32-36" name="__codelineno-32-36"></a><span class="w"> </span>   output:
<a href="#__codelineno-32-37" id="__codelineno-32-37" name="__codelineno-32-37"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-32-38" id="__codelineno-32-38" name="__codelineno-32-38"></a><span class="w"> </span>   params:
<a href="#__codelineno-32-39" id="__codelineno-32-39" name="__codelineno-32-39"></a><span class="w"> </span>       multiqc_params = config['PARAMS']['MULTIQC']
<a href="#__codelineno-32-40" id="__codelineno-32-40" name="__codelineno-32-40"></a><span class="w"> </span>   log:
<a href="#__codelineno-32-41" id="__codelineno-32-41" name="__codelineno-32-41"></a><span class="w"> </span>       "logs/multiqc/multiqc.log"
<a href="#__codelineno-32-42" id="__codelineno-32-42" name="__codelineno-32-42"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-32-43" id="__codelineno-32-43" name="__codelineno-32-43"></a><span class="w"> </span>       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-32-44" id="__codelineno-32-44" name="__codelineno-32-44"></a><span class="gi">+   message:</span>
<a href="#__codelineno-32-45" id="__codelineno-32-45" name="__codelineno-32-45"></a><span class="gi">+       "Compiling a HTML report for quality control checks. Writing to {output}."</span>
<a href="#__codelineno-32-46" id="__codelineno-32-46" name="__codelineno-32-46"></a><span class="w"> </span>   shell:
<a href="#__codelineno-32-47" id="__codelineno-32-47" name="__codelineno-32-47"></a><span class="w"> </span>       "multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}"
<a href="#__codelineno-32-48" id="__codelineno-32-48" name="__codelineno-32-48"></a>
<a href="#__codelineno-32-49" id="__codelineno-32-49" name="__codelineno-32-49"></a>rule trim_galore:
<a href="#__codelineno-32-50" id="__codelineno-32-50" name="__codelineno-32-50"></a><span class="w"> </span>   input:
<a href="#__codelineno-32-51" id="__codelineno-32-51" name="__codelineno-32-51"></a><span class="w"> </span>       ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-32-52" id="__codelineno-32-52" name="__codelineno-32-52"></a><span class="w"> </span>   output:
<a href="#__codelineno-32-53" id="__codelineno-32-53" name="__codelineno-32-53"></a><span class="w"> </span>       ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-32-54" id="__codelineno-32-54" name="__codelineno-32-54"></a><span class="w"> </span>   params:
<a href="#__codelineno-32-55" id="__codelineno-32-55" name="__codelineno-32-55"></a><span class="w"> </span>       "--paired"
<a href="#__codelineno-32-56" id="__codelineno-32-56" name="__codelineno-32-56"></a><span class="w"> </span>   log:
<a href="#__codelineno-32-57" id="__codelineno-32-57" name="__codelineno-32-57"></a><span class="w"> </span>       "logs/trim_galore/{sample}.log"
<a href="#__codelineno-32-58" id="__codelineno-32-58" name="__codelineno-32-58"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-32-59" id="__codelineno-32-59" name="__codelineno-32-59"></a><span class="w"> </span>       "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-32-60" id="__codelineno-32-60" name="__codelineno-32-60"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-32-61" id="__codelineno-32-61" name="__codelineno-32-61"></a><span class="w"> </span>   resources:
<a href="#__codelineno-32-62" id="__codelineno-32-62" name="__codelineno-32-62"></a><span class="w"> </span>       cpus=8
<a href="#__codelineno-32-63" id="__codelineno-32-63" name="__codelineno-32-63"></a><span class="gi">+   message:</span>
<a href="#__codelineno-32-64" id="__codelineno-32-64" name="__codelineno-32-64"></a><span class="gi">+       "Trimming using these parameter: {params}. Writing logs to {log}. Using {threads} threads."</span>
<a href="#__codelineno-32-65" id="__codelineno-32-65" name="__codelineno-32-65"></a><span class="w"> </span>   shell:
<a href="#__codelineno-32-66" id="__codelineno-32-66" name="__codelineno-32-66"></a><span class="w"> </span>       "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e4dot11 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a># define our configuration file
<a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a>configfile: "../config/config.yaml"
<a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a>
<a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a># define samples from data directory using wildcards
<a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a>
<a href="#__codelineno-33-7" id="__codelineno-33-7" name="__codelineno-33-7"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-33-8" id="__codelineno-33-8" name="__codelineno-33-8"></a>rule all:
<a href="#__codelineno-33-9" id="__codelineno-33-9" name="__codelineno-33-9"></a>    input:
<a href="#__codelineno-33-10" id="__codelineno-33-10" name="__codelineno-33-10"></a>        "../results/multiqc_report.html",
<a href="#__codelineno-33-11" id="__codelineno-33-11" name="__codelineno-33-11"></a>        expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-33-12" id="__codelineno-33-12" name="__codelineno-33-12"></a>
<a href="#__codelineno-33-13" id="__codelineno-33-13" name="__codelineno-33-13"></a># workflow
<a href="#__codelineno-33-14" id="__codelineno-33-14" name="__codelineno-33-14"></a>rule fastqc:
<a href="#__codelineno-33-15" id="__codelineno-33-15" name="__codelineno-33-15"></a>    input:
<a href="#__codelineno-33-16" id="__codelineno-33-16" name="__codelineno-33-16"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-33-17" id="__codelineno-33-17" name="__codelineno-33-17"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-33-18" id="__codelineno-33-18" name="__codelineno-33-18"></a>    output:
<a href="#__codelineno-33-19" id="__codelineno-33-19" name="__codelineno-33-19"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-33-20" id="__codelineno-33-20" name="__codelineno-33-20"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-33-21" id="__codelineno-33-21" name="__codelineno-33-21"></a>    params:
<a href="#__codelineno-33-22" id="__codelineno-33-22" name="__codelineno-33-22"></a>        fastqc_params = config['PARAMS']['FASTQC']
<a href="#__codelineno-33-23" id="__codelineno-33-23" name="__codelineno-33-23"></a>    log:
<a href="#__codelineno-33-24" id="__codelineno-33-24" name="__codelineno-33-24"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-33-25" id="__codelineno-33-25" name="__codelineno-33-25"></a>    threads: 2
<a href="#__codelineno-33-26" id="__codelineno-33-26" name="__codelineno-33-26"></a>    envmodules:
<a href="#__codelineno-33-27" id="__codelineno-33-27" name="__codelineno-33-27"></a>        "FastQC/0.11.9"
<a href="#__codelineno-33-28" id="__codelineno-33-28" name="__codelineno-33-28"></a>    message:
<a href="#__codelineno-33-29" id="__codelineno-33-29" name="__codelineno-33-29"></a>        "Undertaking quality control checks {input}"
<a href="#__codelineno-33-30" id="__codelineno-33-30" name="__codelineno-33-30"></a>    shell:
<a href="#__codelineno-33-31" id="__codelineno-33-31" name="__codelineno-33-31"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}"
<a href="#__codelineno-33-32" id="__codelineno-33-32" name="__codelineno-33-32"></a>
<a href="#__codelineno-33-33" id="__codelineno-33-33" name="__codelineno-33-33"></a>rule multiqc:
<a href="#__codelineno-33-34" id="__codelineno-33-34" name="__codelineno-33-34"></a>    input:
<a href="#__codelineno-33-35" id="__codelineno-33-35" name="__codelineno-33-35"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-33-36" id="__codelineno-33-36" name="__codelineno-33-36"></a>    output:
<a href="#__codelineno-33-37" id="__codelineno-33-37" name="__codelineno-33-37"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-33-38" id="__codelineno-33-38" name="__codelineno-33-38"></a>    params:
<a href="#__codelineno-33-39" id="__codelineno-33-39" name="__codelineno-33-39"></a>        multiqc_params = config['PARAMS']['MULTIQC']
<a href="#__codelineno-33-40" id="__codelineno-33-40" name="__codelineno-33-40"></a>    log:
<a href="#__codelineno-33-41" id="__codelineno-33-41" name="__codelineno-33-41"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-33-42" id="__codelineno-33-42" name="__codelineno-33-42"></a>    envmodules:
<a href="#__codelineno-33-43" id="__codelineno-33-43" name="__codelineno-33-43"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-33-44" id="__codelineno-33-44" name="__codelineno-33-44"></a>    message:
<a href="#__codelineno-33-45" id="__codelineno-33-45" name="__codelineno-33-45"></a>        "Compiling a HTML report for quality control checks. Writing to {output}."
<a href="#__codelineno-33-46" id="__codelineno-33-46" name="__codelineno-33-46"></a>    shell:
<a href="#__codelineno-33-47" id="__codelineno-33-47" name="__codelineno-33-47"></a>        "multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}"
<a href="#__codelineno-33-48" id="__codelineno-33-48" name="__codelineno-33-48"></a>
<a href="#__codelineno-33-49" id="__codelineno-33-49" name="__codelineno-33-49"></a>rule trim_galore:
<a href="#__codelineno-33-50" id="__codelineno-33-50" name="__codelineno-33-50"></a>    input:
<a href="#__codelineno-33-51" id="__codelineno-33-51" name="__codelineno-33-51"></a>        ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-33-52" id="__codelineno-33-52" name="__codelineno-33-52"></a>    output:
<a href="#__codelineno-33-53" id="__codelineno-33-53" name="__codelineno-33-53"></a>        ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-33-54" id="__codelineno-33-54" name="__codelineno-33-54"></a>    params:
<a href="#__codelineno-33-55" id="__codelineno-33-55" name="__codelineno-33-55"></a>        "--paired"
<a href="#__codelineno-33-56" id="__codelineno-33-56" name="__codelineno-33-56"></a>    log:
<a href="#__codelineno-33-57" id="__codelineno-33-57" name="__codelineno-33-57"></a>        "logs/trim_galore/{sample}.log"
<a href="#__codelineno-33-58" id="__codelineno-33-58" name="__codelineno-33-58"></a>    envmodules:
<a href="#__codelineno-33-59" id="__codelineno-33-59" name="__codelineno-33-59"></a>        "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-33-60" id="__codelineno-33-60" name="__codelineno-33-60"></a>    threads: 2
<a href="#__codelineno-33-61" id="__codelineno-33-61" name="__codelineno-33-61"></a>    resources:
<a href="#__codelineno-33-62" id="__codelineno-33-62" name="__codelineno-33-62"></a>        cpus=8
<a href="#__codelineno-33-63" id="__codelineno-33-63" name="__codelineno-33-63"></a>    message:
<a href="#__codelineno-33-64" id="__codelineno-33-64" name="__codelineno-33-64"></a>        "Trimming using these parameter: {params}. Writing logs to {log}. Using {threads} threads."
<a href="#__codelineno-33-65" id="__codelineno-33-65" name="__codelineno-33-65"></a>    shell:
<a href="#__codelineno-33-66" id="__codelineno-33-66" name="__codelineno-33-66"></a>        "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot11" content=e4dot11%}
<br/></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a># remove output of last run
<a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a>rm -r ../results/*
<a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a>
<a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a># run dryrun/run again
<a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a>snakemake --dryrun --profile slurm --use-envmodules
<a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a>snakemake --profile slurm --use-envmodules
</code></pre></div>
<p>Now our messages are printed to the screen as our workflow runs</p>
<p>My output:</p>
<p>{% capture e4dot12 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a>Using<span class="w"> </span>shell:<span class="w"> </span>/usr/bin/bash
<a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a>Provided<span class="w"> </span>cluster<span class="w"> </span>nodes:<span class="w"> </span><span class="m">20</span>
<a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a>job<span class="w">            </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a>-----------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a>all<span class="w">                </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a>fastqc<span class="w">             </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-35-9" id="__codelineno-35-9" name="__codelineno-35-9"></a>multiqc<span class="w">            </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-35-10" id="__codelineno-35-10" name="__codelineno-35-10"></a>trim_galore<span class="w">        </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-35-11" id="__codelineno-35-11" name="__codelineno-35-11"></a>total<span class="w">              </span><span class="m">8</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-35-12" id="__codelineno-35-12" name="__codelineno-35-12"></a>
<a href="#__codelineno-35-13" id="__codelineno-35-13" name="__codelineno-35-13"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-35-14" id="__codelineno-35-14" name="__codelineno-35-14"></a>
<a href="#__codelineno-35-15" id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-16" id="__codelineno-35-16" name="__codelineno-35-16"></a>Job<span class="w"> </span><span class="m">4</span>:<span class="w"> </span>Undertaking<span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks<span class="w"> </span>../../data/NA24694_1.fastq.gz<span class="w"> </span>../../data/NA24694_2.fastq.gz
<a href="#__codelineno-35-17" id="__codelineno-35-17" name="__codelineno-35-17"></a>
<a href="#__codelineno-35-18" id="__codelineno-35-18" name="__codelineno-35-18"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">4</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">'26763840'</span>.
<a href="#__codelineno-35-19" id="__codelineno-35-19" name="__codelineno-35-19"></a>
<a href="#__codelineno-35-20" id="__codelineno-35-20" name="__codelineno-35-20"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-21" id="__codelineno-35-21" name="__codelineno-35-21"></a>Job<span class="w"> </span><span class="m">6</span>:<span class="w"> </span>Trimming<span class="w"> </span>using<span class="w"> </span>these<span class="w"> </span>parameter:<span class="w"> </span>--paired.<span class="w"> </span>Writing<span class="w"> </span>logs<span class="w"> </span>to<span class="w"> </span>logs/trim_galore/NA24695.log.<span class="w"> </span>Using<span class="w"> </span><span class="m">2</span><span class="w"> </span>threads.
<a href="#__codelineno-35-22" id="__codelineno-35-22" name="__codelineno-35-22"></a>
<a href="#__codelineno-35-23" id="__codelineno-35-23" name="__codelineno-35-23"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">6</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">'26763841'</span>.
<a href="#__codelineno-35-24" id="__codelineno-35-24" name="__codelineno-35-24"></a>
<a href="#__codelineno-35-25" id="__codelineno-35-25" name="__codelineno-35-25"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-26" id="__codelineno-35-26" name="__codelineno-35-26"></a>Job<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Undertaking<span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks<span class="w"> </span>../../data/NA24631_1.fastq.gz<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a href="#__codelineno-35-27" id="__codelineno-35-27" name="__codelineno-35-27"></a>
<a href="#__codelineno-35-28" id="__codelineno-35-28" name="__codelineno-35-28"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">2</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">'26763842'</span>.
<a href="#__codelineno-35-29" id="__codelineno-35-29" name="__codelineno-35-29"></a>
<a href="#__codelineno-35-30" id="__codelineno-35-30" name="__codelineno-35-30"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-31" id="__codelineno-35-31" name="__codelineno-35-31"></a>Job<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>Undertaking<span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks<span class="w"> </span>../../data/NA24695_1.fastq.gz<span class="w"> </span>../../data/NA24695_2.fastq.gz
<a href="#__codelineno-35-32" id="__codelineno-35-32" name="__codelineno-35-32"></a>
<a href="#__codelineno-35-33" id="__codelineno-35-33" name="__codelineno-35-33"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">3</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">'26763843'</span>.
<a href="#__codelineno-35-34" id="__codelineno-35-34" name="__codelineno-35-34"></a>
<a href="#__codelineno-35-35" id="__codelineno-35-35" name="__codelineno-35-35"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-36" id="__codelineno-35-36" name="__codelineno-35-36"></a>Job<span class="w"> </span><span class="m">5</span>:<span class="w"> </span>Trimming<span class="w"> </span>using<span class="w"> </span>these<span class="w"> </span>parameter:<span class="w"> </span>--paired.<span class="w"> </span>Writing<span class="w"> </span>logs<span class="w"> </span>to<span class="w"> </span>logs/trim_galore/NA24631.log.<span class="w"> </span>Using<span class="w"> </span><span class="m">2</span><span class="w"> </span>threads.
<a href="#__codelineno-35-37" id="__codelineno-35-37" name="__codelineno-35-37"></a>
<a href="#__codelineno-35-38" id="__codelineno-35-38" name="__codelineno-35-38"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">5</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">'26763844'</span>.
<a href="#__codelineno-35-39" id="__codelineno-35-39" name="__codelineno-35-39"></a>
<a href="#__codelineno-35-40" id="__codelineno-35-40" name="__codelineno-35-40"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-41" id="__codelineno-35-41" name="__codelineno-35-41"></a>Job<span class="w"> </span><span class="m">7</span>:<span class="w"> </span>Trimming<span class="w"> </span>using<span class="w"> </span>these<span class="w"> </span>parameter:<span class="w"> </span>--paired.<span class="w"> </span>Writing<span class="w"> </span>logs<span class="w"> </span>to<span class="w"> </span>logs/trim_galore/NA24694.log.<span class="w"> </span>Using<span class="w"> </span><span class="m">2</span><span class="w"> </span>threads.
<a href="#__codelineno-35-42" id="__codelineno-35-42" name="__codelineno-35-42"></a>
<a href="#__codelineno-35-43" id="__codelineno-35-43" name="__codelineno-35-43"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">7</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">'26763845'</span>.
<a href="#__codelineno-35-44" id="__codelineno-35-44" name="__codelineno-35-44"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-45" id="__codelineno-35-45" name="__codelineno-35-45"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">4</span>.
<a href="#__codelineno-35-46" id="__codelineno-35-46" name="__codelineno-35-46"></a><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">12</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-35-47" id="__codelineno-35-47" name="__codelineno-35-47"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-48" id="__codelineno-35-48" name="__codelineno-35-48"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">6</span>.
<a href="#__codelineno-35-49" id="__codelineno-35-49" name="__codelineno-35-49"></a><span class="m">2</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">25</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-35-50" id="__codelineno-35-50" name="__codelineno-35-50"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-51" id="__codelineno-35-51" name="__codelineno-35-51"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">2</span>.
<a href="#__codelineno-35-52" id="__codelineno-35-52" name="__codelineno-35-52"></a><span class="m">3</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">38</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-35-53" id="__codelineno-35-53" name="__codelineno-35-53"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-54" id="__codelineno-35-54" name="__codelineno-35-54"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">3</span>.
<a href="#__codelineno-35-55" id="__codelineno-35-55" name="__codelineno-35-55"></a><span class="m">4</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">50</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-35-56" id="__codelineno-35-56" name="__codelineno-35-56"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-35-57" id="__codelineno-35-57" name="__codelineno-35-57"></a>
<a href="#__codelineno-35-58" id="__codelineno-35-58" name="__codelineno-35-58"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:09<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-59" id="__codelineno-35-59" name="__codelineno-35-59"></a>Job<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Compiling<span class="w"> </span>a<span class="w"> </span>HTML<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks.<span class="w"> </span>Writing<span class="w"> </span>to<span class="w"> </span>../results/multiqc_report.html.
<a href="#__codelineno-35-60" id="__codelineno-35-60" name="__codelineno-35-60"></a>
<a href="#__codelineno-35-61" id="__codelineno-35-61" name="__codelineno-35-61"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">1</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">'26763848'</span>.
<a href="#__codelineno-35-62" id="__codelineno-35-62" name="__codelineno-35-62"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:09<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-63" id="__codelineno-35-63" name="__codelineno-35-63"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">5</span>.
<a href="#__codelineno-35-64" id="__codelineno-35-64" name="__codelineno-35-64"></a><span class="m">5</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">62</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-35-65" id="__codelineno-35-65" name="__codelineno-35-65"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:09<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-66" id="__codelineno-35-66" name="__codelineno-35-66"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">7</span>.
<a href="#__codelineno-35-67" id="__codelineno-35-67" name="__codelineno-35-67"></a><span class="m">6</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">75</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-35-68" id="__codelineno-35-68" name="__codelineno-35-68"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:24:21<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-69" id="__codelineno-35-69" name="__codelineno-35-69"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">1</span>.
<a href="#__codelineno-35-70" id="__codelineno-35-70" name="__codelineno-35-70"></a><span class="m">7</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">88</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-35-71" id="__codelineno-35-71" name="__codelineno-35-71"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-35-72" id="__codelineno-35-72" name="__codelineno-35-72"></a>
<a href="#__codelineno-35-73" id="__codelineno-35-73" name="__codelineno-35-73"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:24:21<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-74" id="__codelineno-35-74" name="__codelineno-35-74"></a>localrule<span class="w"> </span>all:
<a href="#__codelineno-35-75" id="__codelineno-35-75" name="__codelineno-35-75"></a><span class="w">    </span>input:<span class="w"> </span>../results/multiqc_report.html,<span class="w"> </span>../results/trimmed/NA24631_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24695_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24694_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24631_2_val_2.fq.gz,<span class="w"> </span>../results/trimmed/NA24695_2_val_2.fq.gz,<span class="w"> </span>../results/trimmed/NA24694_2_val_2.fq.gz
<a href="#__codelineno-35-76" id="__codelineno-35-76" name="__codelineno-35-76"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-35-77" id="__codelineno-35-77" name="__codelineno-35-77"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">mem_mb</span><span class="o">=</span><span class="m">512</span>,<span class="w"> </span><span class="nv">disk_mb</span><span class="o">=</span><span class="m">1000</span>,<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281,<span class="w"> </span><span class="nv">cpus</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">time_min</span><span class="o">=</span><span class="m">10</span>
<a href="#__codelineno-35-78" id="__codelineno-35-78" name="__codelineno-35-78"></a>
<a href="#__codelineno-35-79" id="__codelineno-35-79" name="__codelineno-35-79"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:24:21<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-35-80" id="__codelineno-35-80" name="__codelineno-35-80"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">0</span>.
<a href="#__codelineno-35-81" id="__codelineno-35-81" name="__codelineno-35-81"></a><span class="m">8</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">100</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-35-82" id="__codelineno-35-82" name="__codelineno-35-82"></a>Complete<span class="w"> </span>log:<span class="w"> </span>.snakemake/log/2022-05-11T132052.454902.snakemake.log
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot12" content=e4dot12%}
<br/></p>
<h2 id="45-create-temporary-files">4.5 Create temporary files<a class="headerlink" href="#45-create-temporary-files" title="Permanent link">¶</a></h2>
<p>In our workflow, we are likely to be creating files that we don't want, but are used or produced by our workflow (intermediate files). We can mark such files as temporary so Snakemake will remove the file once it doesn't need to use it anymore.</p>
<p>For example, we might not want to keep our fastqc output files since our multiqc report merges all of our fastqc reports for each sample into one report. Let's have a look at the files currently produced by our workflow with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>../results/fastqc/
</code></pre></div>
<p>My output:</p>
<p>{% capture e4dot13 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a>total<span class="w"> </span><span class="m">4</span>.5M
<a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>250K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_1_fastqc.html
<a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_1_fastqc.zip
<a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>249K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_2_fastqc.html
<a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_2_fastqc.zip
<a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>254K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_1_fastqc.html
<a href="#__codelineno-37-7" id="__codelineno-37-7" name="__codelineno-37-7"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>334K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_1_fastqc.zip
<a href="#__codelineno-37-8" id="__codelineno-37-8" name="__codelineno-37-8"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>250K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_2_fastqc.html
<a href="#__codelineno-37-9" id="__codelineno-37-9" name="__codelineno-37-9"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_2_fastqc.zip
<a href="#__codelineno-37-10" id="__codelineno-37-10" name="__codelineno-37-10"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>252K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_1_fastqc.html
<a href="#__codelineno-37-11" id="__codelineno-37-11" name="__codelineno-37-11"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_1_fastqc.zip
<a href="#__codelineno-37-12" id="__codelineno-37-12" name="__codelineno-37-12"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>253K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_2_fastqc.html
<a href="#__codelineno-37-13" id="__codelineno-37-13" name="__codelineno-37-13"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>330K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_2_fastqc.zip
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot13" content=e4dot13%}
<br/></p>
<p>Let's mark all the trimmed fastq files as temporary in our Snakefile by wrapping it up in the <code>temp()</code> function</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a># define our configuration file
<a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a>configfile: "../config/config.yaml"
<a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a>
<a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a># define samples from data directory using wildcards
<a href="#__codelineno-38-5" id="__codelineno-38-5" name="__codelineno-38-5"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-38-6" id="__codelineno-38-6" name="__codelineno-38-6"></a>
<a href="#__codelineno-38-7" id="__codelineno-38-7" name="__codelineno-38-7"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-38-8" id="__codelineno-38-8" name="__codelineno-38-8"></a>rule all:
<a href="#__codelineno-38-9" id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="w"> </span>   input:
<a href="#__codelineno-38-10" id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="w"> </span>       "../results/multiqc_report.html",
<a href="#__codelineno-38-11" id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="w"> </span>       expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-38-12" id="__codelineno-38-12" name="__codelineno-38-12"></a>
<a href="#__codelineno-38-13" id="__codelineno-38-13" name="__codelineno-38-13"></a># workflow
<a href="#__codelineno-38-14" id="__codelineno-38-14" name="__codelineno-38-14"></a>rule fastqc:
<a href="#__codelineno-38-15" id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="w"> </span>   input:
<a href="#__codelineno-38-16" id="__codelineno-38-16" name="__codelineno-38-16"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-38-17" id="__codelineno-38-17" name="__codelineno-38-17"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-38-18" id="__codelineno-38-18" name="__codelineno-38-18"></a><span class="w"> </span>   output:
<a href="#__codelineno-38-19" id="__codelineno-38-19" name="__codelineno-38-19"></a><span class="gd">-       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],</span>
<a href="#__codelineno-38-20" id="__codelineno-38-20" name="__codelineno-38-20"></a><span class="gi">+       html = temp(["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"]),</span>
<a href="#__codelineno-38-21" id="__codelineno-38-21" name="__codelineno-38-21"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-38-22" id="__codelineno-38-22" name="__codelineno-38-22"></a><span class="w"> </span>   params:
<a href="#__codelineno-38-23" id="__codelineno-38-23" name="__codelineno-38-23"></a><span class="w"> </span>       fastqc_params = config['PARAMS']['FASTQC']
<a href="#__codelineno-38-24" id="__codelineno-38-24" name="__codelineno-38-24"></a><span class="w"> </span>   log:
<a href="#__codelineno-38-25" id="__codelineno-38-25" name="__codelineno-38-25"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-38-26" id="__codelineno-38-26" name="__codelineno-38-26"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-38-27" id="__codelineno-38-27" name="__codelineno-38-27"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-38-28" id="__codelineno-38-28" name="__codelineno-38-28"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-38-29" id="__codelineno-38-29" name="__codelineno-38-29"></a><span class="w"> </span>   message:
<a href="#__codelineno-38-30" id="__codelineno-38-30" name="__codelineno-38-30"></a><span class="w"> </span>       "Undertaking quality control checks {input}"
<a href="#__codelineno-38-31" id="__codelineno-38-31" name="__codelineno-38-31"></a><span class="w"> </span>   shell:
<a href="#__codelineno-38-32" id="__codelineno-38-32" name="__codelineno-38-32"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}"
<a href="#__codelineno-38-33" id="__codelineno-38-33" name="__codelineno-38-33"></a>
<a href="#__codelineno-38-34" id="__codelineno-38-34" name="__codelineno-38-34"></a>rule multiqc:
<a href="#__codelineno-38-35" id="__codelineno-38-35" name="__codelineno-38-35"></a><span class="w"> </span>   input:
<a href="#__codelineno-38-36" id="__codelineno-38-36" name="__codelineno-38-36"></a><span class="w"> </span>       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-38-37" id="__codelineno-38-37" name="__codelineno-38-37"></a><span class="w"> </span>   output:
<a href="#__codelineno-38-38" id="__codelineno-38-38" name="__codelineno-38-38"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-38-39" id="__codelineno-38-39" name="__codelineno-38-39"></a><span class="w"> </span>   params:
<a href="#__codelineno-38-40" id="__codelineno-38-40" name="__codelineno-38-40"></a><span class="w"> </span>       multiqc_params = config['PARAMS']['MULTIQC']
<a href="#__codelineno-38-41" id="__codelineno-38-41" name="__codelineno-38-41"></a><span class="w"> </span>   log:
<a href="#__codelineno-38-42" id="__codelineno-38-42" name="__codelineno-38-42"></a><span class="w"> </span>       "logs/multiqc/multiqc.log"
<a href="#__codelineno-38-43" id="__codelineno-38-43" name="__codelineno-38-43"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-38-44" id="__codelineno-38-44" name="__codelineno-38-44"></a><span class="w"> </span>       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-38-45" id="__codelineno-38-45" name="__codelineno-38-45"></a><span class="w"> </span>   message:
<a href="#__codelineno-38-46" id="__codelineno-38-46" name="__codelineno-38-46"></a><span class="w"> </span>       "Compiling a HTML report for quality control checks. Writing to {output}."
<a href="#__codelineno-38-47" id="__codelineno-38-47" name="__codelineno-38-47"></a><span class="w"> </span>   shell:
<a href="#__codelineno-38-48" id="__codelineno-38-48" name="__codelineno-38-48"></a><span class="w"> </span>       "multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}"
<a href="#__codelineno-38-49" id="__codelineno-38-49" name="__codelineno-38-49"></a>
<a href="#__codelineno-38-50" id="__codelineno-38-50" name="__codelineno-38-50"></a>rule trim_galore:
<a href="#__codelineno-38-51" id="__codelineno-38-51" name="__codelineno-38-51"></a><span class="w"> </span>   input:
<a href="#__codelineno-38-52" id="__codelineno-38-52" name="__codelineno-38-52"></a><span class="w"> </span>       ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-38-53" id="__codelineno-38-53" name="__codelineno-38-53"></a><span class="w"> </span>   output:
<a href="#__codelineno-38-54" id="__codelineno-38-54" name="__codelineno-38-54"></a><span class="w"> </span>       ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-38-55" id="__codelineno-38-55" name="__codelineno-38-55"></a><span class="w"> </span>   params:
<a href="#__codelineno-38-56" id="__codelineno-38-56" name="__codelineno-38-56"></a><span class="w"> </span>       "--paired"
<a href="#__codelineno-38-57" id="__codelineno-38-57" name="__codelineno-38-57"></a><span class="w"> </span>   log:
<a href="#__codelineno-38-58" id="__codelineno-38-58" name="__codelineno-38-58"></a><span class="w"> </span>       "logs/trim_galore/{sample}.log"
<a href="#__codelineno-38-59" id="__codelineno-38-59" name="__codelineno-38-59"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-38-60" id="__codelineno-38-60" name="__codelineno-38-60"></a><span class="w"> </span>       "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-38-61" id="__codelineno-38-61" name="__codelineno-38-61"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-38-62" id="__codelineno-38-62" name="__codelineno-38-62"></a><span class="w"> </span>   resources:
<a href="#__codelineno-38-63" id="__codelineno-38-63" name="__codelineno-38-63"></a><span class="w"> </span>       cpus=8
<a href="#__codelineno-38-64" id="__codelineno-38-64" name="__codelineno-38-64"></a><span class="w"> </span>   message:
<a href="#__codelineno-38-65" id="__codelineno-38-65" name="__codelineno-38-65"></a><span class="w"> </span>       "Trimming using these parameter: {params}. Writing logs to {log}. Using {threads} threads."
<a href="#__codelineno-38-66" id="__codelineno-38-66" name="__codelineno-38-66"></a><span class="w"> </span>   shell:
<a href="#__codelineno-38-67" id="__codelineno-38-67" name="__codelineno-38-67"></a><span class="w"> </span>       "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e4dot14 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a># define our configuration file
<a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a>configfile: "../config/config.yaml"
<a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a>
<a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a># define samples from data directory using wildcards
<a href="#__codelineno-39-5" id="__codelineno-39-5" name="__codelineno-39-5"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-39-6" id="__codelineno-39-6" name="__codelineno-39-6"></a>
<a href="#__codelineno-39-7" id="__codelineno-39-7" name="__codelineno-39-7"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-39-8" id="__codelineno-39-8" name="__codelineno-39-8"></a>rule all:
<a href="#__codelineno-39-9" id="__codelineno-39-9" name="__codelineno-39-9"></a>    input:
<a href="#__codelineno-39-10" id="__codelineno-39-10" name="__codelineno-39-10"></a>        "../results/multiqc_report.html",
<a href="#__codelineno-39-11" id="__codelineno-39-11" name="__codelineno-39-11"></a>        expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-39-12" id="__codelineno-39-12" name="__codelineno-39-12"></a>
<a href="#__codelineno-39-13" id="__codelineno-39-13" name="__codelineno-39-13"></a># workflow
<a href="#__codelineno-39-14" id="__codelineno-39-14" name="__codelineno-39-14"></a>rule fastqc:
<a href="#__codelineno-39-15" id="__codelineno-39-15" name="__codelineno-39-15"></a>    input:
<a href="#__codelineno-39-16" id="__codelineno-39-16" name="__codelineno-39-16"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-39-17" id="__codelineno-39-17" name="__codelineno-39-17"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-39-18" id="__codelineno-39-18" name="__codelineno-39-18"></a>    output:
<a href="#__codelineno-39-19" id="__codelineno-39-19" name="__codelineno-39-19"></a>        html = temp(["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"]),
<a href="#__codelineno-39-20" id="__codelineno-39-20" name="__codelineno-39-20"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-39-21" id="__codelineno-39-21" name="__codelineno-39-21"></a>    params:
<a href="#__codelineno-39-22" id="__codelineno-39-22" name="__codelineno-39-22"></a>        fastqc_params = config['PARAMS']['FASTQC']
<a href="#__codelineno-39-23" id="__codelineno-39-23" name="__codelineno-39-23"></a>    log:
<a href="#__codelineno-39-24" id="__codelineno-39-24" name="__codelineno-39-24"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-39-25" id="__codelineno-39-25" name="__codelineno-39-25"></a>    threads: 2
<a href="#__codelineno-39-26" id="__codelineno-39-26" name="__codelineno-39-26"></a>    envmodules:
<a href="#__codelineno-39-27" id="__codelineno-39-27" name="__codelineno-39-27"></a>        "FastQC/0.11.9"
<a href="#__codelineno-39-28" id="__codelineno-39-28" name="__codelineno-39-28"></a>    message:
<a href="#__codelineno-39-29" id="__codelineno-39-29" name="__codelineno-39-29"></a>        "Undertaking quality control checks {input}"
<a href="#__codelineno-39-30" id="__codelineno-39-30" name="__codelineno-39-30"></a>    shell:
<a href="#__codelineno-39-31" id="__codelineno-39-31" name="__codelineno-39-31"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}"
<a href="#__codelineno-39-32" id="__codelineno-39-32" name="__codelineno-39-32"></a>
<a href="#__codelineno-39-33" id="__codelineno-39-33" name="__codelineno-39-33"></a>rule multiqc:
<a href="#__codelineno-39-34" id="__codelineno-39-34" name="__codelineno-39-34"></a>    input:
<a href="#__codelineno-39-35" id="__codelineno-39-35" name="__codelineno-39-35"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-39-36" id="__codelineno-39-36" name="__codelineno-39-36"></a>    output:
<a href="#__codelineno-39-37" id="__codelineno-39-37" name="__codelineno-39-37"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-39-38" id="__codelineno-39-38" name="__codelineno-39-38"></a>    params:
<a href="#__codelineno-39-39" id="__codelineno-39-39" name="__codelineno-39-39"></a>        multiqc_params = config['PARAMS']['MULTIQC']
<a href="#__codelineno-39-40" id="__codelineno-39-40" name="__codelineno-39-40"></a>    log:
<a href="#__codelineno-39-41" id="__codelineno-39-41" name="__codelineno-39-41"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-39-42" id="__codelineno-39-42" name="__codelineno-39-42"></a>    envmodules:
<a href="#__codelineno-39-43" id="__codelineno-39-43" name="__codelineno-39-43"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-39-44" id="__codelineno-39-44" name="__codelineno-39-44"></a>    message:
<a href="#__codelineno-39-45" id="__codelineno-39-45" name="__codelineno-39-45"></a>        "Compiling a HTML report for quality control checks. Writing to {output}."
<a href="#__codelineno-39-46" id="__codelineno-39-46" name="__codelineno-39-46"></a>    shell:
<a href="#__codelineno-39-47" id="__codelineno-39-47" name="__codelineno-39-47"></a>        "multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}"
<a href="#__codelineno-39-48" id="__codelineno-39-48" name="__codelineno-39-48"></a>
<a href="#__codelineno-39-49" id="__codelineno-39-49" name="__codelineno-39-49"></a>rule trim_galore:
<a href="#__codelineno-39-50" id="__codelineno-39-50" name="__codelineno-39-50"></a>    input:
<a href="#__codelineno-39-51" id="__codelineno-39-51" name="__codelineno-39-51"></a>        ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-39-52" id="__codelineno-39-52" name="__codelineno-39-52"></a>    output:
<a href="#__codelineno-39-53" id="__codelineno-39-53" name="__codelineno-39-53"></a>        ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-39-54" id="__codelineno-39-54" name="__codelineno-39-54"></a>    params:
<a href="#__codelineno-39-55" id="__codelineno-39-55" name="__codelineno-39-55"></a>        "--paired"
<a href="#__codelineno-39-56" id="__codelineno-39-56" name="__codelineno-39-56"></a>    log:
<a href="#__codelineno-39-57" id="__codelineno-39-57" name="__codelineno-39-57"></a>        "logs/trim_galore/{sample}.log"
<a href="#__codelineno-39-58" id="__codelineno-39-58" name="__codelineno-39-58"></a>    envmodules:
<a href="#__codelineno-39-59" id="__codelineno-39-59" name="__codelineno-39-59"></a>        "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-39-60" id="__codelineno-39-60" name="__codelineno-39-60"></a>    threads: 2
<a href="#__codelineno-39-61" id="__codelineno-39-61" name="__codelineno-39-61"></a>    resources:
<a href="#__codelineno-39-62" id="__codelineno-39-62" name="__codelineno-39-62"></a>        cpus=8
<a href="#__codelineno-39-63" id="__codelineno-39-63" name="__codelineno-39-63"></a>    message:
<a href="#__codelineno-39-64" id="__codelineno-39-64" name="__codelineno-39-64"></a>        "Trimming using these parameter: {params}. Writing logs to {log}. Using {threads} threads."
<a href="#__codelineno-39-65" id="__codelineno-39-65" name="__codelineno-39-65"></a>    shell:
<a href="#__codelineno-39-66" id="__codelineno-39-66" name="__codelineno-39-66"></a>        "trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot14" content=e4dot14%}
<br/></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a># remove output of last run
<a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a>rm -r ../results/*
<a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a>
<a href="#__codelineno-40-4" id="__codelineno-40-4" name="__codelineno-40-4"></a># run dryrun/run again
<a href="#__codelineno-40-5" id="__codelineno-40-5" name="__codelineno-40-5"></a>snakemake --dryrun --profile slurm --use-envmodules
<a href="#__codelineno-40-6" id="__codelineno-40-6" name="__codelineno-40-6"></a>snakemake --profile slurm --use-envmodules
</code></pre></div>
<p>Now when we have a look at the <code>../results/fastqc/</code> directory with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>../results/fastqc/
</code></pre></div>
<p>These html files have been removed once Snakemake no longer needs the files for another rule/operation, and we've saved some space on our computer (from 4.5 megabytes to 3 megabytes in this directory).</p>
<p>My output:</p>
<p>{% capture e4dot15 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a>total<span class="w"> </span><span class="m">3</span>.0M
<a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24631_1_fastqc.zip
<a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24631_2_fastqc.zip
<a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>334K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24694_1_fastqc.zip
<a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24694_2_fastqc.zip
<a href="#__codelineno-42-6" id="__codelineno-42-6" name="__codelineno-42-6"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24695_1_fastqc.zip
<a href="#__codelineno-42-7" id="__codelineno-42-7" name="__codelineno-42-7"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>330K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24695_2_fastqc.zip
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot15" content=e4dot15%}
<br/></p>
<p><em>This becomes particularly important when our data become big data, since we don't want to keep any massive intermediate output files that we don't need. Otherwise this can start to clog up the memory on our computer. It ensures our workflow is scalable when our data becomes big data.</em></p>
<h2 id="46-generating-a-snakemake-report">4.6 Generating a snakemake report<a class="headerlink" href="#46-generating-a-snakemake-report" title="Permanent link">¶</a></h2>
<p>With Snakemake, we can automatically generate detailed self-contained HTML reports after we run our workflow with the following command:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a>snakemake<span class="w"> </span>--report<span class="w"> </span>../results/snakemake_report.html
</code></pre></div>
<p><em>Note. you won't be able to view a rendered version of this html while it is on the remote server, however after you transfer it to your local computer you should be able to view it in your web browser</em></p>
<p>In our report:</p>
<ul>
<li>We get an interactive version of our directed acyclic graph (DAG).</li>
<li>When you click on a node in the DAG, the input and output files are fully outlined, the exact software used and the exact shell command that was run.</li>
<li>You are also provided with runtime information under the <code>Statistics</code> tab outlining how long each rule/sample ran for, and the date/time each file was created.</li>
</ul>
<p>My report:</p>
<p>{% capture e4dot16 %}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/snakemake_report.gif"><img alt="snakemake_report" src="../images/snakemake_report.gif"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot16" content=e4dot16%}
<br/></p>
<p>These reports are highly configurable, have a look at an example of what can be done with a report <a href="https://koesterlab.github.io/resources/report.html">here</a></p>
<p><em>See more information on creating Snakemake reports <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/reporting.html">in the Snakemake documentation</a></em></p>
<h2 id="47-linting-your-workflow">4.7 Linting your workflow<a class="headerlink" href="#47-linting-your-workflow" title="Permanent link">¶</a></h2>
<p>Snakemake has a built in linter to support you building best practice workflows, let's try it out:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a>snakemake<span class="w"> </span>--lint
</code></pre></div>
<p>My output:</p>
<p>{% capture e4dot17 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a>Lints<span class="w"> </span><span class="k">for</span><span class="w"> </span>rule<span class="w"> </span>fastqc<span class="w"> </span><span class="o">(</span>line<span class="w"> </span><span class="m">21</span>,<span class="w"> </span>/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile<span class="o">)</span>:
<a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="w">    </span>*<span class="w"> </span>Additionally<span class="w"> </span>specify<span class="w"> </span>a<span class="w"> </span>conda<span class="w"> </span>environment<span class="w"> </span>or<span class="w"> </span>container<span class="w"> </span><span class="k">for</span><span class="w"> </span>each<span class="w"> </span>rule,<span class="w"> </span>environment<span class="w"> </span>modules<span class="w"> </span>are<span class="w"> </span>not<span class="w"> </span>enough:
<a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="w">      </span>While<span class="w"> </span>environment<span class="w"> </span>modules<span class="w"> </span>allow<span class="w"> </span>to<span class="w"> </span>document<span class="w"> </span>and<span class="w"> </span>deploy<span class="w"> </span>the<span class="w"> </span>required<span class="w"> </span>software<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>certain<span class="w"> </span>platform,<span class="w"> </span>they<span class="w"> </span>lock<span class="w"> </span>your<span class="w"> </span>workflow<span class="w"> </span><span class="k">in</span><span class="w"> </span>there,<span class="w"> </span>disabling<span class="w"> </span>easy<span class="w"> </span>reproducibility<span class="w"> </span>on
<a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">      </span>other<span class="w"> </span>machines<span class="w"> </span>that<span class="w"> </span>don<span class="s1">'t have exactly the same environment modules. Hence env modules (which might be beneficial in certain cluster environments), should allways be</span>
<a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="s1">      complemented with equivalent conda environments.</span>
<a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="s1">      Also see:</span>
<a href="#__codelineno-45-7" id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="s1">      https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#integrated-package-management</span>
<a href="#__codelineno-45-8" id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="s1">      https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#running-jobs-in-containers</span>
<a href="#__codelineno-45-9" id="__codelineno-45-9" name="__codelineno-45-9"></a>
<a href="#__codelineno-45-10" id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="s1">Lints for rule multiqc (line 61, /scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile):</span>
<a href="#__codelineno-45-11" id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="s1">    * Additionally specify a conda environment or container for each rule, environment modules are not enough:</span>
<a href="#__codelineno-45-12" id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="s1">      While environment modules allow to document and deploy the required software on a certain platform, they lock your workflow in there, disabling easy reproducibility on</span>
<a href="#__codelineno-45-13" id="__codelineno-45-13" name="__codelineno-45-13"></a><span class="s1">      other machines that don'</span>t<span class="w"> </span>have<span class="w"> </span>exactly<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>environment<span class="w"> </span>modules.<span class="w"> </span>Hence<span class="w"> </span>env<span class="w"> </span>modules<span class="w"> </span><span class="o">(</span>which<span class="w"> </span>might<span class="w"> </span>be<span class="w"> </span>beneficial<span class="w"> </span><span class="k">in</span><span class="w"> </span>certain<span class="w"> </span>cluster<span class="w"> </span>environments<span class="o">)</span>,<span class="w"> </span>should<span class="w"> </span>allways<span class="w"> </span>be
<a href="#__codelineno-45-14" id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="w">      </span>complemented<span class="w"> </span>with<span class="w"> </span>equivalent<span class="w"> </span>conda<span class="w"> </span>environments.
<a href="#__codelineno-45-15" id="__codelineno-45-15" name="__codelineno-45-15"></a><span class="w">      </span>Also<span class="w"> </span>see:
<a href="#__codelineno-45-16" id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="w">      </span>https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#integrated-package-management
<a href="#__codelineno-45-17" id="__codelineno-45-17" name="__codelineno-45-17"></a><span class="w">      </span>https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#running-jobs-in-containers
<a href="#__codelineno-45-18" id="__codelineno-45-18" name="__codelineno-45-18"></a>
<a href="#__codelineno-45-19" id="__codelineno-45-19" name="__codelineno-45-19"></a>Lints<span class="w"> </span><span class="k">for</span><span class="w"> </span>rule<span class="w"> </span>trim_galore<span class="w"> </span><span class="o">(</span>line<span class="w"> </span><span class="m">96</span>,<span class="w"> </span>/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile<span class="o">)</span>:
<a href="#__codelineno-45-20" id="__codelineno-45-20" name="__codelineno-45-20"></a><span class="w">    </span>*<span class="w"> </span>Additionally<span class="w"> </span>specify<span class="w"> </span>a<span class="w"> </span>conda<span class="w"> </span>environment<span class="w"> </span>or<span class="w"> </span>container<span class="w"> </span><span class="k">for</span><span class="w"> </span>each<span class="w"> </span>rule,<span class="w"> </span>environment<span class="w"> </span>modules<span class="w"> </span>are<span class="w"> </span>not<span class="w"> </span>enough:
<a href="#__codelineno-45-21" id="__codelineno-45-21" name="__codelineno-45-21"></a><span class="w">      </span>While<span class="w"> </span>environment<span class="w"> </span>modules<span class="w"> </span>allow<span class="w"> </span>to<span class="w"> </span>document<span class="w"> </span>and<span class="w"> </span>deploy<span class="w"> </span>the<span class="w"> </span>required<span class="w"> </span>software<span class="w"> </span>on<span class="w"> </span>a<span class="w"> </span>certain<span class="w"> </span>platform,<span class="w"> </span>they<span class="w"> </span>lock<span class="w"> </span>your<span class="w"> </span>workflow<span class="w"> </span><span class="k">in</span><span class="w"> </span>there,<span class="w"> </span>disabling<span class="w"> </span>easy<span class="w"> </span>reproducibility<span class="w"> </span>on
<a href="#__codelineno-45-22" id="__codelineno-45-22" name="__codelineno-45-22"></a><span class="w">      </span>other<span class="w"> </span>machines<span class="w"> </span>that<span class="w"> </span>don<span class="err">'</span>t<span class="w"> </span>have<span class="w"> </span>exactly<span class="w"> </span>the<span class="w"> </span>same<span class="w"> </span>environment<span class="w"> </span>modules.<span class="w"> </span>Hence<span class="w"> </span>env<span class="w"> </span>modules<span class="w"> </span><span class="o">(</span>which<span class="w"> </span>might<span class="w"> </span>be<span class="w"> </span>beneficial<span class="w"> </span><span class="k">in</span><span class="w"> </span>certain<span class="w"> </span>cluster<span class="w"> </span>environments<span class="o">)</span>,<span class="w"> </span>should<span class="w"> </span>allways<span class="w"> </span>be
<a href="#__codelineno-45-23" id="__codelineno-45-23" name="__codelineno-45-23"></a><span class="w">      </span>complemented<span class="w"> </span>with<span class="w"> </span>equivalent<span class="w"> </span>conda<span class="w"> </span>environments.
<a href="#__codelineno-45-24" id="__codelineno-45-24" name="__codelineno-45-24"></a><span class="w">      </span>Also<span class="w"> </span>see:
<a href="#__codelineno-45-25" id="__codelineno-45-25" name="__codelineno-45-25"></a><span class="w">      </span>https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#integrated-package-management
<a href="#__codelineno-45-26" id="__codelineno-45-26" name="__codelineno-45-26"></a><span class="w">      </span>https://snakemake.readthedocs.io/en/latest/snakefiles/deployment.html#running-jobs-in-containers
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e4dot17" content=e4dot17%}
<br/></p>
<p>We have a few things we could improve in our workflow!</p>
<p>Writing a best practice workflow is more important than having Marie Kondo level tidiness, it increases the chance your workflow will continue to be used and maintained by others (and ourselves), making the code we write useful (it's exciting seeing someone else using your code!). If your workflow was used in scientific research, it makes your workflow accessible for people to reproduce your research findings; it isn't going to be a nightmare for them to run and they are more likely to try and have success doing so.</p>
<p>Read more about the <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/best_practices.html">best practices for Snakemake</a></p>
<h1 id="takeaways">Takeaways<a class="headerlink" href="#takeaways" title="Permanent link">¶</a></h1>
<hr/>
<ul>
<li>Pull out your parameters and put them in <code>params:</code> directive</li>
<li>Pulling the user configurable options away from the core workflow will support reproducibility by reducing the chance of changes to the core workflow</li>
<li>Leaving messages for the user of your workflow will help them understand what is happening at each stage and follow the workflows progress</li>
<li>Mark files you won't need once the workflow completes to reduce the memory usage - <em>particularly</em> when dealing with big data</li>
<li>Generate a snakemake report to get a summary of the workflow run - these are highly configurable</li>
<li>Lint your workflow and check it complies with best practices - this supports reproducibility and portability</li>
<li>There is so much more to explore, such as creating <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/modularization.html">modular workflows</a>, automatically grabbing <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/remote_files.html">remote files</a> from places like Google Cloud Storage and Dropbox, <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#external-scripts">run various types of scripts</a> such as <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#python">python scripts</a>, <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#r-and-r-markdown">R and RMarkdown scripts</a> and <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#jupyter-notebook-integration">Jupyter Notebooks</a></li>
</ul>
<hr/>
<h1 id="summary-commands">Summary commands<a class="headerlink" href="#summary-commands" title="Permanent link">¶</a></h1>
<p>Use the parameter directive (<code>params</code>) to keep the parameters and flags of your programs separate from your shell command, for example:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a>params:
<a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="w">    </span><span class="s2">"--paired"</span>
</code></pre></div>
<p>Run your snakemake workflow (using environment modules to load your software AND with a configuration file) with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules<span class="w"> </span>--configfile<span class="w"> </span>../config/config.yaml
</code></pre></div>
<p>Alternatively, define your config file in the Snakefile:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a>configfile:<span class="w"> </span><span class="s2">"../config/config.yaml"</span>
</code></pre></div>
<p>Use the <code>message</code> directive to provide information to the user on what is happening real time, for example:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a>message:
<a href="#__codelineno-49-2" id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="w">    </span><span class="s2">"Undertaking quality control checks {input}"</span>
</code></pre></div>
<p>Mark temporary files to remove (once they are no longer needed by the workflow) with <code>temp()</code>, for example:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a>temp<span class="o">([</span><span class="s2">"../results/trimmed/{sample}_1_val_1.fq.gz"</span>,<span class="w"> </span><span class="s2">"../results/trimmed/{sample}_2_val_2.fq.gz"</span><span class="o">])</span>
</code></pre></div>
<p>Create a basic interactive Snakemake report after running your workflow with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a>snakemake<span class="w"> </span>--report<span class="w"> </span>../results/snakemake_report.html
</code></pre></div>
<h1 id="our-final-snakemake-workflow">Our final snakemake workflow!<a class="headerlink" href="#our-final-snakemake-workflow" title="Permanent link">¶</a></h1>
<p>See <a href="https://github.com/nesi/snakemake_workshop/tree/main/leveled_up_demo_workflow">leveled_up_demo_workflow</a> for the final Snakemake workflow we've created up to this point</p>
<hr/>
<p style="text-align:left;">
<b><a class="btn" href="https://nesi.github.io/snakemake_workshop/workshop_material/03_create_a_basic_workflow.html" style="background: var(--bs-green);font-weight:bold">« 3 - Creating a Basic WF</a></b>
<span style="float:right;">
<b><a class="btn" href="https://nesi.github.io/snakemake_workshop/workshop_material/05_we_want_more.html" style="background: var(--bs-green);font-weight:bold">5 - More »</a></b>
</span>
</p>
<p align="center"><b><a class="btn" href="https://nesi.github.io/snakemake_workshop/" style="background: var(--bs-dark);font-weight:bold">Back to homepage</a></b></p>
</article>
</div>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: 03 - Create a basic workflow" class="md-footer__link md-footer__link--prev" href="../03_create_a_basic_workflow/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                03 - Create a basic workflow
              </div>
</div>
</a>
<a aria-label="Next: 05 - We want more!" class="md-footer__link md-footer__link--next" href="../05_we_want_more/" rel="next">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                05 - We want more!
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Snakemake workshop material is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="noopener" target="_blank">Creative Commons Attribution license</a>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>