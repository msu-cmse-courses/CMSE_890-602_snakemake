
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://msu-cmse-courses.github.io/CMSE_890-602_snakemake/workshop_material/04_leveling_up_your_workflow/">
      
      
        <link rel="prev" href="../03_create_a_basic_workflow/">
      
      
        <link rel="next" href="../05_we_want_more/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>04 - Leveling up your workflow! - Automate Your Workflow With Snakemake</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Mukta";--md-code-font:"Fira Code"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#04-leveling-up-your-workflow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
<!-- Custom Banner -->
<!-- <div class="banner">
    <p style="color:white; display:inline;font-size: 160%;">This repository is in the early stages of development (Beta Version)</p>
</div> -->

<!-- Original Header -->


  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Automate Your Workflow With Snakemake" class="md-header__button md-logo" aria-label="Automate Your Workflow With Snakemake" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Automate Your Workflow With Snakemake
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              04 - Leveling up your workflow!
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/msu-cmse-courses/CMSE_890-602_snakemake" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    msu-cmse-courses/CMSE_890-602_snakemake
  </div>
</a>
      </div>
    
  </nav>
  
</header>

    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Automate Your Workflow With Snakemake" class="md-nav__button md-logo" aria-label="Automate Your Workflow With Snakemake" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Automate Your Workflow With Snakemake
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/msu-cmse-courses/CMSE_890-602_snakemake" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    msu-cmse-courses/CMSE_890-602_snakemake
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Workshop material
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Workshop material
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    01 - Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    02 - Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03_create_a_basic_workflow/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    03 - Create a basic workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    04 - Leveling up your workflow!
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    04 - Leveling up your workflow!
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#catching-up" class="md-nav__link">
    <span class="md-ellipsis">
      Catching up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#41-use-a-profile-for-hpc" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Use a profile for HPC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 Use a profile for HPC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snakemake-slurm-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Snakemake-SLURM communication
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-pull-out-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 Pull out parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-pull-out-user-configurable-options" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 Pull out user configurable options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-leave-messages-for-the-user" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 Leave messages for the user
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#45-create-temporary-files" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 Create temporary files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#46-generating-a-snakemake-report" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 Generating a snakemake report
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#47-linting-your-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      4.7 Linting your workflow
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05_we_want_more/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    05 - We want more!
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#catching-up" class="md-nav__link">
    <span class="md-ellipsis">
      Catching up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#41-use-a-profile-for-hpc" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 Use a profile for HPC
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4.1 Use a profile for HPC">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#logging" class="md-nav__link">
    <span class="md-ellipsis">
      Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snakemake-slurm-communication" class="md-nav__link">
    <span class="md-ellipsis">
      Snakemake-SLURM communication
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#42-pull-out-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 Pull out parameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#43-pull-out-user-configurable-options" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 Pull out user configurable options
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#44-leave-messages-for-the-user" class="md-nav__link">
    <span class="md-ellipsis">
      4.4 Leave messages for the user
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#45-create-temporary-files" class="md-nav__link">
    <span class="md-ellipsis">
      4.5 Create temporary files
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#46-generating-a-snakemake-report" class="md-nav__link">
    <span class="md-ellipsis">
      4.6 Generating a snakemake report
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#47-linting-your-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      4.7 Linting your workflow
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="04-leveling-up-your-workflow">04 - Leveling up your workflow!<a class="headerlink" href="#04-leveling-up-your-workflow" title="Permanent link">&para;</a></h1>
<h2 id="catching-up">Catching up<a class="headerlink" href="#catching-up" title="Permanent link">&para;</a></h2>
<div class="admonition file-code">
<p class="admonition-title">From section 03, you should have the following Snakefile:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="c1"># workflow</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>        <span class="s2">&quot;envs/fastqc.yaml&quot;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>        <span class="s2">&quot;envs/multiqc.yaml&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>        <span class="s2">&quot;envs/trimgalore.yaml&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ --paired --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</div>
<p><br></p>
<h2 id="41-use-a-profile-for-hpc">4.1 Use a profile for HPC<a class="headerlink" href="#41-use-a-profile-for-hpc" title="Permanent link">&para;</a></h2>
<p>In section 3.16, we have seen that a snakemake workflow can be run on an HPC cluster.
To reduce the boilerplate, we can use a <a href="https://snakemake.readthedocs.io/en/stable/executing/cli.html#profiles">configuration profile</a> to configure default options.
In this case, we use it to set the <code>--executor</code> and the <code>--jobs</code> options.
Default resources for all rules should be set using the <code>default-resources</code> option.</p>
<div class="admonition terminal-2">
<p class="admonition-title">Make a <code>slurm</code> profile folder</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># create the profile folder inside demo_workflow/workflow</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>demo_workflow/workflow
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>mkdir<span class="w"> </span>slurm
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>touch<span class="w"> </span>slurm/config.yaml
</code></pre></div>
</div>
<div class="admonition file-code">
<p class="admonition-title">write the following to config.yaml</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>jobs:<span class="w"> </span><span class="m">20</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>executor:<span class="w"> </span>slurm
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>default-resources:
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span>runtime:<span class="w"> </span><span class="m">10</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span>mem_mb:<span class="w"> </span><span class="m">512</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span>cpus_per_task:<span class="w"> </span><span class="m">8</span>
</code></pre></div>
</div>
<div class="admonition terminal-2">
<p class="admonition-title">Then run the snakemake workflow using the <code>slurm</code> profile</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># run dryrun/run again</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--workflow-profile<span class="w"> </span>slurm<span class="w"> </span>--software-deployment-method<span class="w"> </span>conda
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>snakemake<span class="w"> </span>--workflow-profile<span class="w"> </span>slurm<span class="w"> </span>--software-deployment-method<span class="w"> </span>conda
</code></pre></div></p>
</div>
<div class="admonition failure">
<p class="admonition-title">Possible error</p>
<p>You may get errors like this:
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Error executing rule trim_galore on cluster (jobid: 6, external: 25266818, jobscript: /mnt/ufs18/home-081/fullarda/CMSE_890-602_snakemake/demo_workflow/workflow/.snakemake/tmp.yebsz1sm/snakejob.trim_galore.6.sh). For error details see the cluster log and the log files of the involved rule(s).
</code></pre></div>
The "cluster log" is the SLURM output log of the job. If you read the SLURM logs, it may show errors like this:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>MissingOutputException in rule trim_galore in file /mnt/ufs18/home-081/fullarda/CMSE_890-602_snakemake/demo_workflow/workflow/Snakefile, line 49:
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>Job 0 completed successfully, but some output files are missing. Missing files after 5 seconds. This might be due to filesystem latency. If that is the case, consider to increase the wait time with --latency-wait.
</code></pre></div></p>
<p>To resolve this, add <code>--latency-wait 30</code> to increase the wait time to 30s. This value can be increased further if needed.</p>
</div>
<p>If you interrupt the execution of a snakemake workflow using <KBD>CTRL+C</KBD>, the SLURM executor plugin will automatically cancel the jobs.</p>
<p>You can specify different resources (memory, cpus, gpus, etc.) for each rule in the workflow.</p>
<p>Here we give more CPU resources to <code>trim_galore</code> to make it run faster.</p>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a># define samples from data directory using wildcards
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>rule all:
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w"> </span>   input:
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a># workflow
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>rule fastqc:
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w"> </span>   input:
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w"> </span>   output:
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w"> </span>   log:
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w"> </span>   conda:
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w"> </span>       &quot;envs/fastqc.yaml&quot;
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w"> </span>   shell:
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}&quot;
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a>rule multiqc:
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w"> </span>   input:
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w"> </span>   output:
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w"> </span>   log:
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w"> </span>   conda:
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w"> </span>       &quot;envs/multiqc.yaml&quot;
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w"> </span>   shell:
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ &amp;&gt; {log}&quot;
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>rule trim_galore:
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w"> </span>   input:
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w"> </span>   output:
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w"> </span>   log:
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w"> </span>   conda:
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="w"> </span>       &quot;envs/trimgalore.yaml&quot;
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="gi">+   resources:</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="gi">+       cpus_per_task=8</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="w"> </span>   shell:
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ --paired --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="c1"># workflow</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>        <span class="s2">&quot;envs/fastqc.yaml&quot;</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>        <span class="s2">&quot;envs/multiqc.yaml&quot;</span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>        <span class="s2">&quot;envs/trimgalore.yaml&quot;</span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>        <span class="n">cpus_per_task</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ --paired --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal-2">
<p class="admonition-title">Run the workflow again</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a># run dryrun/run again
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>snakemake --dryrun --workflow-profile slurm --software-deployment-method conda
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>snakemake<span class="w"> </span>--workflow-profile<span class="w"> </span>slurm<span class="w"> </span>--software-deployment-method<span class="w"> </span>conda
</code></pre></div></p>
<ul>
<li>If you monitor the progress of your jobs using <code>squeue --me -o "%.7i %9P %35j %.8u %.2t %.12M %.12L %.5C %.7m %.4D %R"</code>, you will notice that some jobs now request 2 or 8 CPUs.</li>
</ul>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>JOBID         USER     ACCOUNT   NAME        CPUS MIN_MEM PARTITI START_TIME     TIME_LEFT STATE    NODELIST(REASON)
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>26763281      lkemp    nesi99991 spawner-jupy   4      4G interac 2022-05-11T1     7:21:18 RUNNING  wbn003
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>26763492      lkemp    nesi99991 snakejob.fas   2    512M large   2022-05-11T1        9:59 RUNNING  wbn144
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>26763493      lkemp    nesi99991 snakejob.tri   8    512M large   2022-05-11T1        9:59 RUNNING  wbn212
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>26763494      lkemp    nesi99991 snakejob.fas   2    512M large   2022-05-11T1        9:59 RUNNING  wbn145
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>26763495      lkemp    nesi99991 snakejob.fas   2    512M large   2022-05-11T1        9:59 RUNNING  wbn146
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>26763496      lkemp    nesi99991 snakejob.tri   8    512M large   2022-05-11T1        9:59 RUNNING  wbn217
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>26763497      lkemp    nesi99991 snakejob.tri   8    512M large   2022-05-11T1        9:59 RUNNING  wbn229
</code></pre></div>
</details>
</div>
<p><br></p>
<h3 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">&para;</a></h3>
<p>SLURM log files for each rule can be found in the workflow's <code>.snakemake/slurm_logs</code> directory.
The SLURM logs are stored separately for each rule within a directory named after the rule.</p>
<h3 id="snakemake-slurm-communication">Snakemake-SLURM communication<a class="headerlink" href="#snakemake-slurm-communication" title="Permanent link">&para;</a></h3>
<p>The SLURM executor plugin tracks job completion, failure and cancellations.
You can request specific numbers of retries in the case of job failures with the
option <code>--retries=N</code> where <code>N</code> is the number of retries per rule.</p>
<p>Alternatively, you can use SLURM itself to handle the requeuing of jobs by adding
<code>--slurm-requeue</code> to the <code>snakemake</code> command or in the workflow profile.</p>
<p>Once all of this is in place, we can:</p>
<div class="admonition quote">
<ul>
<li>submit Slurm jobs with the right resources per Snakemake rule,</li>
<li>cancel the workflow and Slurms jobs using CTRL-C,</li>
<li>keep all slurm jobs log files in a dedicated folder.</li>
</ul>
</div>
<div class="admonition question">
<p class="admonition-title">Exercise</p>
<p>Run the snakemake workflow with Slurm jobs then use <code>scancel JOBID</code> to cancel some Slurm. See how Snakemake reacts.</p>
</div>
<h2 id="42-pull-out-parameters">4.2 Pull out parameters<a class="headerlink" href="#42-pull-out-parameters" title="Permanent link">&para;</a></h2>
<p>We can set parameters for commands using the <code>params</code> rule option so that they can be more human-readable:</p>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a># define samples from data directory using wildcards
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>rule all:
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w"> </span>   input:
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a># workflow
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>rule fastqc:
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w"> </span>   input:
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="w"> </span>   output:
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w"> </span>   log:
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w"> </span>   conda:
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w"> </span>       &quot;envs/fastqc.yaml&quot;
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="w"> </span>   shell:
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}&quot;
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>rule multiqc:
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="w"> </span>   input:
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="w"> </span>   output:
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="w"> </span>   log:
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a><span class="w"> </span>   conda:
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a><span class="w"> </span>       &quot;envs/multiqc.yaml&quot;
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="w"> </span>   shell:
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ &amp;&gt; {log}&quot;
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a>rule trim_galore:
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="w"> </span>   input:
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a><span class="w"> </span>   output:
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a><span class="gi">+   params:</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a><span class="gi">+       &quot;--paired&quot;</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a><span class="w"> </span>   log:
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a><span class="w"> </span>   conda:
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a><span class="w"> </span>       &quot;envs/trimgalore.yaml&quot;
<a id="__codelineno-14-49" name="__codelineno-14-49" href="#__codelineno-14-49"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-14-50" name="__codelineno-14-50" href="#__codelineno-14-50"></a><span class="w"> </span>   resources:
<a id="__codelineno-14-51" name="__codelineno-14-51" href="#__codelineno-14-51"></a><span class="w"> </span>       cpus_per_task=8
<a id="__codelineno-14-52" name="__codelineno-14-52" href="#__codelineno-14-52"></a><span class="w"> </span>   shell:
<a id="__codelineno-14-53" name="__codelineno-14-53" href="#__codelineno-14-53"></a><span class="gd">-       &quot;trim_galore {input} -o ../results/trimmed/ --paired --cores {threads} &amp;&gt; {log}&quot;</span>
<a id="__codelineno-14-54" name="__codelineno-14-54" href="#__codelineno-14-54"></a><span class="gi">+       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;</span>
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="c1"># workflow</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>        <span class="s2">&quot;envs/fastqc.yaml&quot;</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a>        <span class="s2">&quot;envs/multiqc.yaml&quot;</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>        <span class="s2">&quot;envs/trimgalore.yaml&quot;</span>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a>        <span class="n">cpus_per_task</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal-2">
<p class="admonition-title">Run a dryrun to check it works</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a># run dryrun again
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>snakemake --dryrun --workflow-profile slurm --software-deployment-method conda
</code></pre></div></p>
</div>
<h2 id="43-pull-out-user-configurable-options">4.3 Pull out user configurable options<a class="headerlink" href="#43-pull-out-user-configurable-options" title="Permanent link">&para;</a></h2>
<p>We can separate the user configurable options away from the workflow. This supports reproducibility by minimising the chance the user makes changes to the core workflow.</p>
<p>Create a configuration file in a new directory <code>config/</code></p>
<p>File structure:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>demo_workflow/
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">      </span><span class="p">|</span>_______results/
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">      </span><span class="p">|</span>_______workflow/
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______logs/
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______slurm/
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______Snakefile
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">      </span><span class="p">|</span><span class="w">          </span><span class="p">|</span>_______status.py
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">      </span><span class="p">|</span>_______config
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">                 </span><span class="p">|</span>_______config.yaml
</code></pre></div>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># create config directory</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>mkdir<span class="w"> </span>../config
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># create configuration file</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>touch<span class="w"> </span>../config/config.yaml
</code></pre></div></p>
</div>
<p>Now we need to pull out the parameters the user would likely need to configure. Let's give the user the option to pass any parameters they like to fastqc. In our <code>../config/config.yaml</code> file, add the configuration options and add a couple flags to be passed to fastqc and multiqc:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># set software parameters for...</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="nt">PARAMS</span><span class="p">:</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">  </span><span class="c1"># ... fastqc</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">  </span><span class="nt">FASTQC</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;--kmers</span><span class="nv"> </span><span class="s">5&quot;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">  </span><span class="c1"># ... multiqc</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">  </span><span class="nt">MULTIQC</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;--flat&quot;</span>
</code></pre></div>
<details class="code-compare">
<summary>Edit snakefile : In the Snakefile, tell Snakemake to grab the variables <code>PARAMS</code> from <code>../config/config.yaml</code></summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a># define samples from data directory using wildcards
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>rule all:
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w"> </span>   input:
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a># workflow
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>rule fastqc:
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w"> </span>   input:
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="w"> </span>   output:
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="gi">+   params:</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="gi">+       fastqc_params = config[&#39;PARAMS&#39;][&#39;FASTQC&#39;]</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w"> </span>   log:
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="w"> </span>   conda:
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w"> </span>       &quot;envs/fastqc.yaml&quot;
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="w"> </span>   shell:
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="gd">-       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}&quot;</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="gi">+       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}&quot;</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>rule multiqc:
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="w"> </span>   input:
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="w"> </span>   output:
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="gi">+   params:</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="gi">+       multiqc_params = config[&#39;PARAMS&#39;][&#39;MULTIQC&#39;]</span>
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="w"> </span>   log:
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a><span class="w"> </span>   conda:
<a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="w"> </span>       &quot;envs/multiqc.yaml&quot;
<a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a><span class="w"> </span>   shell:
<a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="gd">-       &quot;multiqc {input} -o ../results/ &amp;&gt; {log}&quot;</span>
<a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a><span class="gi">+       &quot;multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}&quot;</span>
<a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a>
<a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a>rule trim_galore:
<a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a><span class="w"> </span>   input:
<a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a><span class="w"> </span>   output:
<a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a><span class="w"> </span>   params:
<a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a><span class="w"> </span>       &quot;--paired&quot;
<a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a><span class="w"> </span>   log:
<a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a><span class="w"> </span>   conda:
<a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a><span class="w"> </span>       &quot;envs/trimgalore.yaml&quot;
<a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a><span class="w"> </span>   resources:
<a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a><span class="w"> </span>       cpus_per_task=8
<a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a><span class="w"> </span>   shell:
<a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="c1"># workflow</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>        <span class="n">fastqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;FASTQC&#39;</span><span class="p">]</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>        <span class="s2">&quot;envs/fastqc.yaml&quot;</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> </span><span class="si">{params.fastqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>        <span class="n">multiqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;MULTIQC&#39;</span><span class="p">]</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>        <span class="s2">&quot;envs/multiqc.yaml&quot;</span>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ </span><span class="si">{params.multiqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a>        <span class="s2">&quot;envs/trimgalore.yaml&quot;</span>
<a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-23-54" name="__codelineno-23-54" href="#__codelineno-23-54"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-23-55" name="__codelineno-23-55" href="#__codelineno-23-55"></a>        <span class="n">cpus_per_task</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-23-56" name="__codelineno-23-56" href="#__codelineno-23-56"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-23-57" name="__codelineno-23-57" href="#__codelineno-23-57"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal-2">
<p class="admonition-title">Let's use our configuration file! Run workflow again:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># run dryrun/run again</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--workflow-profile<span class="w"> </span>slurm<span class="w"> </span>--software-deployment-method<span class="w"> </span>conda
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>snakemake<span class="w"> </span>--workflow-profile<span class="w"> </span>slurm<span class="w"> </span>--software-deployment-method<span class="w"> </span>conda
</code></pre></div></p>
<details class="failure">
<summary>Didn't work? My error:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>KeyError<span class="w"> </span><span class="k">in</span><span class="w"> </span>line<span class="w"> </span><span class="m">19</span><span class="w"> </span>of<span class="w"> </span>/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile:
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="s1">&#39;PARAMS&#39;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/scale_wlg_persistent/filesets/project/nesi99991/snakemake20220512/lkemp/snakemake_workshop/demo_workflow/workflow/Snakefile&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">19</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
</code></pre></div>
</details>
</div>
<p><br></p>
<p>Snakemake can't find our 'Key' - we haven't told Snakemake where our config file is so it can't find our config variables. We can do this by passing the location of our config file to the <code>--configfile</code> flag</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a># run dryrun/run again
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="gd">- snakemake --dryrun --workflow-profile slurm --software-deployment-method conda</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="gd">- snakemake --workflow-profile slurm --software-deployment-method conda</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="gi">+ snakemake --dryrun --workflow-profile slurm --software-deployment-method conda --configfile ../config/config.yaml</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="gi">+ snakemake --workflow-profile slurm --software-deployment-method conda --configfile ../config/config.yaml</span>
</code></pre></div></p>
</div>
<p>Alternatively, we can define our config file in our Snakefile in a situation where the configuration file is likely to always be named the same and be in the exact same location <code>../config/config.yaml</code> and you don't need the flexibility for the user to specify their own configuration files:</p>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a># define our configuration file
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="gi">+ configfile: &quot;../config/config.yaml&quot;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a># define samples from data directory using wildcards
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>rule all:
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="w"> </span>   input:
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a># workflow
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>rule fastqc:
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="w"> </span>   input:
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="w"> </span>   output:
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="w"> </span>   params:
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="w"> </span>       fastqc_params = config[&#39;PARAMS&#39;][&#39;FASTQC&#39;]
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="w"> </span>   log:
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="w"> </span>   conda:
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="w"> </span>       &quot;envs/fastqc.yaml&quot;
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="w"> </span>   shell:
<a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a>
<a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a>rule multiqc:
<a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="w"> </span>   input:
<a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="w"> </span>   output:
<a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a><span class="w"> </span>   params:
<a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="w"> </span>       multiqc_params = config[&#39;PARAMS&#39;][&#39;MULTIQC&#39;]
<a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a><span class="w"> </span>   log:
<a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a><span class="w"> </span>   conda:
<a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a><span class="w"> </span>       &quot;envs/multiqc.yaml&quot;
<a id="__codelineno-30-42" name="__codelineno-30-42" href="#__codelineno-30-42"></a><span class="w"> </span>   shell:
<a id="__codelineno-30-43" name="__codelineno-30-43" href="#__codelineno-30-43"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-30-44" name="__codelineno-30-44" href="#__codelineno-30-44"></a>
<a id="__codelineno-30-45" name="__codelineno-30-45" href="#__codelineno-30-45"></a>rule trim_galore:
<a id="__codelineno-30-46" name="__codelineno-30-46" href="#__codelineno-30-46"></a><span class="w"> </span>   input:
<a id="__codelineno-30-47" name="__codelineno-30-47" href="#__codelineno-30-47"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-30-48" name="__codelineno-30-48" href="#__codelineno-30-48"></a><span class="w"> </span>   output:
<a id="__codelineno-30-49" name="__codelineno-30-49" href="#__codelineno-30-49"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-30-50" name="__codelineno-30-50" href="#__codelineno-30-50"></a><span class="w"> </span>   params:
<a id="__codelineno-30-51" name="__codelineno-30-51" href="#__codelineno-30-51"></a><span class="w"> </span>       &quot;--paired&quot;
<a id="__codelineno-30-52" name="__codelineno-30-52" href="#__codelineno-30-52"></a><span class="w"> </span>   log:
<a id="__codelineno-30-53" name="__codelineno-30-53" href="#__codelineno-30-53"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-30-54" name="__codelineno-30-54" href="#__codelineno-30-54"></a><span class="w"> </span>   conda:
<a id="__codelineno-30-55" name="__codelineno-30-55" href="#__codelineno-30-55"></a><span class="w"> </span>       &quot;envs/trimgalore.yaml&quot;
<a id="__codelineno-30-56" name="__codelineno-30-56" href="#__codelineno-30-56"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-30-57" name="__codelineno-30-57" href="#__codelineno-30-57"></a><span class="w"> </span>   resources:
<a id="__codelineno-30-58" name="__codelineno-30-58" href="#__codelineno-30-58"></a><span class="w"> </span>       cpus_per_task=8
<a id="__codelineno-30-59" name="__codelineno-30-59" href="#__codelineno-30-59"></a><span class="w"> </span>   shell:
<a id="__codelineno-30-60" name="__codelineno-30-60" href="#__codelineno-30-60"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># define our configuration file</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">configfile</span><span class="p">:</span> <span class="s2">&quot;../config/config.yaml&quot;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="c1"># workflow</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>        <span class="n">fastqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;FASTQC&#39;</span><span class="p">]</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a>        <span class="s2">&quot;envs/fastqc.yaml&quot;</span>
<a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> </span><span class="si">{params.fastqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a>
<a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a>        <span class="n">multiqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;MULTIQC&#39;</span><span class="p">]</span>
<a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-31-40" name="__codelineno-31-40" href="#__codelineno-31-40"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-31-41" name="__codelineno-31-41" href="#__codelineno-31-41"></a>        <span class="s2">&quot;envs/multiqc.yaml&quot;</span>
<a id="__codelineno-31-42" name="__codelineno-31-42" href="#__codelineno-31-42"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-31-43" name="__codelineno-31-43" href="#__codelineno-31-43"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ </span><span class="si">{params.multiqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-31-44" name="__codelineno-31-44" href="#__codelineno-31-44"></a>
<a id="__codelineno-31-45" name="__codelineno-31-45" href="#__codelineno-31-45"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-31-46" name="__codelineno-31-46" href="#__codelineno-31-46"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-31-47" name="__codelineno-31-47" href="#__codelineno-31-47"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-31-48" name="__codelineno-31-48" href="#__codelineno-31-48"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-31-49" name="__codelineno-31-49" href="#__codelineno-31-49"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-31-50" name="__codelineno-31-50" href="#__codelineno-31-50"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-31-51" name="__codelineno-31-51" href="#__codelineno-31-51"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-31-52" name="__codelineno-31-52" href="#__codelineno-31-52"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-31-53" name="__codelineno-31-53" href="#__codelineno-31-53"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-31-54" name="__codelineno-31-54" href="#__codelineno-31-54"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-31-55" name="__codelineno-31-55" href="#__codelineno-31-55"></a>        <span class="s2">&quot;envs/trimgalore.yaml&quot;</span>
<a id="__codelineno-31-56" name="__codelineno-31-56" href="#__codelineno-31-56"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-31-57" name="__codelineno-31-57" href="#__codelineno-31-57"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-31-58" name="__codelineno-31-58" href="#__codelineno-31-58"></a>        <span class="n">cpus_per_task</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-31-59" name="__codelineno-31-59" href="#__codelineno-31-59"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-31-60" name="__codelineno-31-60" href="#__codelineno-31-60"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<p>Then we don't need to specify where the configuration file is on the command line</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1"># remove output of last run</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a># run dryrun/run again
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="gd">- snakemake --dryrun --workflow-profile slurm --software-deployment-method conda --configfile ../config/config.yaml</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="gd">- snakemake --workflow-profile slurm --software-deployment-method conda --configfile ../config/config.yaml</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="gi">+ snakemake --dryrun --workflow-profile slurm --software-deployment-method conda</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="gi">+ snakemake --workflow-profile slurm --software-deployment-method conda</span>
</code></pre></div></p>
</div>
<h2 id="44-leave-messages-for-the-user">4.4 Leave messages for the user<a class="headerlink" href="#44-leave-messages-for-the-user" title="Permanent link">&para;</a></h2>
<p>We can provide the user of our workflow more information on what is happening at each stage/rule of our workflow via the <code>message:</code> directive. We are able to call many variables such as:</p>
<ul>
<li>Input and output files <code>{input}</code> and <code>{output}</code></li>
<li>Specific input and output files such as <code>{input.R1}</code></li>
<li>Our <code>{params}</code>, <code>{log}</code> and <code>{threads}</code> directives</li>
</ul>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a># define our configuration file
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>configfile: &quot;../config/config.yaml&quot;
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a># define samples from data directory using wildcards
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>rule all:
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="w"> </span>   input:
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a># workflow
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a>rule fastqc:
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="w"> </span>   input:
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="w"> </span>   output:
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="w"> </span>       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w"> </span>   params:
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="w"> </span>       fastqc_params = config[&#39;PARAMS&#39;][&#39;FASTQC&#39;]
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="w"> </span>   log:
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="w"> </span>   conda:
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="w"> </span>       &quot;envs/fastqc.yaml&quot;
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="gi">+   message:</span>
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="gi">+       &quot;Undertaking quality control checks {input}&quot;</span>
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="w"> </span>   shell:
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a>
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a>rule multiqc:
<a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="w"> </span>   input:
<a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="w"> </span>   output:
<a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="w"> </span>   params:
<a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="w"> </span>       multiqc_params = config[&#39;PARAMS&#39;][&#39;MULTIQC&#39;]
<a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="w"> </span>   log:
<a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="w"> </span>   conda:
<a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="w"> </span>       &quot;envs/multiqc.yaml&quot;
<a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a><span class="gi">+   message:</span>
<a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a><span class="gi">+       &quot;Compiling a HTML report for quality control checks. Writing to {output}.&quot;</span>
<a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a><span class="w"> </span>   shell:
<a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-34-48" name="__codelineno-34-48" href="#__codelineno-34-48"></a>
<a id="__codelineno-34-49" name="__codelineno-34-49" href="#__codelineno-34-49"></a>rule trim_galore:
<a id="__codelineno-34-50" name="__codelineno-34-50" href="#__codelineno-34-50"></a><span class="w"> </span>   input:
<a id="__codelineno-34-51" name="__codelineno-34-51" href="#__codelineno-34-51"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-34-52" name="__codelineno-34-52" href="#__codelineno-34-52"></a><span class="w"> </span>   output:
<a id="__codelineno-34-53" name="__codelineno-34-53" href="#__codelineno-34-53"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-34-54" name="__codelineno-34-54" href="#__codelineno-34-54"></a><span class="w"> </span>   params:
<a id="__codelineno-34-55" name="__codelineno-34-55" href="#__codelineno-34-55"></a><span class="w"> </span>       &quot;--paired&quot;
<a id="__codelineno-34-56" name="__codelineno-34-56" href="#__codelineno-34-56"></a><span class="w"> </span>   log:
<a id="__codelineno-34-57" name="__codelineno-34-57" href="#__codelineno-34-57"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-34-58" name="__codelineno-34-58" href="#__codelineno-34-58"></a><span class="w"> </span>   conda:
<a id="__codelineno-34-59" name="__codelineno-34-59" href="#__codelineno-34-59"></a><span class="w"> </span>       &quot;envs/trimgalore.yaml&quot;
<a id="__codelineno-34-60" name="__codelineno-34-60" href="#__codelineno-34-60"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-34-61" name="__codelineno-34-61" href="#__codelineno-34-61"></a><span class="w"> </span>   resources:
<a id="__codelineno-34-62" name="__codelineno-34-62" href="#__codelineno-34-62"></a><span class="w"> </span>       cpus_per_task=8
<a id="__codelineno-34-63" name="__codelineno-34-63" href="#__codelineno-34-63"></a><span class="gi">+   message:</span>
<a id="__codelineno-34-64" name="__codelineno-34-64" href="#__codelineno-34-64"></a><span class="gi">+       &quot;Trimming using these parameter: {params}. Writing logs to {log}. Using {threads} threads.&quot;</span>
<a id="__codelineno-34-65" name="__codelineno-34-65" href="#__codelineno-34-65"></a><span class="w"> </span>   shell:
<a id="__codelineno-34-66" name="__codelineno-34-66" href="#__codelineno-34-66"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># define our configuration file</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">configfile</span><span class="p">:</span> <span class="s2">&quot;../config/config.yaml&quot;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="c1"># workflow</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>        <span class="n">html</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">],</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a>        <span class="n">fastqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;FASTQC&#39;</span><span class="p">]</span>
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-35-26" name="__codelineno-35-26" href="#__codelineno-35-26"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-35-27" name="__codelineno-35-27" href="#__codelineno-35-27"></a>        <span class="s2">&quot;envs/fastqc.yaml&quot;</span>
<a id="__codelineno-35-28" name="__codelineno-35-28" href="#__codelineno-35-28"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-35-29" name="__codelineno-35-29" href="#__codelineno-35-29"></a>        <span class="s2">&quot;Undertaking quality control checks </span><span class="si">{input}</span><span class="s2">&quot;</span>
<a id="__codelineno-35-30" name="__codelineno-35-30" href="#__codelineno-35-30"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-35-31" name="__codelineno-35-31" href="#__codelineno-35-31"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> </span><span class="si">{params.fastqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-35-32" name="__codelineno-35-32" href="#__codelineno-35-32"></a>
<a id="__codelineno-35-33" name="__codelineno-35-33" href="#__codelineno-35-33"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-35-34" name="__codelineno-35-34" href="#__codelineno-35-34"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-35-35" name="__codelineno-35-35" href="#__codelineno-35-35"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-35-36" name="__codelineno-35-36" href="#__codelineno-35-36"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-35-37" name="__codelineno-35-37" href="#__codelineno-35-37"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-35-38" name="__codelineno-35-38" href="#__codelineno-35-38"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-35-39" name="__codelineno-35-39" href="#__codelineno-35-39"></a>        <span class="n">multiqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;MULTIQC&#39;</span><span class="p">]</span>
<a id="__codelineno-35-40" name="__codelineno-35-40" href="#__codelineno-35-40"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-35-41" name="__codelineno-35-41" href="#__codelineno-35-41"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-35-42" name="__codelineno-35-42" href="#__codelineno-35-42"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-35-43" name="__codelineno-35-43" href="#__codelineno-35-43"></a>        <span class="s2">&quot;envs/multiqc.yaml&quot;</span>
<a id="__codelineno-35-44" name="__codelineno-35-44" href="#__codelineno-35-44"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-35-45" name="__codelineno-35-45" href="#__codelineno-35-45"></a>        <span class="s2">&quot;Compiling a HTML report for quality control checks. Writing to </span><span class="si">{output}</span><span class="s2">.&quot;</span>
<a id="__codelineno-35-46" name="__codelineno-35-46" href="#__codelineno-35-46"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-35-47" name="__codelineno-35-47" href="#__codelineno-35-47"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ </span><span class="si">{params.multiqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-35-48" name="__codelineno-35-48" href="#__codelineno-35-48"></a>
<a id="__codelineno-35-49" name="__codelineno-35-49" href="#__codelineno-35-49"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-35-50" name="__codelineno-35-50" href="#__codelineno-35-50"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-35-51" name="__codelineno-35-51" href="#__codelineno-35-51"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-35-52" name="__codelineno-35-52" href="#__codelineno-35-52"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-35-53" name="__codelineno-35-53" href="#__codelineno-35-53"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-35-54" name="__codelineno-35-54" href="#__codelineno-35-54"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-35-55" name="__codelineno-35-55" href="#__codelineno-35-55"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-35-56" name="__codelineno-35-56" href="#__codelineno-35-56"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-35-57" name="__codelineno-35-57" href="#__codelineno-35-57"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-35-58" name="__codelineno-35-58" href="#__codelineno-35-58"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-35-59" name="__codelineno-35-59" href="#__codelineno-35-59"></a>        <span class="s2">&quot;envs/trimgalore.yaml&quot;</span>
<a id="__codelineno-35-60" name="__codelineno-35-60" href="#__codelineno-35-60"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-35-61" name="__codelineno-35-61" href="#__codelineno-35-61"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-35-62" name="__codelineno-35-62" href="#__codelineno-35-62"></a>        <span class="n">cpus_per_task</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-35-63" name="__codelineno-35-63" href="#__codelineno-35-63"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-35-64" name="__codelineno-35-64" href="#__codelineno-35-64"></a>        <span class="s2">&quot;Trimming using these parameter: </span><span class="si">{params}</span><span class="s2">. Writing logs to </span><span class="si">{log}</span><span class="s2">. Using </span><span class="si">{threads}</span><span class="s2"> threads.&quot;</span>
<a id="__codelineno-35-65" name="__codelineno-35-65" href="#__codelineno-35-65"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-35-66" name="__codelineno-35-66" href="#__codelineno-35-66"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a># remove output of last run
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>rm -r ../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># run dryrun/run again</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--workflow-profile<span class="w"> </span>slurm<span class="w"> </span>--software-deployment-method<span class="w"> </span>conda
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>snakemake<span class="w"> </span>--workflow-profile<span class="w"> </span>slurm<span class="w"> </span>--software-deployment-method<span class="w"> </span>conda
</code></pre></div>
<ul>
<li>Now our messages are printed to the screen as our workflow runs</li>
</ul>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>Using<span class="w"> </span>shell:<span class="w"> </span>/usr/bin/bash
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>Provided<span class="w"> </span>cluster<span class="w"> </span>nodes:<span class="w"> </span><span class="m">20</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>Job<span class="w"> </span>stats:
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>job<span class="w">            </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>-----------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>all<span class="w">                </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>fastqc<span class="w">             </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>multiqc<span class="w">            </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>trim_galore<span class="w">        </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>total<span class="w">              </span><span class="m">8</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>Job<span class="w"> </span><span class="m">4</span>:<span class="w"> </span>Undertaking<span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks<span class="w"> </span>../../data/NA24694_1.fastq.gz<span class="w"> </span>../../data/NA24694_2.fastq.gz
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">4</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763840&#39;</span>.
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>Job<span class="w"> </span><span class="m">6</span>:<span class="w"> </span>Trimming<span class="w"> </span>using<span class="w"> </span>these<span class="w"> </span>parameter:<span class="w"> </span>--paired.<span class="w"> </span>Writing<span class="w"> </span>logs<span class="w"> </span>to<span class="w"> </span>logs/trim_galore/NA24695.log.<span class="w"> </span>Using<span class="w"> </span><span class="m">2</span><span class="w"> </span>threads.
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a>
<a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">6</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763841&#39;</span>.
<a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a>
<a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a>Job<span class="w"> </span><span class="m">2</span>:<span class="w"> </span>Undertaking<span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks<span class="w"> </span>../../data/NA24631_1.fastq.gz<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a>
<a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">2</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763842&#39;</span>.
<a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a>
<a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a>Job<span class="w"> </span><span class="m">3</span>:<span class="w"> </span>Undertaking<span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks<span class="w"> </span>../../data/NA24695_1.fastq.gz<span class="w"> </span>../../data/NA24695_2.fastq.gz
<a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a>
<a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">3</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763843&#39;</span>.
<a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a>
<a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-36" name="__codelineno-38-36" href="#__codelineno-38-36"></a>Job<span class="w"> </span><span class="m">5</span>:<span class="w"> </span>Trimming<span class="w"> </span>using<span class="w"> </span>these<span class="w"> </span>parameter:<span class="w"> </span>--paired.<span class="w"> </span>Writing<span class="w"> </span>logs<span class="w"> </span>to<span class="w"> </span>logs/trim_galore/NA24631.log.<span class="w"> </span>Using<span class="w"> </span><span class="m">2</span><span class="w"> </span>threads.
<a id="__codelineno-38-37" name="__codelineno-38-37" href="#__codelineno-38-37"></a>
<a id="__codelineno-38-38" name="__codelineno-38-38" href="#__codelineno-38-38"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">5</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763844&#39;</span>.
<a id="__codelineno-38-39" name="__codelineno-38-39" href="#__codelineno-38-39"></a>
<a id="__codelineno-38-40" name="__codelineno-38-40" href="#__codelineno-38-40"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:20:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-41" name="__codelineno-38-41" href="#__codelineno-38-41"></a>Job<span class="w"> </span><span class="m">7</span>:<span class="w"> </span>Trimming<span class="w"> </span>using<span class="w"> </span>these<span class="w"> </span>parameter:<span class="w"> </span>--paired.<span class="w"> </span>Writing<span class="w"> </span>logs<span class="w"> </span>to<span class="w"> </span>logs/trim_galore/NA24694.log.<span class="w"> </span>Using<span class="w"> </span><span class="m">2</span><span class="w"> </span>threads.
<a id="__codelineno-38-42" name="__codelineno-38-42" href="#__codelineno-38-42"></a>
<a id="__codelineno-38-43" name="__codelineno-38-43" href="#__codelineno-38-43"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">7</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763845&#39;</span>.
<a id="__codelineno-38-44" name="__codelineno-38-44" href="#__codelineno-38-44"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-45" name="__codelineno-38-45" href="#__codelineno-38-45"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">4</span>.
<a id="__codelineno-38-46" name="__codelineno-38-46" href="#__codelineno-38-46"></a><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">12</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-38-47" name="__codelineno-38-47" href="#__codelineno-38-47"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-48" name="__codelineno-38-48" href="#__codelineno-38-48"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">6</span>.
<a id="__codelineno-38-49" name="__codelineno-38-49" href="#__codelineno-38-49"></a><span class="m">2</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">25</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-38-50" name="__codelineno-38-50" href="#__codelineno-38-50"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-51" name="__codelineno-38-51" href="#__codelineno-38-51"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">2</span>.
<a id="__codelineno-38-52" name="__codelineno-38-52" href="#__codelineno-38-52"></a><span class="m">3</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">38</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-38-53" name="__codelineno-38-53" href="#__codelineno-38-53"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:08<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-54" name="__codelineno-38-54" href="#__codelineno-38-54"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">3</span>.
<a id="__codelineno-38-55" name="__codelineno-38-55" href="#__codelineno-38-55"></a><span class="m">4</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">50</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-38-56" name="__codelineno-38-56" href="#__codelineno-38-56"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a id="__codelineno-38-57" name="__codelineno-38-57" href="#__codelineno-38-57"></a>
<a id="__codelineno-38-58" name="__codelineno-38-58" href="#__codelineno-38-58"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:09<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-59" name="__codelineno-38-59" href="#__codelineno-38-59"></a>Job<span class="w"> </span><span class="m">1</span>:<span class="w"> </span>Compiling<span class="w"> </span>a<span class="w"> </span>HTML<span class="w"> </span>report<span class="w"> </span><span class="k">for</span><span class="w"> </span>quality<span class="w"> </span>control<span class="w"> </span>checks.<span class="w"> </span>Writing<span class="w"> </span>to<span class="w"> </span>../results/multiqc_report.html.
<a id="__codelineno-38-60" name="__codelineno-38-60" href="#__codelineno-38-60"></a>
<a id="__codelineno-38-61" name="__codelineno-38-61" href="#__codelineno-38-61"></a>Submitted<span class="w"> </span>job<span class="w"> </span><span class="m">1</span><span class="w"> </span>with<span class="w"> </span>external<span class="w"> </span>jobid<span class="w"> </span><span class="s1">&#39;26763848&#39;</span>.
<a id="__codelineno-38-62" name="__codelineno-38-62" href="#__codelineno-38-62"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:09<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-63" name="__codelineno-38-63" href="#__codelineno-38-63"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">5</span>.
<a id="__codelineno-38-64" name="__codelineno-38-64" href="#__codelineno-38-64"></a><span class="m">5</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">62</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-38-65" name="__codelineno-38-65" href="#__codelineno-38-65"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22:09<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-66" name="__codelineno-38-66" href="#__codelineno-38-66"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">7</span>.
<a id="__codelineno-38-67" name="__codelineno-38-67" href="#__codelineno-38-67"></a><span class="m">6</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">75</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-38-68" name="__codelineno-38-68" href="#__codelineno-38-68"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:24:21<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-69" name="__codelineno-38-69" href="#__codelineno-38-69"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">1</span>.
<a id="__codelineno-38-70" name="__codelineno-38-70" href="#__codelineno-38-70"></a><span class="m">7</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">88</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-38-71" name="__codelineno-38-71" href="#__codelineno-38-71"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a id="__codelineno-38-72" name="__codelineno-38-72" href="#__codelineno-38-72"></a>
<a id="__codelineno-38-73" name="__codelineno-38-73" href="#__codelineno-38-73"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:24:21<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-74" name="__codelineno-38-74" href="#__codelineno-38-74"></a>localrule<span class="w"> </span>all:
<a id="__codelineno-38-75" name="__codelineno-38-75" href="#__codelineno-38-75"></a><span class="w">    </span>input:<span class="w"> </span>../results/multiqc_report.html,<span class="w"> </span>../results/trimmed/NA24631_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24695_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24694_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24631_2_val_2.fq.gz,<span class="w"> </span>../results/trimmed/NA24695_2_val_2.fq.gz,<span class="w"> </span>../results/trimmed/NA24694_2_val_2.fq.gz
<a id="__codelineno-38-76" name="__codelineno-38-76" href="#__codelineno-38-76"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-38-77" name="__codelineno-38-77" href="#__codelineno-38-77"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">mem_mb</span><span class="o">=</span><span class="m">512</span>,<span class="w"> </span><span class="nv">disk_mb</span><span class="o">=</span><span class="m">1000</span>,<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281,<span class="w"> </span><span class="nv">cpus</span><span class="o">=</span><span class="m">2</span>,<span class="w"> </span><span class="nv">time_min</span><span class="o">=</span><span class="m">10</span>
<a id="__codelineno-38-78" name="__codelineno-38-78" href="#__codelineno-38-78"></a>
<a id="__codelineno-38-79" name="__codelineno-38-79" href="#__codelineno-38-79"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:24:21<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a id="__codelineno-38-80" name="__codelineno-38-80" href="#__codelineno-38-80"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">0</span>.
<a id="__codelineno-38-81" name="__codelineno-38-81" href="#__codelineno-38-81"></a><span class="m">8</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">100</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-38-82" name="__codelineno-38-82" href="#__codelineno-38-82"></a>Complete<span class="w"> </span>log:<span class="w"> </span>.snakemake/log/2022-05-11T132052.454902.snakemake.log
</code></pre></div>
</details>
</div>
<p><br></p>
<h2 id="45-create-temporary-files">4.5 Create temporary files<a class="headerlink" href="#45-create-temporary-files" title="Permanent link">&para;</a></h2>
<p>In our workflow, we are likely to be creating files that we don't want, but are used or produced by our workflow (intermediate files). We can mark such files as temporary so Snakemake will remove the file once it doesn't need to use it anymore.</p>
<p>For example, we might not want to keep our fastqc output files since our multiqc report merges all of our fastqc reports for each sample into one report. Let's have a look at the files currently produced by our workflow with:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>../results/fastqc/
</code></pre></div>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>total<span class="w"> </span><span class="m">4</span>.5M
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>250K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_1_fastqc.html
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_1_fastqc.zip
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>249K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_2_fastqc.html
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24631_2_fastqc.zip
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>254K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_1_fastqc.html
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>334K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_1_fastqc.zip
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>250K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_2_fastqc.html
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24694_2_fastqc.zip
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>252K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_1_fastqc.html
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_1_fastqc.zip
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>253K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_2_fastqc.html
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>330K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:22<span class="w"> </span>NA24695_2_fastqc.zip
</code></pre></div>
</details>
</div>
<p><br></p>
<p>Let's mark all the trimmed fastq files as temporary in our Snakefile by wrapping it up in the <code>temp()</code> function</p>
<details class="code-compare">
<summary>Edit snakefile</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a># define our configuration file
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>configfile: &quot;../config/config.yaml&quot;
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a># define samples from data directory using wildcards
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>SAMPLES, = glob_wildcards(&quot;../../data/{sample}_1.fastq.gz&quot;)
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a># target OUTPUT files for the whole workflow
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>rule all:
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w"> </span>   input:
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;,
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w"> </span>       expand([&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;], sample = SAMPLES)
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a># workflow
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>rule fastqc:
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w"> </span>   input:
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w"> </span>       R1 = &quot;../../data/{sample}_1.fastq.gz&quot;,
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w"> </span>       R2 = &quot;../../data/{sample}_2.fastq.gz&quot;
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w"> </span>   output:
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="gd">-       html = [&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;],</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="gi">+       html = temp([&quot;../results/fastqc/{sample}_1_fastqc.html&quot;, &quot;../results/fastqc/{sample}_2_fastqc.html&quot;]),</span>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w"> </span>       zip = [&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;]
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w"> </span>   params:
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w"> </span>       fastqc_params = config[&#39;PARAMS&#39;][&#39;FASTQC&#39;]
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w"> </span>   log:
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w"> </span>       &quot;logs/fastqc/{sample}.log&quot;
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="w"> </span>   conda:
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w"> </span>       &quot;envs/fastqc.yaml&quot;
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="w"> </span>   message:
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="w"> </span>       &quot;Undertaking quality control checks {input}&quot;
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="w"> </span>   shell:
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="w"> </span>       &quot;fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} {params.fastqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a>
<a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a>rule multiqc:
<a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a><span class="w"> </span>   input:
<a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="w"> </span>       expand([&quot;../results/fastqc/{sample}_1_fastqc.zip&quot;, &quot;../results/fastqc/{sample}_2_fastqc.zip&quot;], sample = SAMPLES)
<a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="w"> </span>   output:
<a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a><span class="w"> </span>       &quot;../results/multiqc_report.html&quot;
<a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a><span class="w"> </span>   params:
<a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="w"> </span>       multiqc_params = config[&#39;PARAMS&#39;][&#39;MULTIQC&#39;]
<a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="w"> </span>   log:
<a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a><span class="w"> </span>       &quot;logs/multiqc/multiqc.log&quot;
<a id="__codelineno-41-43" name="__codelineno-41-43" href="#__codelineno-41-43"></a><span class="w"> </span>   conda:
<a id="__codelineno-41-44" name="__codelineno-41-44" href="#__codelineno-41-44"></a><span class="w"> </span>       &quot;envs/multiqc.yaml&quot;
<a id="__codelineno-41-45" name="__codelineno-41-45" href="#__codelineno-41-45"></a><span class="w"> </span>   message:
<a id="__codelineno-41-46" name="__codelineno-41-46" href="#__codelineno-41-46"></a><span class="w"> </span>       &quot;Compiling a HTML report for quality control checks. Writing to {output}.&quot;
<a id="__codelineno-41-47" name="__codelineno-41-47" href="#__codelineno-41-47"></a><span class="w"> </span>   shell:
<a id="__codelineno-41-48" name="__codelineno-41-48" href="#__codelineno-41-48"></a><span class="w"> </span>       &quot;multiqc {input} -o ../results/ {params.multiqc_params} &amp;&gt; {log}&quot;
<a id="__codelineno-41-49" name="__codelineno-41-49" href="#__codelineno-41-49"></a>
<a id="__codelineno-41-50" name="__codelineno-41-50" href="#__codelineno-41-50"></a>rule trim_galore:
<a id="__codelineno-41-51" name="__codelineno-41-51" href="#__codelineno-41-51"></a><span class="w"> </span>   input:
<a id="__codelineno-41-52" name="__codelineno-41-52" href="#__codelineno-41-52"></a><span class="w"> </span>       [&quot;../../data/{sample}_1.fastq.gz&quot;, &quot;../../data/{sample}_2.fastq.gz&quot;]
<a id="__codelineno-41-53" name="__codelineno-41-53" href="#__codelineno-41-53"></a><span class="w"> </span>   output:
<a id="__codelineno-41-54" name="__codelineno-41-54" href="#__codelineno-41-54"></a><span class="w"> </span>       [&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;, &quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;]
<a id="__codelineno-41-55" name="__codelineno-41-55" href="#__codelineno-41-55"></a><span class="w"> </span>   params:
<a id="__codelineno-41-56" name="__codelineno-41-56" href="#__codelineno-41-56"></a><span class="w"> </span>       &quot;--paired&quot;
<a id="__codelineno-41-57" name="__codelineno-41-57" href="#__codelineno-41-57"></a><span class="w"> </span>   log:
<a id="__codelineno-41-58" name="__codelineno-41-58" href="#__codelineno-41-58"></a><span class="w"> </span>       &quot;logs/trim_galore/{sample}.log&quot;
<a id="__codelineno-41-59" name="__codelineno-41-59" href="#__codelineno-41-59"></a><span class="w"> </span>   conda:
<a id="__codelineno-41-60" name="__codelineno-41-60" href="#__codelineno-41-60"></a><span class="w"> </span>       &quot;envs/trimgalore.yaml&quot;
<a id="__codelineno-41-61" name="__codelineno-41-61" href="#__codelineno-41-61"></a><span class="w"> </span>   threads: 2
<a id="__codelineno-41-62" name="__codelineno-41-62" href="#__codelineno-41-62"></a><span class="w"> </span>   resources:
<a id="__codelineno-41-63" name="__codelineno-41-63" href="#__codelineno-41-63"></a><span class="w"> </span>       cpus_per_task=8
<a id="__codelineno-41-64" name="__codelineno-41-64" href="#__codelineno-41-64"></a><span class="w"> </span>   message:
<a id="__codelineno-41-65" name="__codelineno-41-65" href="#__codelineno-41-65"></a><span class="w"> </span>       &quot;Trimming using these parameter: {params}. Writing logs to {log}. Using {threads} threads.&quot;
<a id="__codelineno-41-66" name="__codelineno-41-66" href="#__codelineno-41-66"></a><span class="w"> </span>   shell:
<a id="__codelineno-41-67" name="__codelineno-41-67" href="#__codelineno-41-67"></a><span class="w"> </span>       &quot;trim_galore {input} -o ../results/trimmed/ {params} --cores {threads} &amp;&gt; {log}&quot;
</code></pre></div>
</details>
<details class="file-code">
<summary>Current snakefile:</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1"># define our configuration file</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">configfile</span><span class="p">:</span> <span class="s2">&quot;../config/config.yaml&quot;</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="c1"># define samples from data directory using wildcards</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="n">SAMPLES</span><span class="p">,</span> <span class="o">=</span> <span class="n">glob_wildcards</span><span class="p">(</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">)</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="c1"># target OUTPUT files for the whole workflow</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="n">rule</span> <span class="nb">all</span><span class="p">:</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span><span class="p">,</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="c1"># workflow</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="n">rule</span> <span class="n">fastqc</span><span class="p">:</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>        <span class="n">R1</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a>        <span class="n">R2</span> <span class="o">=</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">temp</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.html&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.html&quot;</span><span class="p">]),</span>
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a>        <span class="nb">zip</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">]</span>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a>        <span class="n">fastqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;FASTQC&#39;</span><span class="p">]</span>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a>        <span class="s2">&quot;logs/fastqc/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a>        <span class="s2">&quot;envs/fastqc.yaml&quot;</span>
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a>        <span class="s2">&quot;Undertaking quality control checks </span><span class="si">{input}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a>        <span class="s2">&quot;fastqc </span><span class="si">{input.R1}</span><span class="s2"> </span><span class="si">{input.R2}</span><span class="s2"> -o ../results/fastqc/ -t </span><span class="si">{threads}</span><span class="s2"> </span><span class="si">{params.fastqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a>
<a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a><span class="n">rule</span> <span class="n">multiqc</span><span class="p">:</span>
<a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a>        <span class="n">expand</span><span class="p">([</span><span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_1_fastqc.zip&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/fastqc/</span><span class="si">{sample}</span><span class="s2">_2_fastqc.zip&quot;</span><span class="p">],</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">SAMPLES</span><span class="p">)</span>
<a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a>        <span class="s2">&quot;../results/multiqc_report.html&quot;</span>
<a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a>        <span class="n">multiqc_params</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;PARAMS&#39;</span><span class="p">][</span><span class="s1">&#39;MULTIQC&#39;</span><span class="p">]</span>
<a id="__codelineno-42-40" name="__codelineno-42-40" href="#__codelineno-42-40"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-42-41" name="__codelineno-42-41" href="#__codelineno-42-41"></a>        <span class="s2">&quot;logs/multiqc/multiqc.log&quot;</span>
<a id="__codelineno-42-42" name="__codelineno-42-42" href="#__codelineno-42-42"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-42-43" name="__codelineno-42-43" href="#__codelineno-42-43"></a>        <span class="s2">&quot;envs/multiqc.yaml&quot;</span>
<a id="__codelineno-42-44" name="__codelineno-42-44" href="#__codelineno-42-44"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-42-45" name="__codelineno-42-45" href="#__codelineno-42-45"></a>        <span class="s2">&quot;Compiling a HTML report for quality control checks. Writing to </span><span class="si">{output}</span><span class="s2">.&quot;</span>
<a id="__codelineno-42-46" name="__codelineno-42-46" href="#__codelineno-42-46"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-42-47" name="__codelineno-42-47" href="#__codelineno-42-47"></a>        <span class="s2">&quot;multiqc </span><span class="si">{input}</span><span class="s2"> -o ../results/ </span><span class="si">{params.multiqc_params}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
<a id="__codelineno-42-48" name="__codelineno-42-48" href="#__codelineno-42-48"></a>
<a id="__codelineno-42-49" name="__codelineno-42-49" href="#__codelineno-42-49"></a><span class="n">rule</span> <span class="n">trim_galore</span><span class="p">:</span>
<a id="__codelineno-42-50" name="__codelineno-42-50" href="#__codelineno-42-50"></a>    <span class="nb">input</span><span class="p">:</span>
<a id="__codelineno-42-51" name="__codelineno-42-51" href="#__codelineno-42-51"></a>        <span class="p">[</span><span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_1.fastq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../../data/</span><span class="si">{sample}</span><span class="s2">_2.fastq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-42-52" name="__codelineno-42-52" href="#__codelineno-42-52"></a>    <span class="n">output</span><span class="p">:</span>
<a id="__codelineno-42-53" name="__codelineno-42-53" href="#__codelineno-42-53"></a>        <span class="p">[</span><span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_1_val_1.fq.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;../results/trimmed/</span><span class="si">{sample}</span><span class="s2">_2_val_2.fq.gz&quot;</span><span class="p">]</span>
<a id="__codelineno-42-54" name="__codelineno-42-54" href="#__codelineno-42-54"></a>    <span class="n">params</span><span class="p">:</span>
<a id="__codelineno-42-55" name="__codelineno-42-55" href="#__codelineno-42-55"></a>        <span class="s2">&quot;--paired&quot;</span>
<a id="__codelineno-42-56" name="__codelineno-42-56" href="#__codelineno-42-56"></a>    <span class="n">log</span><span class="p">:</span>
<a id="__codelineno-42-57" name="__codelineno-42-57" href="#__codelineno-42-57"></a>        <span class="s2">&quot;logs/trim_galore/</span><span class="si">{sample}</span><span class="s2">.log&quot;</span>
<a id="__codelineno-42-58" name="__codelineno-42-58" href="#__codelineno-42-58"></a>    <span class="n">conda</span><span class="p">:</span>
<a id="__codelineno-42-59" name="__codelineno-42-59" href="#__codelineno-42-59"></a>        <span class="s2">&quot;envs/trimgalore.yaml&quot;</span>
<a id="__codelineno-42-60" name="__codelineno-42-60" href="#__codelineno-42-60"></a>    <span class="n">threads</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-42-61" name="__codelineno-42-61" href="#__codelineno-42-61"></a>    <span class="n">resources</span><span class="p">:</span>
<a id="__codelineno-42-62" name="__codelineno-42-62" href="#__codelineno-42-62"></a>        <span class="n">cpus_per_task</span><span class="o">=</span><span class="mi">8</span>
<a id="__codelineno-42-63" name="__codelineno-42-63" href="#__codelineno-42-63"></a>    <span class="n">message</span><span class="p">:</span>
<a id="__codelineno-42-64" name="__codelineno-42-64" href="#__codelineno-42-64"></a>        <span class="s2">&quot;Trimming using these parameter: </span><span class="si">{params}</span><span class="s2">. Writing logs to </span><span class="si">{log}</span><span class="s2">. Using </span><span class="si">{threads}</span><span class="s2"> threads.&quot;</span>
<a id="__codelineno-42-65" name="__codelineno-42-65" href="#__codelineno-42-65"></a>    <span class="n">shell</span><span class="p">:</span>
<a id="__codelineno-42-66" name="__codelineno-42-66" href="#__codelineno-42-66"></a>        <span class="s2">&quot;trim_galore </span><span class="si">{input}</span><span class="s2"> -o ../results/trimmed/ </span><span class="si">{params}</span><span class="s2"> --cores </span><span class="si">{threads}</span><span class="s2"> &amp;&gt; </span><span class="si">{log}</span><span class="s2">&quot;</span>
</code></pre></div>
</details>
<p><br></p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a># remove output of last run
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>rm -r ../results/*
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1"># run dryrun/run again</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--workflow-profile<span class="w"> </span>slurm<span class="w"> </span>--software-deployment-method<span class="w"> </span>conda
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>snakemake<span class="w"> </span>--workflow-profile<span class="w"> </span>slurm<span class="w"> </span>--software-deployment-method<span class="w"> </span>conda
</code></pre></div></p>
</div>
<div class="admonition terminal-2">
<p class="admonition-title">Now when we have a look at the <code>../results/fastqc/</code> directory with:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>../results/fastqc/
</code></pre></div>
<ul>
<li>These html files have been removed once Snakemake no longer needs the files for another rule/operation, and we've saved some space on our computer (from 4.5 megabytes to 3 megabytes in this directory).</li>
</ul>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>total<span class="w"> </span><span class="m">3</span>.0M
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24631_1_fastqc.zip
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>327K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24631_2_fastqc.zip
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>334K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24694_1_fastqc.zip
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24694_2_fastqc.zip
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>328K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24695_1_fastqc.zip
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>330K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">13</span>:26<span class="w"> </span>NA24695_2_fastqc.zip
</code></pre></div>
</details>
</div>
<p><br></p>
<div class="admonition note">
<p>This becomes particularly important when our data become big data, since we don't want to keep any massive intermediate output files that we don't need. Otherwise this can start to clog up the memory on our computer. It ensures our workflow is scalable when our data becomes big data.</p>
</div>
<h2 id="46-generating-a-snakemake-report">4.6 Generating a snakemake report<a class="headerlink" href="#46-generating-a-snakemake-report" title="Permanent link">&para;</a></h2>
<p>With Snakemake, we can automatically generate detailed self-contained HTML reports after we run our workflow with the following command:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>snakemake<span class="w"> </span>--report<span class="w"> </span>../results/snakemake_report.html
</code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You won't be able to view a rendered version of this html while it is on the remote server, however after you transfer it to your local computer you should be able to view it in your web browser.</p>
</div>
<p>In our report:</p>
<ul>
<li>We get an interactive version of our directed acyclic graph (DAG).</li>
<li>When you click on a node in the DAG, the input and output files are fully outlined, the exact software used and the exact shell command that was run.</li>
<li>You are also provided with runtime information under the <code>Statistics</code> tab outlining how long each rule/sample ran for, and the date/time each file was created.</li>
</ul>
<div class="admonition html5">
<p class="admonition-title">My report</p>
<p><a class="glightbox" href="../images/snakemake_report.gif" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="snakemake_report" src="../images/snakemake_report.gif" /></a></p>
</div>
<p><br></p>
<p>These reports are highly configurable, have a look at an example of what can be done with a report <a href="https://koesterlab.github.io/resources/report.html">here</a></p>
<p><em>See more information on creating Snakemake reports <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/reporting.html">in the Snakemake documentation</a></em></p>
<h2 id="47-linting-your-workflow">4.7 Linting your workflow<a class="headerlink" href="#47-linting-your-workflow" title="Permanent link">&para;</a></h2>
<p>Snakemake has a built in linter to support you building best practice workflows, let's try it out:</p>
<div class="admonition terminal">
<p class="admonition-title">code</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>snakemake<span class="w"> </span>--lint
</code></pre></div>
<details class="success">
<summary>output</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>Congratulations,<span class="w"> </span>your<span class="w"> </span>workflow<span class="w"> </span>is<span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>good<span class="w"> </span>condition!
</code></pre></div>
</details>
</div>
<p><br></p>
<p>Writing a best practice workflow is more important than having Marie Kondo level tidiness, it increases the chance your workflow will continue to be used and maintained by others (and ourselves), making the code we write useful (it's exciting seeing someone else using your code!). If your workflow was used in scientific research, it makes your workflow accessible for people to reproduce your research findings; it isn't going to be a nightmare for them to run and they are more likely to try and have success doing so.</p>
<p>Read more about the <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/best_practices.html">best practices for Snakemake</a></p>
<h1 id="takeaways">Takeaways<a class="headerlink" href="#takeaways" title="Permanent link">&para;</a></h1>
<hr />
<div class="admonition quote">
<ul>
<li>Pull out your parameters and put them in <code>params:</code> directive</li>
<li>Pulling the user configurable options away from the core workflow will support reproducibility by reducing the chance of changes to the core workflow</li>
<li>Leaving messages for the user of your workflow will help them understand what is happening at each stage and follow the workflows progress</li>
<li>Mark files you won't need once the workflow completes to reduce the memory usage - <em>particularly</em> when dealing with big data</li>
<li>Generate a snakemake report to get a summary of the workflow run - these are highly configurable</li>
<li>Lint your workflow and check it complies with best practices - this supports reproducibility and portability</li>
<li>There is so much more to explore, such as creating <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/modularization.html">modular workflows</a>, automatically grabbing <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/remote_files.html">remote files</a> from places like Google Cloud Storage and Dropbox, <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#external-scripts">run various types of scripts</a> such as <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#python">python scripts</a>, <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#r-and-r-markdown">R and RMarkdown scripts</a> and <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#jupyter-notebook-integration">Jupyter Notebooks</a></li>
</ul>
</div>
<hr />
<h1 id="summary-commands">Summary commands<a class="headerlink" href="#summary-commands" title="Permanent link">&para;</a></h1>
<div class="admonition terminal">
<ul>
<li>Use the parameter directive (<code>params</code>) to keep the parameters and flags of your programs separate from your shell command, for example:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>params:
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">    </span><span class="s2">&quot;--paired&quot;</span>
</code></pre></div>
<ul>
<li>Run your snakemake workflow (using environment modules to load your software AND with a configuration file) with:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--software-deployment-method<span class="w"> </span>conda<span class="w"> </span>--configfile<span class="w"> </span>../config/config.yaml
</code></pre></div>
<ul>
<li>Alternatively, define your config file in the Snakefile:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>configfile:<span class="w"> </span><span class="s2">&quot;../config/config.yaml&quot;</span>
</code></pre></div>
<ul>
<li>Use the <code>message</code> directive to provide information to the user on what is happening real time, for example:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>message:
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">    </span><span class="s2">&quot;Undertaking quality control checks {input}&quot;</span>
</code></pre></div>
<ul>
<li>Mark temporary files to remove (once they are no longer needed by the workflow) with <code>temp()</code>, for example:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>temp<span class="o">([</span><span class="s2">&quot;../results/trimmed/{sample}_1_val_1.fq.gz&quot;</span>,<span class="w"> </span><span class="s2">&quot;../results/trimmed/{sample}_2_val_2.fq.gz&quot;</span><span class="o">])</span>
</code></pre></div>
<ul>
<li>Create a basic interactive Snakemake report after running your workflow with:</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>snakemake<span class="w"> </span>--report<span class="w"> </span>../results/snakemake_report.html
</code></pre></div>
</div>
<h1 id="our-final-snakemake-workflow">Our final snakemake workflow!<a class="headerlink" href="#our-final-snakemake-workflow" title="Permanent link">&para;</a></h1>
<p>See <a href="https://github.com/msu-cmse-courses/CMSE_890-602_snakemake/tree/main/leveled_up_demo_workflow">leveled_up_demo_workflow</a> for the final Snakemake workflow we've created up to this point</p>
<hr />
<p align="center"><b><a class="btn" href="https://msu-cmse-courses.github.io/CMSE_890-602_snakemake/" style="background: var(--bs-dark);font-weight:bold">Back to homepage</a></b></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../03_create_a_basic_workflow/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 03 - Create a basic workflow">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                03 - Create a basic workflow
              </div>
            </div>
          </a>
        
        
          
          <a href="../05_we_want_more/" class="md-footer__link md-footer__link--next" aria-label="Next: 05 - We want more!">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                05 - We want more!
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Snakemake workshop material is licensed under a <a rel="noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution license</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>