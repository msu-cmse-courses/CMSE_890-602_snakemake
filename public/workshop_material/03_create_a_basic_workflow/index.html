
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="NeSI" name="author"/>
<link href="https://nesi.github.io/snakemake_workshop/workshop_material/03_create_a_basic_workflow/" rel="canonical"/>
<link href="../02_setup/" rel="prev"/>
<link href="../04_leveling_up_your_workflow/" rel="next"/>
<link href="../../theme_images_nesi_logo.png" rel="icon"/>
<meta content="mkdocs-1.4.3, mkdocs-material-9.1.15" name="generator"/>
<title>03 - Create a basic workflow - Automate Your Workflow With Snakemake</title>
<link href="../../assets/stylesheets/main.26e3688c.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.ecc896b0.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Mukta:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Mukta";--md-code-font:"Fira Code"}</style>
<link href="../../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="custom" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#03-create-a-basic-workflow">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Automate Your Workflow With Snakemake" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Automate Your Workflow With Snakemake">
<img alt="logo" src="../../theme_images/nesi_logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Automate Your Workflow With Snakemake
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              03 - Create a basic workflow
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme)" data-md-color-primary="custom" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_3" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"></path></svg>
</label>
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="custom" data-md-color-scheme="default" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to system preference" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="custom" data-md-color-scheme="slate" id="__palette_3" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to system preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/nesi/snakemake_workshop" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    nesi/snakemake_workshop
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Automate Your Workflow With Snakemake" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Automate Your Workflow With Snakemake">
<img alt="logo" src="../../theme_images/nesi_logo.png"/>
</a>
    Automate Your Workflow With Snakemake
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/nesi/snakemake_workshop" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    nesi/snakemake_workshop
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Online workflow code-along: Introduction to Snakemake
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Workshop material
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Workshop material
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../01_introduction/">
        01 - Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_setup/">
        02 - Setup
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          03 - Create a basic workflow
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        03 - Create a basic workflow
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#301-aim">
    3.01 Aim
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#302-snakemake-workflow-file-structure">
    3.02 Snakemake workflow file structure
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#303-run-the-software-on-the-command-line">
    3.03 Run the software on the command line
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#304-create-the-first-rule-in-your-workflow">
    3.04 Create the first rule in your workflow
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#305-dryrun">
    3.05 Dryrun
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#306-create-a-dag">
    3.06 Create a DAG
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#307-fullrun">
    3.07 Fullrun
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#308-lazy-evaluation">
    3.08 Lazy evaluation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#309-run-using-environment-modules">
    3.09 Run using environment modules
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#310-capture-our-logs">
    3.10 Capture our logs
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#311-scale-up-to-analyse-all-of-our-samples">
    3.11 Scale up to analyse all of our samples
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#312-add-more-rules">
    3.12 Add more rules
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#313-more-about-snakemakes-lazy-behaviour">
    3.13 More about Snakemake's lazy behaviour
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#314-add-even-more-rules">
    3.14 Add even more rules
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#315-throw-it-more-cores">
    3.15 Throw it more cores
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#316-throw-it-even-more-cores">
    3.16 Throw it even more cores
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04_leveling_up_your_workflow/">
        04 - Leveling up your workflow!
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05_we_want_more/">
        05 - We want more!
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../99_appendix_setup_on_your_machine/">
        Appendix - Setup on your machine using conda
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../99_appendix_use_conda_environments/">
        Appendix - Use conda environments
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#301-aim">
    3.01 Aim
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#302-snakemake-workflow-file-structure">
    3.02 Snakemake workflow file structure
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#303-run-the-software-on-the-command-line">
    3.03 Run the software on the command line
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#304-create-the-first-rule-in-your-workflow">
    3.04 Create the first rule in your workflow
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#305-dryrun">
    3.05 Dryrun
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#306-create-a-dag">
    3.06 Create a DAG
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#307-fullrun">
    3.07 Fullrun
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#308-lazy-evaluation">
    3.08 Lazy evaluation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#309-run-using-environment-modules">
    3.09 Run using environment modules
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#310-capture-our-logs">
    3.10 Capture our logs
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#311-scale-up-to-analyse-all-of-our-samples">
    3.11 Scale up to analyse all of our samples
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#312-add-more-rules">
    3.12 Add more rules
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#313-more-about-snakemakes-lazy-behaviour">
    3.13 More about Snakemake's lazy behaviour
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#314-add-even-more-rules">
    3.14 Add even more rules
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#315-throw-it-more-cores">
    3.15 Throw it more cores
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#316-throw-it-even-more-cores">
    3.16 Throw it even more cores
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="03-create-a-basic-workflow">03 - Create a basic workflow<a class="headerlink" href="#03-create-a-basic-workflow" title="Permanent link">¶</a></h1>
<p style="text-align:left;">
<b><a class="btn" href="https://nesi.github.io/snakemake_workshop/workshop_material/02_setup.html" style="background: var(--bs-green);font-weight:bold">« 2 - Setup</a></b>
<span style="float:right;">
<b><a class="btn" href="https://nesi.github.io/snakemake_workshop/workshop_material/04_leveling_up_your_workflow.html" style="background: var(--bs-green);font-weight:bold">4 - Leveling up your WF »</a></b>
</span>
</p>
<ul>
<li toc="toc">Do not remove this line (it will not be displayed)</li>
</ul>
<h2 id="301-aim">3.01 Aim<a class="headerlink" href="#301-aim" title="Permanent link">¶</a></h2>
<hr/>
<p><em>Let's create a basic workflow that will do some of the analysis steps for genetic data. We will have three samples with two files each - six files in total. These files will be processed through the below workflow, passing through three software.</em></p>
<hr/>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/rulegraph_1.png"><img alt="rulegraph_1" src="../images/rulegraph_1.png"/></a></p>
<p>We have paired end sequencing data for three samples <code>NA24631</code> to process in the <code>./data</code> directory. Let's have a look:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>./data/
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot1 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>total<span class="w"> </span>13M
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">2</span>.1M<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:06<span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">2</span>.3M<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:06<span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">2</span>.1M<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:06<span class="w"> </span>NA24694_1.fastq.gz
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">2</span>.3M<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:06<span class="w"> </span>NA24694_2.fastq.gz
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">1</span>.8M<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:06<span class="w"> </span>NA24695_1.fastq.gz
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">1</span>.9M<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:06<span class="w"> </span>NA24695_2.fastq.gz
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot1" content=e3dot1%}
<br/></p>
<h2 id="302-snakemake-workflow-file-structure">3.02 Snakemake workflow file structure<a class="headerlink" href="#302-snakemake-workflow-file-structure" title="Permanent link">¶</a></h2>
<p>Workflow file structure:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>demo_workflow/
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">      </span><span class="p">|</span>_______results/
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">      </span><span class="p">|</span>_______workflow/
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">                 </span><span class="p">|</span>_______Snakefile
</code></pre></div>
<p>We will create and run our workflow from the <code>workflow</code> directory send all of our file outputs/results to the <code>results</code> directory</p>
<p><em>Read up on the best practice workflow structure <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/deployment.html#distribution-and-reproducibility">here</a></em></p>
<p>Create this file structure and our main Snakefile with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>demo_workflow/<span class="o">{</span>results,workflow<span class="o">}</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>touch<span class="w"> </span>demo_workflow/workflow/Snakefile
</code></pre></div>
<p>Now you should have the very beginnings of your Snakemake workflow in a <code>demo_workflow</code> directory. Let's have a look:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>demo_workflow/
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot2 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>total<span class="w"> </span><span class="m">1</span>.0K
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>drwxrws---+<span class="w"> </span><span class="m">2</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">4</span>.0K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>results
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>drwxrws---+<span class="w"> </span><span class="m">2</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">4</span>.0K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>workflow
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot2" content=e3dot2%}
<br/></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>demo_workflow/workflow/
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot3 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>total<span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">0</span><span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:07<span class="w"> </span>Snakefile
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot3" content=e3dot3%}
<br/></p>
<p>Within the <code>workflow</code> directory (where we will create and run our workflow), we have a <code>Snakefile</code> file that will be the backbone of our workflow.</p>
<h2 id="303-run-the-software-on-the-command-line">3.03 Run the software on the command line<a class="headerlink" href="#303-run-the-software-on-the-command-line" title="Permanent link">¶</a></h2>
<p>First lets run the first step in our workflow (<a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/">fastqc</a>) directly on the command line to get the syntax of the command right and check what outputs files we expect to get. Knowing what files the software will output is important for Snakemake since it is a lazy "pull" based system where software/rules will only run if you tell it to create the output file. We will talk more about this later!</p>
<p>First make sure to have <a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/">fastqc</a> available. On NeSI, load the corresponding module</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>module<span class="w"> </span>load<span class="w"> </span>FastQC/0.11.9
</code></pre></div>
<p>See what parameters are available so we know how we want to run this software before we put it in a Snakemake workflow</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a>fastqc<span class="w"> </span>--help
</code></pre></div>
<p>Create a test directory to put the output files</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>mkdir<span class="w"> </span>fastqc_test
</code></pre></div>
<p>Run fastqc directly on the command line on one of the samples</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a>fastqc<span class="w"> </span>./data/NA24631_1.fastq.gz<span class="w"> </span>./data/NA24631_2.fastq.gz<span class="w"> </span>-o<span class="w"> </span>./fastqc_test<span class="w"> </span>-t<span class="w"> </span><span class="m">2</span>
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot4 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>Started<span class="w"> </span>analysis<span class="w"> </span>of<span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>Approx<span class="w"> </span><span class="m">5</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>Approx<span class="w"> </span><span class="m">10</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a>Approx<span class="w"> </span><span class="m">15</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a>Approx<span class="w"> </span><span class="m">20</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a>Approx<span class="w"> </span><span class="m">25</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a>Approx<span class="w"> </span><span class="m">30</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a>Approx<span class="w"> </span><span class="m">35</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a>Approx<span class="w"> </span><span class="m">40</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a>Approx<span class="w"> </span><span class="m">45</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a>Approx<span class="w"> </span><span class="m">50</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a>Approx<span class="w"> </span><span class="m">55</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a>Approx<span class="w"> </span><span class="m">60</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a>Started<span class="w"> </span>analysis<span class="w"> </span>of<span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-15" id="__codelineno-12-15" name="__codelineno-12-15"></a>Approx<span class="w"> </span><span class="m">65</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-16" id="__codelineno-12-16" name="__codelineno-12-16"></a>Approx<span class="w"> </span><span class="m">5</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-17" id="__codelineno-12-17" name="__codelineno-12-17"></a>Approx<span class="w"> </span><span class="m">70</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-18" id="__codelineno-12-18" name="__codelineno-12-18"></a>Approx<span class="w"> </span><span class="m">10</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-19" id="__codelineno-12-19" name="__codelineno-12-19"></a>Approx<span class="w"> </span><span class="m">75</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-20" id="__codelineno-12-20" name="__codelineno-12-20"></a>Approx<span class="w"> </span><span class="m">15</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-21" id="__codelineno-12-21" name="__codelineno-12-21"></a>Approx<span class="w"> </span><span class="m">80</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-22" id="__codelineno-12-22" name="__codelineno-12-22"></a>Approx<span class="w"> </span><span class="m">20</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-23" id="__codelineno-12-23" name="__codelineno-12-23"></a>Approx<span class="w"> </span><span class="m">25</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-24" id="__codelineno-12-24" name="__codelineno-12-24"></a>Approx<span class="w"> </span><span class="m">85</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-25" id="__codelineno-12-25" name="__codelineno-12-25"></a>Approx<span class="w"> </span><span class="m">90</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-26" id="__codelineno-12-26" name="__codelineno-12-26"></a>Approx<span class="w"> </span><span class="m">30</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-27" id="__codelineno-12-27" name="__codelineno-12-27"></a>Approx<span class="w"> </span><span class="m">35</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-28" id="__codelineno-12-28" name="__codelineno-12-28"></a>Approx<span class="w"> </span><span class="m">95</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-29" id="__codelineno-12-29" name="__codelineno-12-29"></a>Approx<span class="w"> </span><span class="m">40</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-30" id="__codelineno-12-30" name="__codelineno-12-30"></a>Analysis<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-12-31" id="__codelineno-12-31" name="__codelineno-12-31"></a>Approx<span class="w"> </span><span class="m">45</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-32" id="__codelineno-12-32" name="__codelineno-12-32"></a>Approx<span class="w"> </span><span class="m">50</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-33" id="__codelineno-12-33" name="__codelineno-12-33"></a>Approx<span class="w"> </span><span class="m">55</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-34" id="__codelineno-12-34" name="__codelineno-12-34"></a>Approx<span class="w"> </span><span class="m">60</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-35" id="__codelineno-12-35" name="__codelineno-12-35"></a>Approx<span class="w"> </span><span class="m">65</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-36" id="__codelineno-12-36" name="__codelineno-12-36"></a>Approx<span class="w"> </span><span class="m">70</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-37" id="__codelineno-12-37" name="__codelineno-12-37"></a>Approx<span class="w"> </span><span class="m">75</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-38" id="__codelineno-12-38" name="__codelineno-12-38"></a>Approx<span class="w"> </span><span class="m">80</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-39" id="__codelineno-12-39" name="__codelineno-12-39"></a>Approx<span class="w"> </span><span class="m">85</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-40" id="__codelineno-12-40" name="__codelineno-12-40"></a>Approx<span class="w"> </span><span class="m">90</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-41" id="__codelineno-12-41" name="__codelineno-12-41"></a>Approx<span class="w"> </span><span class="m">95</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-12-42" id="__codelineno-12-42" name="__codelineno-12-42"></a>Analysis<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot4" content=e3dot4%}
<br/></p>
<p>What are the output files of fastqc? Find out with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>./fastqc_test
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot5 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a>total<span class="w"> </span><span class="m">2</span>.5M
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>718K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:08<span class="w"> </span>NA24631_1_fastqc.html
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>475K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:08<span class="w"> </span>NA24631_1_fastqc.zip
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>726K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:08<span class="w"> </span>NA24631_2_fastqc.html
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>479K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:08<span class="w"> </span>NA24631_2_fastqc.zip
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot5" content=e3dot5%}
<br/></p>
<h2 id="304-create-the-first-rule-in-your-workflow">3.04 Create the first rule in your workflow<a class="headerlink" href="#304-create-the-first-rule-in-your-workflow" title="Permanent link">¶</a></h2>
<p>Let's wrap this up in a Snakemake workflow! Start with the basic structure of a Snakefile:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>rule all:
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w"> </span>   input:
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a># workflow
<a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a>rule my_rule:
<a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w"> </span>   input:
<a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w"> </span>       ""
<a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w"> </span>   output:
<a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w"> </span>       ""
<a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w"> </span>   threads:
<a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w"> </span>   shell:
<a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w"> </span>       ""
</code></pre></div>
<p>Now add our fastqc rule, let's:</p>
<ul>
<li>Name the rule</li>
<li>Fill in the the input fastq files from the <code>data</code> directory (<em>path relative to the Snakefile</em>)</li>
<li>Fill in the output files (now you can see it's useful to know what files fastqc outputs!)</li>
<li>Set the number of threads</li>
<li>Write the fastqc shell command in the <code>shell:</code> section and pass the input/output variables to the shell command</li>
<li>Set the final output files for the whole workflow in <code>rule all:</code></li>
</ul>
<hr/>
<p>The use of the word <code>input</code> in <code>rule all</code> can be confusing, but in this context, it is referring to the final <em>output</em> files of the whole workflow</p>
<hr/>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>rule all:
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w"> </span>   input:
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="gi">+       "../results/fastqc/NA24631_1_fastqc.html",</span>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="gi">+       "../results/fastqc/NA24631_2_fastqc.html",</span>
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="gi">+       "../results/fastqc/NA24631_1_fastqc.zip",</span>
<a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="gi">+       "../results/fastqc/NA24631_2_fastqc.zip"</span>
<a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a>
<a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a># workflow
<a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="gd">- rule my_rule:</span>
<a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="gi">+ rule fastqc:</span>
<a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w"> </span>   input:
<a href="#__codelineno-16-13" id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="gi">+       R1 = "../../data/NA24631_1.fastq.gz",</span>
<a href="#__codelineno-16-14" id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="gi">+       R2 = "../../data/NA24631_2.fastq.gz"</span>
<a href="#__codelineno-16-15" id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="w"> </span>   output:
<a href="#__codelineno-16-16" id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="gi">+       html = ["../results/fastqc/NA24631_1_fastqc.html", "../results/fastqc/NA24631_2_fastqc.html"],</span>
<a href="#__codelineno-16-17" id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="gi">+       zip = ["../results/fastqc/NA24631_1_fastqc.zip", "../results/fastqc/NA24631_2_fastqc.zip"]</span>
<a href="#__codelineno-16-18" id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="gi">+   threads: 2</span>
<a href="#__codelineno-16-19" id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="w"> </span>   shell:
<a href="#__codelineno-16-20" id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="gi">+       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads}"</span>
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e3dot6 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>rule all:
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>    input:
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a>        "../results/fastqc/NA24631_1_fastqc.html",
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a>        "../results/fastqc/NA24631_2_fastqc.html",
<a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>        "../results/fastqc/NA24631_1_fastqc.zip",
<a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>        "../results/fastqc/NA24631_2_fastqc.zip"
<a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>
<a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a># workflow
<a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a>rule fastqc:
<a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>    input:
<a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a>        R1 = "../../data/NA24631_1.fastq.gz",
<a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a>        R2 = "../../data/NA24631_2.fastq.gz"
<a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a>    output:
<a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a>        html = ["../results/fastqc/NA24631_1_fastqc.html", "../results/fastqc/NA24631_2_fastqc.html"],
<a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a>        zip = ["../results/fastqc/NA24631_1_fastqc.zip", "../results/fastqc/NA24631_2_fastqc.zip"]
<a href="#__codelineno-17-17" id="__codelineno-17-17" name="__codelineno-17-17"></a>    threads: 2
<a href="#__codelineno-17-18" id="__codelineno-17-18" name="__codelineno-17-18"></a>    shell:
<a href="#__codelineno-17-19" id="__codelineno-17-19" name="__codelineno-17-19"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot6" content=e3dot6%}
<br/></p>
<p>When you have multiple input and output files:</p>
<ul>
<li>You can "name" you inputs/outputs, they can be called separately in the shell command</li>
<li>Remember to use commas between multiple inputs/outputs, it's a common source of error!</li>
</ul>
<p>Let's test the workflow! First we need to be in the <code>workflow</code> directory, where the Snakefile is</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nb">cd</span><span class="w"> </span>demo_workflow/workflow/
</code></pre></div>
<h2 id="305-dryrun">3.05 Dryrun<a class="headerlink" href="#305-dryrun" title="Permanent link">¶</a></h2>
<p>Then let's carry out a dryrun of the workflow, where no actual analysis is undertaken (fastqc is <em>not</em> run) but the overall Snakemake structure is run/validated. This is a good way to check for errors in your Snakemake workflow before actually running your workflow.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>snakemake<span class="w"> </span>--dryrun
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot7 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a>fastqc<span class="w">        </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a>total<span class="w">         </span><span class="m">2</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a>
<a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a>
<a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:09:56<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24631_1.fastq.gz,<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">1</span>
<a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a>
<a href="#__codelineno-20-17" id="__codelineno-20-17" name="__codelineno-20-17"></a>
<a href="#__codelineno-20-18" id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:09:56<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-20-19" id="__codelineno-20-19" name="__codelineno-20-19"></a>localrule<span class="w"> </span>all:
<a href="#__codelineno-20-20" id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">    </span>input:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-20-21" id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-20-22" id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-20-23" id="__codelineno-20-23" name="__codelineno-20-23"></a>
<a href="#__codelineno-20-24" id="__codelineno-20-24" name="__codelineno-20-24"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-20-25" id="__codelineno-20-25" name="__codelineno-20-25"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-20-26" id="__codelineno-20-26" name="__codelineno-20-26"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-20-27" id="__codelineno-20-27" name="__codelineno-20-27"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-20-28" id="__codelineno-20-28" name="__codelineno-20-28"></a>fastqc<span class="w">        </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-20-29" id="__codelineno-20-29" name="__codelineno-20-29"></a>total<span class="w">         </span><span class="m">2</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-20-30" id="__codelineno-20-30" name="__codelineno-20-30"></a>
<a href="#__codelineno-20-31" id="__codelineno-20-31" name="__codelineno-20-31"></a>This<span class="w"> </span>was<span class="w"> </span>a<span class="w"> </span>dry-run<span class="w"> </span><span class="o">(</span>flag<span class="w"> </span>-n<span class="o">)</span>.<span class="w"> </span>The<span class="w"> </span>order<span class="w"> </span>of<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>reflect<span class="w"> </span>the<span class="w"> </span>order<span class="w"> </span>of<span class="w"> </span>execution.
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot7" content=e3dot7%}
<br/></p>
<p>The last table in the output confirms that the workflow will run one sample (<code>count 1</code>) through fastqc (<code>job fastqc</code>)</p>
<h2 id="306-create-a-dag">3.06 Create a DAG<a class="headerlink" href="#306-create-a-dag" title="Permanent link">¶</a></h2>
<p>We can also visualise our workflow by creating a <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">directed acyclic graph</a> (DAG). We can tell snakemake to create a DAG with the <code>--dag</code> flag, then pipe this output to the <a href="https://graphviz.org/">dot software</a> and write the output to the file, <code>dag_1.png</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a>snakemake<span class="w"> </span>--dag<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>dag_1.png
</code></pre></div>
<p>My DAG:</p>
<p>{% capture e3dot8 %}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/dag_1.png"><img alt="DAG_1" src="../images/dag_1.png"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot8" content=e3dot8%}
<br/></p>
<p>Our diagram has a node for each job which are connected by edges representing dependencies</p>
<p><em>Note. this diagram can be output to several other image formats such as svg or pdf</em></p>
<h2 id="307-fullrun">3.07 Fullrun<a class="headerlink" href="#307-fullrun" title="Permanent link">¶</a></h2>
<p>Let's do a full run of our workflow (by removing the <code>--dryrun</code> flag). We will also now need to specify the maximum number of cores to use at one time with the <code>--cores</code> flag before snakemake will run</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span>
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot9 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a>Using<span class="w"> </span>shell:<span class="w"> </span>/usr/bin/bash
<a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a>Provided<span class="w"> </span>cores:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a>Rules<span class="w"> </span>claiming<span class="w"> </span>more<span class="w"> </span>threads<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>scaled<span class="w"> </span>down.
<a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a>fastqc<span class="w">        </span><span class="m">1</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a>total<span class="w">         </span><span class="m">2</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a>
<a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a>
<a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:10:44<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24631_1.fastq.gz,<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">1</span>
<a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-23-20" id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-23-21" id="__codelineno-23-21" name="__codelineno-23-21"></a>
<a href="#__codelineno-23-22" id="__codelineno-23-22" name="__codelineno-23-22"></a>Started<span class="w"> </span>analysis<span class="w"> </span>of<span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-23" id="__codelineno-23-23" name="__codelineno-23-23"></a>Approx<span class="w"> </span><span class="m">5</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-24" id="__codelineno-23-24" name="__codelineno-23-24"></a>Approx<span class="w"> </span><span class="m">10</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-25" id="__codelineno-23-25" name="__codelineno-23-25"></a>Approx<span class="w"> </span><span class="m">15</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-26" id="__codelineno-23-26" name="__codelineno-23-26"></a>Approx<span class="w"> </span><span class="m">20</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-27" id="__codelineno-23-27" name="__codelineno-23-27"></a>Approx<span class="w"> </span><span class="m">25</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-28" id="__codelineno-23-28" name="__codelineno-23-28"></a>Approx<span class="w"> </span><span class="m">30</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-29" id="__codelineno-23-29" name="__codelineno-23-29"></a>Approx<span class="w"> </span><span class="m">35</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-30" id="__codelineno-23-30" name="__codelineno-23-30"></a>Approx<span class="w"> </span><span class="m">40</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-31" id="__codelineno-23-31" name="__codelineno-23-31"></a>Approx<span class="w"> </span><span class="m">45</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-32" id="__codelineno-23-32" name="__codelineno-23-32"></a>Approx<span class="w"> </span><span class="m">50</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-33" id="__codelineno-23-33" name="__codelineno-23-33"></a>Approx<span class="w"> </span><span class="m">55</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-34" id="__codelineno-23-34" name="__codelineno-23-34"></a>Approx<span class="w"> </span><span class="m">60</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-35" id="__codelineno-23-35" name="__codelineno-23-35"></a>Approx<span class="w"> </span><span class="m">65</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-36" id="__codelineno-23-36" name="__codelineno-23-36"></a>Started<span class="w"> </span>analysis<span class="w"> </span>of<span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-37" id="__codelineno-23-37" name="__codelineno-23-37"></a>Approx<span class="w"> </span><span class="m">70</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-38" id="__codelineno-23-38" name="__codelineno-23-38"></a>Approx<span class="w"> </span><span class="m">5</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-39" id="__codelineno-23-39" name="__codelineno-23-39"></a>Approx<span class="w"> </span><span class="m">75</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-40" id="__codelineno-23-40" name="__codelineno-23-40"></a>Approx<span class="w"> </span><span class="m">10</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-41" id="__codelineno-23-41" name="__codelineno-23-41"></a>Approx<span class="w"> </span><span class="m">80</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-42" id="__codelineno-23-42" name="__codelineno-23-42"></a>Approx<span class="w"> </span><span class="m">15</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-43" id="__codelineno-23-43" name="__codelineno-23-43"></a>Approx<span class="w"> </span><span class="m">85</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-44" id="__codelineno-23-44" name="__codelineno-23-44"></a>Approx<span class="w"> </span><span class="m">20</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-45" id="__codelineno-23-45" name="__codelineno-23-45"></a>Approx<span class="w"> </span><span class="m">90</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-46" id="__codelineno-23-46" name="__codelineno-23-46"></a>Approx<span class="w"> </span><span class="m">25</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-47" id="__codelineno-23-47" name="__codelineno-23-47"></a>Approx<span class="w"> </span><span class="m">95</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-48" id="__codelineno-23-48" name="__codelineno-23-48"></a>Approx<span class="w"> </span><span class="m">30</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-49" id="__codelineno-23-49" name="__codelineno-23-49"></a>Analysis<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-23-50" id="__codelineno-23-50" name="__codelineno-23-50"></a>Approx<span class="w"> </span><span class="m">35</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-51" id="__codelineno-23-51" name="__codelineno-23-51"></a>Approx<span class="w"> </span><span class="m">40</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-52" id="__codelineno-23-52" name="__codelineno-23-52"></a>Approx<span class="w"> </span><span class="m">45</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-53" id="__codelineno-23-53" name="__codelineno-23-53"></a>Approx<span class="w"> </span><span class="m">50</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-54" id="__codelineno-23-54" name="__codelineno-23-54"></a>Approx<span class="w"> </span><span class="m">55</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-55" id="__codelineno-23-55" name="__codelineno-23-55"></a>Approx<span class="w"> </span><span class="m">60</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-56" id="__codelineno-23-56" name="__codelineno-23-56"></a>Approx<span class="w"> </span><span class="m">65</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-57" id="__codelineno-23-57" name="__codelineno-23-57"></a>Approx<span class="w"> </span><span class="m">70</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-58" id="__codelineno-23-58" name="__codelineno-23-58"></a>Approx<span class="w"> </span><span class="m">75</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-59" id="__codelineno-23-59" name="__codelineno-23-59"></a>Approx<span class="w"> </span><span class="m">80</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-60" id="__codelineno-23-60" name="__codelineno-23-60"></a>Approx<span class="w"> </span><span class="m">85</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-61" id="__codelineno-23-61" name="__codelineno-23-61"></a>Approx<span class="w"> </span><span class="m">90</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-62" id="__codelineno-23-62" name="__codelineno-23-62"></a>Approx<span class="w"> </span><span class="m">95</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-63" id="__codelineno-23-63" name="__codelineno-23-63"></a>Analysis<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-23-64" id="__codelineno-23-64" name="__codelineno-23-64"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:10:48<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-23-65" id="__codelineno-23-65" name="__codelineno-23-65"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">1</span>.
<a href="#__codelineno-23-66" id="__codelineno-23-66" name="__codelineno-23-66"></a><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">2</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">50</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-23-67" id="__codelineno-23-67" name="__codelineno-23-67"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-23-68" id="__codelineno-23-68" name="__codelineno-23-68"></a>
<a href="#__codelineno-23-69" id="__codelineno-23-69" name="__codelineno-23-69"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:10:48<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-23-70" id="__codelineno-23-70" name="__codelineno-23-70"></a>localrule<span class="w"> </span>all:
<a href="#__codelineno-23-71" id="__codelineno-23-71" name="__codelineno-23-71"></a><span class="w">    </span>input:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-23-72" id="__codelineno-23-72" name="__codelineno-23-72"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-23-73" id="__codelineno-23-73" name="__codelineno-23-73"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-23-74" id="__codelineno-23-74" name="__codelineno-23-74"></a>
<a href="#__codelineno-23-75" id="__codelineno-23-75" name="__codelineno-23-75"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:10:48<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-23-76" id="__codelineno-23-76" name="__codelineno-23-76"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">0</span>.
<a href="#__codelineno-23-77" id="__codelineno-23-77" name="__codelineno-23-77"></a><span class="m">2</span><span class="w"> </span>of<span class="w"> </span><span class="m">2</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">100</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-23-78" id="__codelineno-23-78" name="__codelineno-23-78"></a>Complete<span class="w"> </span>log:<span class="w"> </span>.snakemake/log/2022-05-11T121044.745212.snakemake.log
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot9" content=e3dot9%}
<br/></p>
<p>It worked! Now in our results directory we have our output files from fastqc. Let's have a look:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>../results/fastqc/
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot10 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a>total<span class="w"> </span><span class="m">2</span>.5M
<a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>718K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:10<span class="w"> </span>NA24631_1_fastqc.html
<a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>475K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:10<span class="w"> </span>NA24631_1_fastqc.zip
<a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>726K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:10<span class="w"> </span>NA24631_2_fastqc.html
<a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span>479K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:10<span class="w"> </span>NA24631_2_fastqc.zip
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot10" content=e3dot10%}
<br/></p>
<h2 id="308-lazy-evaluation">3.08 Lazy evaluation<a class="headerlink" href="#308-lazy-evaluation" title="Permanent link">¶</a></h2>
<p>What happens if we try a dryrun or full run now?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span>
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot11 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a>Nothing<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span><span class="k">done</span><span class="w"> </span><span class="o">(</span>all<span class="w"> </span>requested<span class="w"> </span>files<span class="w"> </span>are<span class="w"> </span>present<span class="w"> </span>and<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span>date<span class="o">)</span>.
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot11" content=e3dot11%}
<br/></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span>
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot12 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a>Nothing<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span><span class="k">done</span><span class="w"> </span><span class="o">(</span>all<span class="w"> </span>requested<span class="w"> </span>files<span class="w"> </span>are<span class="w"> </span>present<span class="w"> </span>and<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span>date<span class="o">)</span>.
<a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a>Complete<span class="w"> </span>log:<span class="w"> </span>.snakemake/log/2022-05-11T121300.251492.snakemake.log
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot12" content=e3dot12%}
<br/></p>
<p>Nothing happens, all the target files in <code>rule all</code> have already been created so Snakemake does nothing</p>
<p>Also, what happens if we create another directed acyclic graph (DAG) after the workflow has been run?</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a>snakemake<span class="w"> </span>--dag<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>dag_2.png
</code></pre></div>
<p>My DAG:</p>
<p>{% capture e3dot13 %}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/dag_2.png"><img alt="DAG_2" src="../images/dag_2.png"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot13" content=e3dot13%}
<br/></p>
<p>Notice our workflow 'job nodes' are now dashed lines, this indicates that their output is up to date and therefore the rule doesn't need to be run. We already have our target files!</p>
<p>This can be quite informative if your workflow errors out at a rule. You can visually check which rules successfully ran and which didn't.</p>
<h2 id="309-run-using-environment-modules">3.09 Run using environment modules<a class="headerlink" href="#309-run-using-environment-modules" title="Permanent link">¶</a></h2>
<p>fastqc worked because we loaded it in our current shell session. Let's specify the environment module for fastqc so the user of the workflow doesn't need to load it manually.</p>
<p>Update our rule to use it using the <code>envmodules:</code> directive</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>rule all:
<a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w"> </span>   input:
<a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w"> </span>       "../results/fastqc/NA24631_1_fastqc.html",
<a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w"> </span>       "../results/fastqc/NA24631_2_fastqc.html",
<a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w"> </span>       "../results/fastqc/NA24631_1_fastqc.zip",
<a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w"> </span>       "../results/fastqc/NA24631_2_fastqc.zip"
<a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a>
<a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a># workflow
<a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a>rule fastqc:
<a href="#__codelineno-31-11" id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="w"> </span>   input:
<a href="#__codelineno-31-12" id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w"> </span>       R1 = "../../data/NA24631_1.fastq.gz",
<a href="#__codelineno-31-13" id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w"> </span>       R2 = "../../data/NA24631_2.fastq.gz"
<a href="#__codelineno-31-14" id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="w"> </span>   output:
<a href="#__codelineno-31-15" id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="w"> </span>       html = ["../results/fastqc/NA24631_1_fastqc.html", "../results/fastqc/NA24631_2_fastqc.html"],
<a href="#__codelineno-31-16" id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="w"> </span>       zip = ["../results/fastqc/NA24631_1_fastqc.zip", "../results/fastqc/NA24631_2_fastqc.zip"]
<a href="#__codelineno-31-17" id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-31-18" id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="gi">+   envmodules:</span>
<a href="#__codelineno-31-19" id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="gi">+       "FastQC/0.11.9"</span>
<a href="#__codelineno-31-20" id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w"> </span>   shell:
<a href="#__codelineno-31-21" id="__codelineno-31-21" name="__codelineno-31-21"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads}"
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e3dot14 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a>rule all:
<a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a>    input:
<a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a>        "../results/fastqc/NA24631_1_fastqc.html",
<a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a>        "../results/fastqc/NA24631_2_fastqc.html",
<a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a>        "../results/fastqc/NA24631_1_fastqc.zip",
<a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a>        "../results/fastqc/NA24631_2_fastqc.zip"
<a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a>
<a href="#__codelineno-32-9" id="__codelineno-32-9" name="__codelineno-32-9"></a># workflow
<a href="#__codelineno-32-10" id="__codelineno-32-10" name="__codelineno-32-10"></a>rule fastqc:
<a href="#__codelineno-32-11" id="__codelineno-32-11" name="__codelineno-32-11"></a>    input:
<a href="#__codelineno-32-12" id="__codelineno-32-12" name="__codelineno-32-12"></a>        R1 = "../../data/NA24631_1.fastq.gz",
<a href="#__codelineno-32-13" id="__codelineno-32-13" name="__codelineno-32-13"></a>        R2 = "../../data/NA24631_2.fastq.gz"
<a href="#__codelineno-32-14" id="__codelineno-32-14" name="__codelineno-32-14"></a>    output:
<a href="#__codelineno-32-15" id="__codelineno-32-15" name="__codelineno-32-15"></a>        html = ["../results/fastqc/NA24631_1_fastqc.html", "../results/fastqc/NA24631_2_fastqc.html"],
<a href="#__codelineno-32-16" id="__codelineno-32-16" name="__codelineno-32-16"></a>        zip = ["../results/fastqc/NA24631_1_fastqc.zip", "../results/fastqc/NA24631_2_fastqc.zip"]
<a href="#__codelineno-32-17" id="__codelineno-32-17" name="__codelineno-32-17"></a>    threads: 2
<a href="#__codelineno-32-18" id="__codelineno-32-18" name="__codelineno-32-18"></a>    envmodules:
<a href="#__codelineno-32-19" id="__codelineno-32-19" name="__codelineno-32-19"></a>        "FastQC/0.11.9"
<a href="#__codelineno-32-20" id="__codelineno-32-20" name="__codelineno-32-20"></a>    shell:
<a href="#__codelineno-32-21" id="__codelineno-32-21" name="__codelineno-32-21"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot14" content=e3dot14%}
<br/></p>
<p>Run again, now telling Snakemake to use <a href="https://nesi.github.io/hpc-intro/14-modules/index.html">environment modules</a> to automatically load our software by using the <code>--use-envmodules</code> flag</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a># first remove output of last run
<a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a>rm -r ../results/*
<a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a>
<a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a># Run dryrun again
<a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="gd">- snakemake --dryrun --cores 2</span>
<a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="gi">+ snakemake --dryrun --cores 2 --use-envmodules</span>
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot15 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a>fastqc<span class="w">        </span><span class="m">1</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a>total<span class="w">         </span><span class="m">2</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-34-8" id="__codelineno-34-8" name="__codelineno-34-8"></a>
<a href="#__codelineno-34-9" id="__codelineno-34-9" name="__codelineno-34-9"></a>
<a href="#__codelineno-34-10" id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:13:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-34-11" id="__codelineno-34-11" name="__codelineno-34-11"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-34-12" id="__codelineno-34-12" name="__codelineno-34-12"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24631_1.fastq.gz,<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a href="#__codelineno-34-13" id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-34-14" id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">1</span>
<a href="#__codelineno-34-15" id="__codelineno-34-15" name="__codelineno-34-15"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-34-16" id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-34-17" id="__codelineno-34-17" name="__codelineno-34-17"></a>
<a href="#__codelineno-34-18" id="__codelineno-34-18" name="__codelineno-34-18"></a>
<a href="#__codelineno-34-19" id="__codelineno-34-19" name="__codelineno-34-19"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:13:52<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-34-20" id="__codelineno-34-20" name="__codelineno-34-20"></a>localrule<span class="w"> </span>all:
<a href="#__codelineno-34-21" id="__codelineno-34-21" name="__codelineno-34-21"></a><span class="w">    </span>input:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-34-22" id="__codelineno-34-22" name="__codelineno-34-22"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-34-23" id="__codelineno-34-23" name="__codelineno-34-23"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-34-24" id="__codelineno-34-24" name="__codelineno-34-24"></a>
<a href="#__codelineno-34-25" id="__codelineno-34-25" name="__codelineno-34-25"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-34-26" id="__codelineno-34-26" name="__codelineno-34-26"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-34-27" id="__codelineno-34-27" name="__codelineno-34-27"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-34-28" id="__codelineno-34-28" name="__codelineno-34-28"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-34-29" id="__codelineno-34-29" name="__codelineno-34-29"></a>fastqc<span class="w">        </span><span class="m">1</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-34-30" id="__codelineno-34-30" name="__codelineno-34-30"></a>total<span class="w">         </span><span class="m">2</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-34-31" id="__codelineno-34-31" name="__codelineno-34-31"></a>
<a href="#__codelineno-34-32" id="__codelineno-34-32" name="__codelineno-34-32"></a>This<span class="w"> </span>was<span class="w"> </span>a<span class="w"> </span>dry-run<span class="w"> </span><span class="o">(</span>flag<span class="w"> </span>-n<span class="o">)</span>.<span class="w"> </span>The<span class="w"> </span>order<span class="w"> </span>of<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>reflect<span class="w"> </span>the<span class="w"> </span>order<span class="w"> </span>of<span class="w"> </span>execution.
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot15" content=e3dot15%}
<br/></p>
<p>Let's do a full run</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="gd">- snakemake --cores 2</span>
<a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="gi">+ snakemake --cores 2 --use-envmodules</span>
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot16 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a>Using<span class="w"> </span>shell:<span class="w"> </span>/usr/bin/bash
<a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a>Provided<span class="w"> </span>cores:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-36-4" id="__codelineno-36-4" name="__codelineno-36-4"></a>Rules<span class="w"> </span>claiming<span class="w"> </span>more<span class="w"> </span>threads<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>scaled<span class="w"> </span>down.
<a href="#__codelineno-36-5" id="__codelineno-36-5" name="__codelineno-36-5"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-36-6" id="__codelineno-36-6" name="__codelineno-36-6"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-36-7" id="__codelineno-36-7" name="__codelineno-36-7"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-36-8" id="__codelineno-36-8" name="__codelineno-36-8"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-36-9" id="__codelineno-36-9" name="__codelineno-36-9"></a>fastqc<span class="w">        </span><span class="m">1</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-36-10" id="__codelineno-36-10" name="__codelineno-36-10"></a>total<span class="w">         </span><span class="m">2</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-36-11" id="__codelineno-36-11" name="__codelineno-36-11"></a>
<a href="#__codelineno-36-12" id="__codelineno-36-12" name="__codelineno-36-12"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-36-13" id="__codelineno-36-13" name="__codelineno-36-13"></a>
<a href="#__codelineno-36-14" id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:14:22<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-36-15" id="__codelineno-36-15" name="__codelineno-36-15"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-36-16" id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24631_1.fastq.gz,<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a href="#__codelineno-36-17" id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-36-18" id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">1</span>
<a href="#__codelineno-36-19" id="__codelineno-36-19" name="__codelineno-36-19"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-36-20" id="__codelineno-36-20" name="__codelineno-36-20"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-36-21" id="__codelineno-36-21" name="__codelineno-36-21"></a>
<a href="#__codelineno-36-22" id="__codelineno-36-22" name="__codelineno-36-22"></a>Activating<span class="w"> </span>environment<span class="w"> </span>modules:<span class="w"> </span>FastQC/0.11.9
<a href="#__codelineno-36-23" id="__codelineno-36-23" name="__codelineno-36-23"></a>
<a href="#__codelineno-36-24" id="__codelineno-36-24" name="__codelineno-36-24"></a>The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<a href="#__codelineno-36-25" id="__codelineno-36-25" name="__codelineno-36-25"></a><span class="w">   </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">"module --force purge"</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:
<a href="#__codelineno-36-26" id="__codelineno-36-26" name="__codelineno-36-26"></a>
<a href="#__codelineno-36-27" id="__codelineno-36-27" name="__codelineno-36-27"></a><span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>XALT/minimal<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>slurm<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>NeSI
<a href="#__codelineno-36-28" id="__codelineno-36-28" name="__codelineno-36-28"></a>Started<span class="w"> </span>analysis<span class="w"> </span>of<span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-29" id="__codelineno-36-29" name="__codelineno-36-29"></a>Approx<span class="w"> </span><span class="m">5</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-30" id="__codelineno-36-30" name="__codelineno-36-30"></a>Approx<span class="w"> </span><span class="m">10</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-31" id="__codelineno-36-31" name="__codelineno-36-31"></a>Approx<span class="w"> </span><span class="m">15</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-32" id="__codelineno-36-32" name="__codelineno-36-32"></a>Approx<span class="w"> </span><span class="m">20</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-33" id="__codelineno-36-33" name="__codelineno-36-33"></a>Approx<span class="w"> </span><span class="m">25</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-34" id="__codelineno-36-34" name="__codelineno-36-34"></a>Approx<span class="w"> </span><span class="m">30</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-35" id="__codelineno-36-35" name="__codelineno-36-35"></a>Approx<span class="w"> </span><span class="m">35</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-36" id="__codelineno-36-36" name="__codelineno-36-36"></a>Approx<span class="w"> </span><span class="m">40</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-37" id="__codelineno-36-37" name="__codelineno-36-37"></a>Approx<span class="w"> </span><span class="m">45</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-38" id="__codelineno-36-38" name="__codelineno-36-38"></a>Approx<span class="w"> </span><span class="m">50</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-39" id="__codelineno-36-39" name="__codelineno-36-39"></a>Approx<span class="w"> </span><span class="m">55</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-40" id="__codelineno-36-40" name="__codelineno-36-40"></a>Approx<span class="w"> </span><span class="m">60</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-41" id="__codelineno-36-41" name="__codelineno-36-41"></a>Approx<span class="w"> </span><span class="m">65</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-42" id="__codelineno-36-42" name="__codelineno-36-42"></a>Approx<span class="w"> </span><span class="m">70</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-43" id="__codelineno-36-43" name="__codelineno-36-43"></a>Approx<span class="w"> </span><span class="m">75</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-44" id="__codelineno-36-44" name="__codelineno-36-44"></a>Started<span class="w"> </span>analysis<span class="w"> </span>of<span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-45" id="__codelineno-36-45" name="__codelineno-36-45"></a>Approx<span class="w"> </span><span class="m">5</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-46" id="__codelineno-36-46" name="__codelineno-36-46"></a>Approx<span class="w"> </span><span class="m">80</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-47" id="__codelineno-36-47" name="__codelineno-36-47"></a>Approx<span class="w"> </span><span class="m">10</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-48" id="__codelineno-36-48" name="__codelineno-36-48"></a>Approx<span class="w"> </span><span class="m">85</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-49" id="__codelineno-36-49" name="__codelineno-36-49"></a>Approx<span class="w"> </span><span class="m">15</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-50" id="__codelineno-36-50" name="__codelineno-36-50"></a>Approx<span class="w"> </span><span class="m">90</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-51" id="__codelineno-36-51" name="__codelineno-36-51"></a>Approx<span class="w"> </span><span class="m">20</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-52" id="__codelineno-36-52" name="__codelineno-36-52"></a>Approx<span class="w"> </span><span class="m">95</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-53" id="__codelineno-36-53" name="__codelineno-36-53"></a>Approx<span class="w"> </span><span class="m">25</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-54" id="__codelineno-36-54" name="__codelineno-36-54"></a>Analysis<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-36-55" id="__codelineno-36-55" name="__codelineno-36-55"></a>Approx<span class="w"> </span><span class="m">30</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-56" id="__codelineno-36-56" name="__codelineno-36-56"></a>Approx<span class="w"> </span><span class="m">35</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-57" id="__codelineno-36-57" name="__codelineno-36-57"></a>Approx<span class="w"> </span><span class="m">40</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-58" id="__codelineno-36-58" name="__codelineno-36-58"></a>Approx<span class="w"> </span><span class="m">45</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-59" id="__codelineno-36-59" name="__codelineno-36-59"></a>Approx<span class="w"> </span><span class="m">50</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-60" id="__codelineno-36-60" name="__codelineno-36-60"></a>Approx<span class="w"> </span><span class="m">55</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-61" id="__codelineno-36-61" name="__codelineno-36-61"></a>Approx<span class="w"> </span><span class="m">60</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-62" id="__codelineno-36-62" name="__codelineno-36-62"></a>Approx<span class="w"> </span><span class="m">65</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-63" id="__codelineno-36-63" name="__codelineno-36-63"></a>Approx<span class="w"> </span><span class="m">70</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-64" id="__codelineno-36-64" name="__codelineno-36-64"></a>Approx<span class="w"> </span><span class="m">75</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-65" id="__codelineno-36-65" name="__codelineno-36-65"></a>Approx<span class="w"> </span><span class="m">80</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-66" id="__codelineno-36-66" name="__codelineno-36-66"></a>Approx<span class="w"> </span><span class="m">85</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-67" id="__codelineno-36-67" name="__codelineno-36-67"></a>Approx<span class="w"> </span><span class="m">90</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-68" id="__codelineno-36-68" name="__codelineno-36-68"></a>Approx<span class="w"> </span><span class="m">95</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-69" id="__codelineno-36-69" name="__codelineno-36-69"></a>Analysis<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_2.fastq.gz
<a href="#__codelineno-36-70" id="__codelineno-36-70" name="__codelineno-36-70"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:14:26<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-36-71" id="__codelineno-36-71" name="__codelineno-36-71"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">1</span>.
<a href="#__codelineno-36-72" id="__codelineno-36-72" name="__codelineno-36-72"></a><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">2</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">50</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-36-73" id="__codelineno-36-73" name="__codelineno-36-73"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-36-74" id="__codelineno-36-74" name="__codelineno-36-74"></a>
<a href="#__codelineno-36-75" id="__codelineno-36-75" name="__codelineno-36-75"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:14:26<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-36-76" id="__codelineno-36-76" name="__codelineno-36-76"></a>localrule<span class="w"> </span>all:
<a href="#__codelineno-36-77" id="__codelineno-36-77" name="__codelineno-36-77"></a><span class="w">    </span>input:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-36-78" id="__codelineno-36-78" name="__codelineno-36-78"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-36-79" id="__codelineno-36-79" name="__codelineno-36-79"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-36-80" id="__codelineno-36-80" name="__codelineno-36-80"></a>
<a href="#__codelineno-36-81" id="__codelineno-36-81" name="__codelineno-36-81"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:14:26<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-36-82" id="__codelineno-36-82" name="__codelineno-36-82"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">0</span>.
<a href="#__codelineno-36-83" id="__codelineno-36-83" name="__codelineno-36-83"></a><span class="m">2</span><span class="w"> </span>of<span class="w"> </span><span class="m">2</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">100</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-36-84" id="__codelineno-36-84" name="__codelineno-36-84"></a>Complete<span class="w"> </span>log:<span class="w"> </span>.snakemake/log/2022-05-11T121422.744466.snakemake.log
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot16" content=e3dot16%}
<br/></p>
<p>Notice it now says that "Activating environment modules: FastQC/0.11.9". Now the software our workflow uses will be automatically loaded!</p>
<h2 id="310-capture-our-logs">3.10 Capture our logs<a class="headerlink" href="#310-capture-our-logs" title="Permanent link">¶</a></h2>
<p>So far our logs (for fastqc) have been simply printed to our screen. As you can imagine, if you had a large automated workflow (that you might not be sitting at the computer watching run) you'll want to capture all that information. Therefore, any information the software spits out (including error messages!) will be kept and can be looked at once you return to your machine from your coffee break.</p>
<p>We can get the logs for each rule to be written to a log file via the <code>log:</code> directive:</p>
<ul>
<li>It's a good idea to organise the logs by:</li>
<li>Putting the logs in a directory labelled after the rule/software that was run</li>
<li>
<p>Labelling the log files with the sample name the software was run on</p>
</li>
<li>
<p>Also make sure you tell the software (fastqc) to write the standard output and standard error to this log file we defined in the <code>log:</code> directive in the shell script (eg. <code>&amp;&gt; {log}</code>)</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a>rule all:
<a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="w"> </span>   input:
<a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="w"> </span>       "../results/fastqc/NA24631_1_fastqc.html",
<a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w"> </span>       "../results/fastqc/NA24631_2_fastqc.html",
<a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w"> </span>       "../results/fastqc/NA24631_1_fastqc.zip",
<a href="#__codelineno-37-7" id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="w"> </span>       "../results/fastqc/NA24631_2_fastqc.zip"
<a href="#__codelineno-37-8" id="__codelineno-37-8" name="__codelineno-37-8"></a>
<a href="#__codelineno-37-9" id="__codelineno-37-9" name="__codelineno-37-9"></a># workflow
<a href="#__codelineno-37-10" id="__codelineno-37-10" name="__codelineno-37-10"></a>rule fastqc:
<a href="#__codelineno-37-11" id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="w"> </span>   input:
<a href="#__codelineno-37-12" id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="w"> </span>       R1 = "../../data/NA24631_1.fastq.gz",
<a href="#__codelineno-37-13" id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="w"> </span>       R2 = "../../data/NA24631_2.fastq.gz"
<a href="#__codelineno-37-14" id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w"> </span>   output:
<a href="#__codelineno-37-15" id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w"> </span>       html = ["../results/fastqc/NA24631_1_fastqc.html", "../results/fastqc/NA24631_2_fastqc.html"],
<a href="#__codelineno-37-16" id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="w"> </span>       zip = ["../results/fastqc/NA24631_1_fastqc.zip", "../results/fastqc/NA24631_2_fastqc.zip"]
<a href="#__codelineno-37-17" id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="gi">+   log:</span>
<a href="#__codelineno-37-18" id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="gi">+       "logs/fastqc/NA24631.log"</span>
<a href="#__codelineno-37-19" id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-37-20" id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-37-21" id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-37-22" id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="w"> </span>   shell:
<a href="#__codelineno-37-23" id="__codelineno-37-23" name="__codelineno-37-23"></a><span class="gd">-       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads}"</span>
<a href="#__codelineno-37-24" id="__codelineno-37-24" name="__codelineno-37-24"></a><span class="gi">+       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"</span>
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e3dot17 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a>rule all:
<a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a>    input:
<a href="#__codelineno-38-4" id="__codelineno-38-4" name="__codelineno-38-4"></a>        "../results/fastqc/NA24631_1_fastqc.html",
<a href="#__codelineno-38-5" id="__codelineno-38-5" name="__codelineno-38-5"></a>        "../results/fastqc/NA24631_2_fastqc.html",
<a href="#__codelineno-38-6" id="__codelineno-38-6" name="__codelineno-38-6"></a>        "../results/fastqc/NA24631_1_fastqc.zip",
<a href="#__codelineno-38-7" id="__codelineno-38-7" name="__codelineno-38-7"></a>        "../results/fastqc/NA24631_2_fastqc.zip"
<a href="#__codelineno-38-8" id="__codelineno-38-8" name="__codelineno-38-8"></a>
<a href="#__codelineno-38-9" id="__codelineno-38-9" name="__codelineno-38-9"></a># workflow
<a href="#__codelineno-38-10" id="__codelineno-38-10" name="__codelineno-38-10"></a>rule fastqc:
<a href="#__codelineno-38-11" id="__codelineno-38-11" name="__codelineno-38-11"></a>    input:
<a href="#__codelineno-38-12" id="__codelineno-38-12" name="__codelineno-38-12"></a>        R1 = "../../data/NA24631_1.fastq.gz",
<a href="#__codelineno-38-13" id="__codelineno-38-13" name="__codelineno-38-13"></a>        R2 = "../../data/NA24631_2.fastq.gz"
<a href="#__codelineno-38-14" id="__codelineno-38-14" name="__codelineno-38-14"></a>    output:
<a href="#__codelineno-38-15" id="__codelineno-38-15" name="__codelineno-38-15"></a>        html = ["../results/fastqc/NA24631_1_fastqc.html", "../results/fastqc/NA24631_2_fastqc.html"],
<a href="#__codelineno-38-16" id="__codelineno-38-16" name="__codelineno-38-16"></a>        zip = ["../results/fastqc/NA24631_1_fastqc.zip", "../results/fastqc/NA24631_2_fastqc.zip"]
<a href="#__codelineno-38-17" id="__codelineno-38-17" name="__codelineno-38-17"></a>    log:
<a href="#__codelineno-38-18" id="__codelineno-38-18" name="__codelineno-38-18"></a>        "logs/fastqc/NA24631.log"
<a href="#__codelineno-38-19" id="__codelineno-38-19" name="__codelineno-38-19"></a>    threads: 2
<a href="#__codelineno-38-20" id="__codelineno-38-20" name="__codelineno-38-20"></a>    envmodules:
<a href="#__codelineno-38-21" id="__codelineno-38-21" name="__codelineno-38-21"></a>        "FastQC/0.11.9"
<a href="#__codelineno-38-22" id="__codelineno-38-22" name="__codelineno-38-22"></a>    shell:
<a href="#__codelineno-38-23" id="__codelineno-38-23" name="__codelineno-38-23"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot17" content=e3dot17%}
<br/></p>
<hr/>
<p>A tangent about <a href="https://en.wikipedia.org/wiki/Standard_streams">standard streams</a></p>
<ul>
<li>These are standard streams in which information is returned by a computer process - in our case the logs that we see returned to us on our screen when we run fastqc</li>
<li>There are two main streams:</li>
<li>standard output (the log messages)</li>
<li>standard error (the error messages)</li>
</ul>
<p>Different ways to write log files:</p>
<table>
<thead>
<tr>
<th>Syntax</th>
<th>standard output in terminal</th>
<th>standard error in terminal</th>
<th>standard output in file</th>
<th>standard error in file</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&gt;</code></td>
<td>NO</td>
<td>YES</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr>
<td><code>2&gt;</code></td>
<td>YES</td>
<td>NO</td>
<td>NO</td>
<td>YES</td>
</tr>
<tr>
<td><code>&amp;&gt;</code></td>
<td>NO</td>
<td>NO</td>
<td>YES</td>
<td>YES</td>
</tr>
</tbody>
</table>
<p>(Table adapted from <a href="https://askubuntu.com/questions/420981/how-do-i-save-terminal-output-to-a-file">here</a>)</p>
<hr/>
<p>Run again</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a>
<a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="c1"># run dryrun/run again</span>
<a href="#__codelineno-39-5" id="__codelineno-39-5" name="__codelineno-39-5"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
<a href="#__codelineno-39-6" id="__codelineno-39-6" name="__codelineno-39-6"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot18 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a>Using<span class="w"> </span>shell:<span class="w"> </span>/usr/bin/bash
<a href="#__codelineno-40-3" id="__codelineno-40-3" name="__codelineno-40-3"></a>Provided<span class="w"> </span>cores:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-40-4" id="__codelineno-40-4" name="__codelineno-40-4"></a>Rules<span class="w"> </span>claiming<span class="w"> </span>more<span class="w"> </span>threads<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>scaled<span class="w"> </span>down.
<a href="#__codelineno-40-5" id="__codelineno-40-5" name="__codelineno-40-5"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-40-6" id="__codelineno-40-6" name="__codelineno-40-6"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-40-7" id="__codelineno-40-7" name="__codelineno-40-7"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-40-8" id="__codelineno-40-8" name="__codelineno-40-8"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-40-9" id="__codelineno-40-9" name="__codelineno-40-9"></a>fastqc<span class="w">        </span><span class="m">1</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-40-10" id="__codelineno-40-10" name="__codelineno-40-10"></a>total<span class="w">         </span><span class="m">2</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-40-11" id="__codelineno-40-11" name="__codelineno-40-11"></a>
<a href="#__codelineno-40-12" id="__codelineno-40-12" name="__codelineno-40-12"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-40-13" id="__codelineno-40-13" name="__codelineno-40-13"></a>
<a href="#__codelineno-40-14" id="__codelineno-40-14" name="__codelineno-40-14"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:15:16<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-40-15" id="__codelineno-40-15" name="__codelineno-40-15"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-40-16" id="__codelineno-40-16" name="__codelineno-40-16"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24631_1.fastq.gz,<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a href="#__codelineno-40-17" id="__codelineno-40-17" name="__codelineno-40-17"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-40-18" id="__codelineno-40-18" name="__codelineno-40-18"></a><span class="w">    </span>log:<span class="w"> </span>logs/fastqc/NA24631.log
<a href="#__codelineno-40-19" id="__codelineno-40-19" name="__codelineno-40-19"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">1</span>
<a href="#__codelineno-40-20" id="__codelineno-40-20" name="__codelineno-40-20"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-40-21" id="__codelineno-40-21" name="__codelineno-40-21"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-40-22" id="__codelineno-40-22" name="__codelineno-40-22"></a>
<a href="#__codelineno-40-23" id="__codelineno-40-23" name="__codelineno-40-23"></a>Activating<span class="w"> </span>environment<span class="w"> </span>modules:<span class="w"> </span>FastQC/0.11.9
<a href="#__codelineno-40-24" id="__codelineno-40-24" name="__codelineno-40-24"></a>
<a href="#__codelineno-40-25" id="__codelineno-40-25" name="__codelineno-40-25"></a>The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<a href="#__codelineno-40-26" id="__codelineno-40-26" name="__codelineno-40-26"></a><span class="w">   </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">"module --force purge"</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:
<a href="#__codelineno-40-27" id="__codelineno-40-27" name="__codelineno-40-27"></a>
<a href="#__codelineno-40-28" id="__codelineno-40-28" name="__codelineno-40-28"></a><span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>XALT/minimal<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>slurm<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>NeSI
<a href="#__codelineno-40-29" id="__codelineno-40-29" name="__codelineno-40-29"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:15:20<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-40-30" id="__codelineno-40-30" name="__codelineno-40-30"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">1</span>.
<a href="#__codelineno-40-31" id="__codelineno-40-31" name="__codelineno-40-31"></a><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">2</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">50</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-40-32" id="__codelineno-40-32" name="__codelineno-40-32"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-40-33" id="__codelineno-40-33" name="__codelineno-40-33"></a>
<a href="#__codelineno-40-34" id="__codelineno-40-34" name="__codelineno-40-34"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:15:20<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-40-35" id="__codelineno-40-35" name="__codelineno-40-35"></a>localrule<span class="w"> </span>all:
<a href="#__codelineno-40-36" id="__codelineno-40-36" name="__codelineno-40-36"></a><span class="w">    </span>input:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-40-37" id="__codelineno-40-37" name="__codelineno-40-37"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-40-38" id="__codelineno-40-38" name="__codelineno-40-38"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-40-39" id="__codelineno-40-39" name="__codelineno-40-39"></a>
<a href="#__codelineno-40-40" id="__codelineno-40-40" name="__codelineno-40-40"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:15:20<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-40-41" id="__codelineno-40-41" name="__codelineno-40-41"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">0</span>.
<a href="#__codelineno-40-42" id="__codelineno-40-42" name="__codelineno-40-42"></a><span class="m">2</span><span class="w"> </span>of<span class="w"> </span><span class="m">2</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">100</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-40-43" id="__codelineno-40-43" name="__codelineno-40-43"></a>Complete<span class="w"> </span>log:<span class="w"> </span>.snakemake/log/2022-05-11T121516.368334.snakemake.log
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot18" content=e3dot18%}
<br/></p>
<p>We now have a log file, lets have a look at the first 10 lines of our log with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a>head<span class="w"> </span>./logs/fastqc/NA24631.log
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot19 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a>Started<span class="w"> </span>analysis<span class="w"> </span>of<span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a>Approx<span class="w"> </span><span class="m">5</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a>Approx<span class="w"> </span><span class="m">10</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a>Approx<span class="w"> </span><span class="m">15</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a>Approx<span class="w"> </span><span class="m">20</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-42-6" id="__codelineno-42-6" name="__codelineno-42-6"></a>Approx<span class="w"> </span><span class="m">25</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-42-7" id="__codelineno-42-7" name="__codelineno-42-7"></a>Approx<span class="w"> </span><span class="m">30</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-42-8" id="__codelineno-42-8" name="__codelineno-42-8"></a>Approx<span class="w"> </span><span class="m">35</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-42-9" id="__codelineno-42-9" name="__codelineno-42-9"></a>Approx<span class="w"> </span><span class="m">40</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
<a href="#__codelineno-42-10" id="__codelineno-42-10" name="__codelineno-42-10"></a>Approx<span class="w"> </span><span class="m">45</span>%<span class="w"> </span><span class="nb">complete</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>NA24631_1.fastq.gz
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot19" content=e3dot19%}
<br/></p>
<p align="center"><b>We have logs. Tidy logs.</b><br/></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="https://miro.medium.com/max/2560/1*ohWUB5snJRaMe-vJ8HaoiA.png"><img alt="logs" src="https://miro.medium.com/max/2560/1*ohWUB5snJRaMe-vJ8HaoiA.png"/></a></p>
<blockquote>
<p><strong>Exercise:</strong></p>
<p>Try creating an error in the shell command (for example remove the <code>-o</code> flag) and use the three different syntaxes for writing to your log file. What is and isn't printed to your screen and to your log file?</p>
</blockquote>
<h2 id="311-scale-up-to-analyse-all-of-our-samples">3.11 Scale up to analyse all of our samples<a class="headerlink" href="#311-scale-up-to-analyse-all-of-our-samples" title="Permanent link">¶</a></h2>
<p>We are currently only analysing one of our three samples</p>
<p>Let's scale up to run all of our samples by using <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#wildcards">wildcards</a>, this way we can grab all the samples/files in the <code>data</code> directory and analyse them</p>
<ul>
<li>Set a global wildcard that defines the samples to be analysed</li>
<li>Generalise where this rule uses an individual sample (<code>NA24631</code>) to use this wildcard <code>{sample}</code></li>
<li>Use the <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#the-expand-function">expand function</a> (<code>expand()</code>) function to tell snakemake that <code>{sample}</code> is what we defined in our global wildcard <code>SAMPLES,</code></li>
<li>Snakemake can figure out what <code>{sample}</code> is in our rule since it's defined in the targets in <code>rule all:</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-43-2" id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="gi">+ SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")</span>
<a href="#__codelineno-43-3" id="__codelineno-43-3" name="__codelineno-43-3"></a>
<a href="#__codelineno-43-4" id="__codelineno-43-4" name="__codelineno-43-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-43-5" id="__codelineno-43-5" name="__codelineno-43-5"></a>rule all:
<a href="#__codelineno-43-6" id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="w"> </span>   input:
<a href="#__codelineno-43-7" id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="gd">-       "../results/fastqc/NA24631_1_fastqc.html",</span>
<a href="#__codelineno-43-8" id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="gd">-       "../results/fastqc/NA24631_2_fastqc.html",</span>
<a href="#__codelineno-43-9" id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="gd">-       "../results/fastqc/NA24631_1_fastqc.zip",</span>
<a href="#__codelineno-43-10" id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="gd">-       "../results/fastqc/NA24631_2_fastqc.zip"</span>
<a href="#__codelineno-43-11" id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="gi">+       expand("../results/fastqc/{sample}_1_fastqc.html", sample = SAMPLES),</span>
<a href="#__codelineno-43-12" id="__codelineno-43-12" name="__codelineno-43-12"></a><span class="gi">+       expand("../results/fastqc/{sample}_2_fastqc.html", sample = SAMPLES),</span>
<a href="#__codelineno-43-13" id="__codelineno-43-13" name="__codelineno-43-13"></a><span class="gi">+       expand("../results/fastqc/{sample}_1_fastqc.zip", sample = SAMPLES),</span>
<a href="#__codelineno-43-14" id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="gi">+       expand("../results/fastqc/{sample}_2_fastqc.zip", sample = SAMPLES)</span>
<a href="#__codelineno-43-15" id="__codelineno-43-15" name="__codelineno-43-15"></a>
<a href="#__codelineno-43-16" id="__codelineno-43-16" name="__codelineno-43-16"></a># workflow
<a href="#__codelineno-43-17" id="__codelineno-43-17" name="__codelineno-43-17"></a>rule fastqc:
<a href="#__codelineno-43-18" id="__codelineno-43-18" name="__codelineno-43-18"></a><span class="w"> </span>   input:
<a href="#__codelineno-43-19" id="__codelineno-43-19" name="__codelineno-43-19"></a><span class="gd">-       R1 = "../../data/NA24631_1.fastq.gz",</span>
<a href="#__codelineno-43-20" id="__codelineno-43-20" name="__codelineno-43-20"></a><span class="gd">-       R2 = "../../data/NA24631_2.fastq.gz"</span>
<a href="#__codelineno-43-21" id="__codelineno-43-21" name="__codelineno-43-21"></a><span class="gi">+       R1 = "../../data/{sample}_1.fastq.gz",</span>
<a href="#__codelineno-43-22" id="__codelineno-43-22" name="__codelineno-43-22"></a><span class="gi">+       R2 = "../../data/{sample}_2.fastq.gz"</span>
<a href="#__codelineno-43-23" id="__codelineno-43-23" name="__codelineno-43-23"></a><span class="w"> </span>   output:
<a href="#__codelineno-43-24" id="__codelineno-43-24" name="__codelineno-43-24"></a><span class="gd">-       html = ["../results/fastqc/NA24631_1_fastqc.html", "../results/fastqc/NA24631_2_fastqc.html"],</span>
<a href="#__codelineno-43-25" id="__codelineno-43-25" name="__codelineno-43-25"></a><span class="gd">-       zip = ["../results/fastqc/NA24631_1_fastqc.zip", "../results/fastqc/NA24631_2_fastqc.zip"]</span>
<a href="#__codelineno-43-26" id="__codelineno-43-26" name="__codelineno-43-26"></a><span class="gi">+       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],</span>
<a href="#__codelineno-43-27" id="__codelineno-43-27" name="__codelineno-43-27"></a><span class="gi">+       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]</span>
<a href="#__codelineno-43-28" id="__codelineno-43-28" name="__codelineno-43-28"></a><span class="w"> </span>   log:
<a href="#__codelineno-43-29" id="__codelineno-43-29" name="__codelineno-43-29"></a><span class="gd">-       "logs/fastqc/NA24631.log"</span>
<a href="#__codelineno-43-30" id="__codelineno-43-30" name="__codelineno-43-30"></a><span class="gi">+       "logs/fastqc/{sample}.log"</span>
<a href="#__codelineno-43-31" id="__codelineno-43-31" name="__codelineno-43-31"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-43-32" id="__codelineno-43-32" name="__codelineno-43-32"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-43-33" id="__codelineno-43-33" name="__codelineno-43-33"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-43-34" id="__codelineno-43-34" name="__codelineno-43-34"></a><span class="w"> </span>   shell:
<a href="#__codelineno-43-35" id="__codelineno-43-35" name="__codelineno-43-35"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e3dot20 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a>
<a href="#__codelineno-44-4" id="__codelineno-44-4" name="__codelineno-44-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-44-5" id="__codelineno-44-5" name="__codelineno-44-5"></a>rule all:
<a href="#__codelineno-44-6" id="__codelineno-44-6" name="__codelineno-44-6"></a>    input:
<a href="#__codelineno-44-7" id="__codelineno-44-7" name="__codelineno-44-7"></a>        expand("../results/fastqc/{sample}_1_fastqc.html", sample = SAMPLES),
<a href="#__codelineno-44-8" id="__codelineno-44-8" name="__codelineno-44-8"></a>        expand("../results/fastqc/{sample}_2_fastqc.html", sample = SAMPLES),
<a href="#__codelineno-44-9" id="__codelineno-44-9" name="__codelineno-44-9"></a>        expand("../results/fastqc/{sample}_1_fastqc.zip", sample = SAMPLES),
<a href="#__codelineno-44-10" id="__codelineno-44-10" name="__codelineno-44-10"></a>        expand("../results/fastqc/{sample}_2_fastqc.zip", sample = SAMPLES)
<a href="#__codelineno-44-11" id="__codelineno-44-11" name="__codelineno-44-11"></a>
<a href="#__codelineno-44-12" id="__codelineno-44-12" name="__codelineno-44-12"></a># workflow
<a href="#__codelineno-44-13" id="__codelineno-44-13" name="__codelineno-44-13"></a>rule fastqc:
<a href="#__codelineno-44-14" id="__codelineno-44-14" name="__codelineno-44-14"></a>    input:
<a href="#__codelineno-44-15" id="__codelineno-44-15" name="__codelineno-44-15"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-44-16" id="__codelineno-44-16" name="__codelineno-44-16"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-44-17" id="__codelineno-44-17" name="__codelineno-44-17"></a>    output:
<a href="#__codelineno-44-18" id="__codelineno-44-18" name="__codelineno-44-18"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-44-19" id="__codelineno-44-19" name="__codelineno-44-19"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-44-20" id="__codelineno-44-20" name="__codelineno-44-20"></a>    log:
<a href="#__codelineno-44-21" id="__codelineno-44-21" name="__codelineno-44-21"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-44-22" id="__codelineno-44-22" name="__codelineno-44-22"></a>    threads: 2
<a href="#__codelineno-44-23" id="__codelineno-44-23" name="__codelineno-44-23"></a>    envmodules:
<a href="#__codelineno-44-24" id="__codelineno-44-24" name="__codelineno-44-24"></a>        "FastQC/0.11.9"
<a href="#__codelineno-44-25" id="__codelineno-44-25" name="__codelineno-44-25"></a>    shell:
<a href="#__codelineno-44-26" id="__codelineno-44-26" name="__codelineno-44-26"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot20" content=e3dot20%}
<br/></p>
<p>Visualise workflow</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a>snakemake<span class="w"> </span>--dag<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>dag_3.png
</code></pre></div>
<p>Now we have three samples running though our workflow, one of which has already been run in our last run (NA24631) indicated by the dashed lines</p>
<p>My DAG:</p>
<p>{% capture e3dot21 %}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/dag_3.png"><img alt="DAG_3" src="../images/dag_3.png"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot21" content=e3dot21%}
<br/></p>
<p>Run workflow again</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-46-3" id="__codelineno-46-3" name="__codelineno-46-3"></a>
<a href="#__codelineno-46-4" id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="c1"># run dryrun again</span>
<a href="#__codelineno-46-5" id="__codelineno-46-5" name="__codelineno-46-5"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>See how it now runs over all three of our samples in the output of the dryrun</p>
<p>My output:</p>
<p>{% capture e3dot22 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-47-4" id="__codelineno-47-4" name="__codelineno-47-4"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-47-5" id="__codelineno-47-5" name="__codelineno-47-5"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-47-6" id="__codelineno-47-6" name="__codelineno-47-6"></a>fastqc<span class="w">        </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-47-7" id="__codelineno-47-7" name="__codelineno-47-7"></a>total<span class="w">         </span><span class="m">4</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-47-8" id="__codelineno-47-8" name="__codelineno-47-8"></a>
<a href="#__codelineno-47-9" id="__codelineno-47-9" name="__codelineno-47-9"></a>
<a href="#__codelineno-47-10" id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:16:46<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-47-11" id="__codelineno-47-11" name="__codelineno-47-11"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-47-12" id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24695_1.fastq.gz,<span class="w"> </span>../../data/NA24695_2.fastq.gz
<a href="#__codelineno-47-13" id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24695_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24695_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24695_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24695_2_fastqc.zip
<a href="#__codelineno-47-14" id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="w">    </span>log:<span class="w"> </span>logs/fastqc/NA24695.log
<a href="#__codelineno-47-15" id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-47-16" id="__codelineno-47-16" name="__codelineno-47-16"></a><span class="w">    </span>wildcards:<span class="w"> </span><span class="nv">sample</span><span class="o">=</span>NA24695
<a href="#__codelineno-47-17" id="__codelineno-47-17" name="__codelineno-47-17"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-47-18" id="__codelineno-47-18" name="__codelineno-47-18"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-47-19" id="__codelineno-47-19" name="__codelineno-47-19"></a>
<a href="#__codelineno-47-20" id="__codelineno-47-20" name="__codelineno-47-20"></a>
<a href="#__codelineno-47-21" id="__codelineno-47-21" name="__codelineno-47-21"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:16:46<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-47-22" id="__codelineno-47-22" name="__codelineno-47-22"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-47-23" id="__codelineno-47-23" name="__codelineno-47-23"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24631_1.fastq.gz,<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a href="#__codelineno-47-24" id="__codelineno-47-24" name="__codelineno-47-24"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-47-25" id="__codelineno-47-25" name="__codelineno-47-25"></a><span class="w">    </span>log:<span class="w"> </span>logs/fastqc/NA24631.log
<a href="#__codelineno-47-26" id="__codelineno-47-26" name="__codelineno-47-26"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">1</span>
<a href="#__codelineno-47-27" id="__codelineno-47-27" name="__codelineno-47-27"></a><span class="w">    </span>wildcards:<span class="w"> </span><span class="nv">sample</span><span class="o">=</span>NA24631
<a href="#__codelineno-47-28" id="__codelineno-47-28" name="__codelineno-47-28"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-47-29" id="__codelineno-47-29" name="__codelineno-47-29"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-47-30" id="__codelineno-47-30" name="__codelineno-47-30"></a>
<a href="#__codelineno-47-31" id="__codelineno-47-31" name="__codelineno-47-31"></a>
<a href="#__codelineno-47-32" id="__codelineno-47-32" name="__codelineno-47-32"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:16:46<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-47-33" id="__codelineno-47-33" name="__codelineno-47-33"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-47-34" id="__codelineno-47-34" name="__codelineno-47-34"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24694_1.fastq.gz,<span class="w"> </span>../../data/NA24694_2.fastq.gz
<a href="#__codelineno-47-35" id="__codelineno-47-35" name="__codelineno-47-35"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24694_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24694_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24694_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24694_2_fastqc.zip
<a href="#__codelineno-47-36" id="__codelineno-47-36" name="__codelineno-47-36"></a><span class="w">    </span>log:<span class="w"> </span>logs/fastqc/NA24694.log
<a href="#__codelineno-47-37" id="__codelineno-47-37" name="__codelineno-47-37"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">3</span>
<a href="#__codelineno-47-38" id="__codelineno-47-38" name="__codelineno-47-38"></a><span class="w">    </span>wildcards:<span class="w"> </span><span class="nv">sample</span><span class="o">=</span>NA24694
<a href="#__codelineno-47-39" id="__codelineno-47-39" name="__codelineno-47-39"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-47-40" id="__codelineno-47-40" name="__codelineno-47-40"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-47-41" id="__codelineno-47-41" name="__codelineno-47-41"></a>
<a href="#__codelineno-47-42" id="__codelineno-47-42" name="__codelineno-47-42"></a>
<a href="#__codelineno-47-43" id="__codelineno-47-43" name="__codelineno-47-43"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:16:46<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-47-44" id="__codelineno-47-44" name="__codelineno-47-44"></a>localrule<span class="w"> </span>all:
<a href="#__codelineno-47-45" id="__codelineno-47-45" name="__codelineno-47-45"></a><span class="w">    </span>input:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24695_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24694_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24695_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24694_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24695_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24694_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24695_2_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24694_2_fastqc.zip
<a href="#__codelineno-47-46" id="__codelineno-47-46" name="__codelineno-47-46"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-47-47" id="__codelineno-47-47" name="__codelineno-47-47"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-47-48" id="__codelineno-47-48" name="__codelineno-47-48"></a>
<a href="#__codelineno-47-49" id="__codelineno-47-49" name="__codelineno-47-49"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-47-50" id="__codelineno-47-50" name="__codelineno-47-50"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-47-51" id="__codelineno-47-51" name="__codelineno-47-51"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-47-52" id="__codelineno-47-52" name="__codelineno-47-52"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-47-53" id="__codelineno-47-53" name="__codelineno-47-53"></a>fastqc<span class="w">        </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-47-54" id="__codelineno-47-54" name="__codelineno-47-54"></a>total<span class="w">         </span><span class="m">4</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-47-55" id="__codelineno-47-55" name="__codelineno-47-55"></a>
<a href="#__codelineno-47-56" id="__codelineno-47-56" name="__codelineno-47-56"></a>This<span class="w"> </span>was<span class="w"> </span>a<span class="w"> </span>dry-run<span class="w"> </span><span class="o">(</span>flag<span class="w"> </span>-n<span class="o">)</span>.<span class="w"> </span>The<span class="w"> </span>order<span class="w"> </span>of<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>does<span class="w"> </span>not<span class="w"> </span>reflect<span class="w"> </span>the<span class="w"> </span>order<span class="w"> </span>of<span class="w"> </span>execution.
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot22" content=e3dot22%}
<br/></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="c1"># full run again</span>
<a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>All three samples were run through our workflow! And we have a log file for each sample for the fastqc rule</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a>ls<span class="w"> </span>-lh<span class="w"> </span>./logs/fastqc
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot23 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a>total<span class="w"> </span><span class="m">1</span>.5K
<a href="#__codelineno-50-2" id="__codelineno-50-2" name="__codelineno-50-2"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">1</span>.8K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:17<span class="w"> </span>NA24631.log
<a href="#__codelineno-50-3" id="__codelineno-50-3" name="__codelineno-50-3"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">1</span>.8K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:17<span class="w"> </span>NA24694.log
<a href="#__codelineno-50-4" id="__codelineno-50-4" name="__codelineno-50-4"></a>-rw-rw----+<span class="w"> </span><span class="m">1</span><span class="w"> </span>lkemp<span class="w"> </span>nesi99991<span class="w"> </span><span class="m">1</span>.8K<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:17<span class="w"> </span>NA24695.log
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot23" content=e3dot23%}
<br/></p>
<h2 id="312-add-more-rules">3.12 Add more rules<a class="headerlink" href="#312-add-more-rules" title="Permanent link">¶</a></h2>
<ul>
<li>Connect the outputs of fastqc to the inputs of multiqc</li>
<li>Add a new final target for <code>rule all:</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-51-2" id="__codelineno-51-2" name="__codelineno-51-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-51-3" id="__codelineno-51-3" name="__codelineno-51-3"></a>
<a href="#__codelineno-51-4" id="__codelineno-51-4" name="__codelineno-51-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-51-5" id="__codelineno-51-5" name="__codelineno-51-5"></a>rule all:
<a href="#__codelineno-51-6" id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="w"> </span>   input:
<a href="#__codelineno-51-7" id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="w"> </span>       expand("../results/fastqc/{sample}_1_fastqc.html", sample = SAMPLES),
<a href="#__codelineno-51-8" id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="w"> </span>       expand("../results/fastqc/{sample}_2_fastqc.html", sample = SAMPLES),
<a href="#__codelineno-51-9" id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="w"> </span>       expand("../results/fastqc/{sample}_1_fastqc.zip", sample = SAMPLES),
<a href="#__codelineno-51-10" id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="gd">-       expand("../results/fastqc/{sample}_2_fastqc.zip", sample = SAMPLES)</span>
<a href="#__codelineno-51-11" id="__codelineno-51-11" name="__codelineno-51-11"></a><span class="gi">+       expand("../results/fastqc/{sample}_2_fastqc.zip", sample = SAMPLES),</span>
<a href="#__codelineno-51-12" id="__codelineno-51-12" name="__codelineno-51-12"></a><span class="gi">+       "../results/multiqc_report.html"</span>
<a href="#__codelineno-51-13" id="__codelineno-51-13" name="__codelineno-51-13"></a>
<a href="#__codelineno-51-14" id="__codelineno-51-14" name="__codelineno-51-14"></a># workflow
<a href="#__codelineno-51-15" id="__codelineno-51-15" name="__codelineno-51-15"></a>rule fastqc:
<a href="#__codelineno-51-16" id="__codelineno-51-16" name="__codelineno-51-16"></a><span class="w"> </span>   input:
<a href="#__codelineno-51-17" id="__codelineno-51-17" name="__codelineno-51-17"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-51-18" id="__codelineno-51-18" name="__codelineno-51-18"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-51-19" id="__codelineno-51-19" name="__codelineno-51-19"></a><span class="w"> </span>   output:
<a href="#__codelineno-51-20" id="__codelineno-51-20" name="__codelineno-51-20"></a><span class="w"> </span>       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-51-21" id="__codelineno-51-21" name="__codelineno-51-21"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-51-22" id="__codelineno-51-22" name="__codelineno-51-22"></a><span class="w"> </span>   log:
<a href="#__codelineno-51-23" id="__codelineno-51-23" name="__codelineno-51-23"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-51-24" id="__codelineno-51-24" name="__codelineno-51-24"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-51-25" id="__codelineno-51-25" name="__codelineno-51-25"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-51-26" id="__codelineno-51-26" name="__codelineno-51-26"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-51-27" id="__codelineno-51-27" name="__codelineno-51-27"></a><span class="w"> </span>   shell:
<a href="#__codelineno-51-28" id="__codelineno-51-28" name="__codelineno-51-28"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-51-29" id="__codelineno-51-29" name="__codelineno-51-29"></a>
<a href="#__codelineno-51-30" id="__codelineno-51-30" name="__codelineno-51-30"></a><span class="gi">+ rule multiqc:</span>
<a href="#__codelineno-51-31" id="__codelineno-51-31" name="__codelineno-51-31"></a><span class="gi">+   input:</span>
<a href="#__codelineno-51-32" id="__codelineno-51-32" name="__codelineno-51-32"></a><span class="gi">+       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)</span>
<a href="#__codelineno-51-33" id="__codelineno-51-33" name="__codelineno-51-33"></a><span class="gi">+   output:</span>
<a href="#__codelineno-51-34" id="__codelineno-51-34" name="__codelineno-51-34"></a><span class="gi">+       "../results/multiqc_report.html"</span>
<a href="#__codelineno-51-35" id="__codelineno-51-35" name="__codelineno-51-35"></a><span class="gi">+   log:</span>
<a href="#__codelineno-51-36" id="__codelineno-51-36" name="__codelineno-51-36"></a><span class="gi">+       "logs/multiqc/multiqc.log"</span>
<a href="#__codelineno-51-37" id="__codelineno-51-37" name="__codelineno-51-37"></a><span class="gi">+   envmodules:</span>
<a href="#__codelineno-51-38" id="__codelineno-51-38" name="__codelineno-51-38"></a><span class="gi">+       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"</span>
<a href="#__codelineno-51-39" id="__codelineno-51-39" name="__codelineno-51-39"></a><span class="gi">+   shell:</span>
<a href="#__codelineno-51-40" id="__codelineno-51-40" name="__codelineno-51-40"></a><span class="gi">+       "multiqc {input} -o ../results/ &amp;&gt; {log}"</span>
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e3dot24 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-52-1" id="__codelineno-52-1" name="__codelineno-52-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-52-2" id="__codelineno-52-2" name="__codelineno-52-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-52-3" id="__codelineno-52-3" name="__codelineno-52-3"></a>
<a href="#__codelineno-52-4" id="__codelineno-52-4" name="__codelineno-52-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-52-5" id="__codelineno-52-5" name="__codelineno-52-5"></a>rule all:
<a href="#__codelineno-52-6" id="__codelineno-52-6" name="__codelineno-52-6"></a>    input:
<a href="#__codelineno-52-7" id="__codelineno-52-7" name="__codelineno-52-7"></a>        expand("../results/fastqc/{sample}_1_fastqc.html", sample = SAMPLES),
<a href="#__codelineno-52-8" id="__codelineno-52-8" name="__codelineno-52-8"></a>        expand("../results/fastqc/{sample}_2_fastqc.html", sample = SAMPLES),
<a href="#__codelineno-52-9" id="__codelineno-52-9" name="__codelineno-52-9"></a>        expand("../results/fastqc/{sample}_1_fastqc.zip", sample = SAMPLES),
<a href="#__codelineno-52-10" id="__codelineno-52-10" name="__codelineno-52-10"></a>        expand("../results/fastqc/{sample}_2_fastqc.zip", sample = SAMPLES),
<a href="#__codelineno-52-11" id="__codelineno-52-11" name="__codelineno-52-11"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-52-12" id="__codelineno-52-12" name="__codelineno-52-12"></a>
<a href="#__codelineno-52-13" id="__codelineno-52-13" name="__codelineno-52-13"></a># workflow
<a href="#__codelineno-52-14" id="__codelineno-52-14" name="__codelineno-52-14"></a>rule fastqc:
<a href="#__codelineno-52-15" id="__codelineno-52-15" name="__codelineno-52-15"></a>    input:
<a href="#__codelineno-52-16" id="__codelineno-52-16" name="__codelineno-52-16"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-52-17" id="__codelineno-52-17" name="__codelineno-52-17"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-52-18" id="__codelineno-52-18" name="__codelineno-52-18"></a>    output:
<a href="#__codelineno-52-19" id="__codelineno-52-19" name="__codelineno-52-19"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-52-20" id="__codelineno-52-20" name="__codelineno-52-20"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-52-21" id="__codelineno-52-21" name="__codelineno-52-21"></a>    log:
<a href="#__codelineno-52-22" id="__codelineno-52-22" name="__codelineno-52-22"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-52-23" id="__codelineno-52-23" name="__codelineno-52-23"></a>    threads: 2
<a href="#__codelineno-52-24" id="__codelineno-52-24" name="__codelineno-52-24"></a>    envmodules:
<a href="#__codelineno-52-25" id="__codelineno-52-25" name="__codelineno-52-25"></a>        "FastQC/0.11.9"
<a href="#__codelineno-52-26" id="__codelineno-52-26" name="__codelineno-52-26"></a>    shell:
<a href="#__codelineno-52-27" id="__codelineno-52-27" name="__codelineno-52-27"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-52-28" id="__codelineno-52-28" name="__codelineno-52-28"></a>
<a href="#__codelineno-52-29" id="__codelineno-52-29" name="__codelineno-52-29"></a>rule multiqc:
<a href="#__codelineno-52-30" id="__codelineno-52-30" name="__codelineno-52-30"></a>    input:
<a href="#__codelineno-52-31" id="__codelineno-52-31" name="__codelineno-52-31"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-52-32" id="__codelineno-52-32" name="__codelineno-52-32"></a>    output:
<a href="#__codelineno-52-33" id="__codelineno-52-33" name="__codelineno-52-33"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-52-34" id="__codelineno-52-34" name="__codelineno-52-34"></a>    log:
<a href="#__codelineno-52-35" id="__codelineno-52-35" name="__codelineno-52-35"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-52-36" id="__codelineno-52-36" name="__codelineno-52-36"></a>    envmodules:
<a href="#__codelineno-52-37" id="__codelineno-52-37" name="__codelineno-52-37"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-52-38" id="__codelineno-52-38" name="__codelineno-52-38"></a>    shell:
<a href="#__codelineno-52-39" id="__codelineno-52-39" name="__codelineno-52-39"></a>        "multiqc {input} -o ../results/ &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot24" content=e3dot24%}
<br/></p>
<p>Run workflow again</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-53-1" id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-53-2" id="__codelineno-53-2" name="__codelineno-53-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-53-3" id="__codelineno-53-3" name="__codelineno-53-3"></a>
<a href="#__codelineno-53-4" id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="c1"># run dryrun/run again</span>
<a href="#__codelineno-53-5" id="__codelineno-53-5" name="__codelineno-53-5"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
<a href="#__codelineno-53-6" id="__codelineno-53-6" name="__codelineno-53-6"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>Visualise workflow</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-54-1" id="__codelineno-54-1" name="__codelineno-54-1"></a>snakemake<span class="w"> </span>--dag<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>dag_4.png
</code></pre></div>
<p>Now we have two rules in our workflow (fastqc and multiqc), we can also see that multiqc isn't run for each sample (since it merges the output of fastqc for all samples)</p>
<p>My DAG:</p>
<p>{% capture e3dot25 %}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/dag_4.png"><img alt="DAG_4" src="../images/dag_4.png"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot25" content=e3dot25%}
<br/></p>
<h2 id="313-more-about-snakemakes-lazy-behaviour">3.13 More about Snakemake's lazy behaviour<a class="headerlink" href="#313-more-about-snakemakes-lazy-behaviour" title="Permanent link">¶</a></h2>
<p>What happens if we only have the final target file (<code>../results/multiqc_report.html</code>) in <code>rule all:</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-55-1" id="__codelineno-55-1" name="__codelineno-55-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-55-2" id="__codelineno-55-2" name="__codelineno-55-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-55-3" id="__codelineno-55-3" name="__codelineno-55-3"></a>
<a href="#__codelineno-55-4" id="__codelineno-55-4" name="__codelineno-55-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-55-5" id="__codelineno-55-5" name="__codelineno-55-5"></a>rule all:
<a href="#__codelineno-55-6" id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="w"> </span>   input:
<a href="#__codelineno-55-7" id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="gd">-       expand("../results/fastqc/{sample}_1_fastqc.html", sample = SAMPLES),</span>
<a href="#__codelineno-55-8" id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="gd">-       expand("../results/fastqc/{sample}_2_fastqc.html", sample = SAMPLES),</span>
<a href="#__codelineno-55-9" id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="gd">-       expand("../results/fastqc/{sample}_1_fastqc.zip", sample = SAMPLES),</span>
<a href="#__codelineno-55-10" id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="gd">-       expand("../results/fastqc/{sample}_2_fastqc.zip", sample = SAMPLES),</span>
<a href="#__codelineno-55-11" id="__codelineno-55-11" name="__codelineno-55-11"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-55-12" id="__codelineno-55-12" name="__codelineno-55-12"></a>
<a href="#__codelineno-55-13" id="__codelineno-55-13" name="__codelineno-55-13"></a># workflow
<a href="#__codelineno-55-14" id="__codelineno-55-14" name="__codelineno-55-14"></a>rule fastqc:
<a href="#__codelineno-55-15" id="__codelineno-55-15" name="__codelineno-55-15"></a><span class="w"> </span>   input:
<a href="#__codelineno-55-16" id="__codelineno-55-16" name="__codelineno-55-16"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-55-17" id="__codelineno-55-17" name="__codelineno-55-17"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-55-18" id="__codelineno-55-18" name="__codelineno-55-18"></a><span class="w"> </span>   output:
<a href="#__codelineno-55-19" id="__codelineno-55-19" name="__codelineno-55-19"></a><span class="w"> </span>       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-55-20" id="__codelineno-55-20" name="__codelineno-55-20"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-55-21" id="__codelineno-55-21" name="__codelineno-55-21"></a><span class="w"> </span>   log:
<a href="#__codelineno-55-22" id="__codelineno-55-22" name="__codelineno-55-22"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-55-23" id="__codelineno-55-23" name="__codelineno-55-23"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-55-24" id="__codelineno-55-24" name="__codelineno-55-24"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-55-25" id="__codelineno-55-25" name="__codelineno-55-25"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-55-26" id="__codelineno-55-26" name="__codelineno-55-26"></a><span class="w"> </span>   shell:
<a href="#__codelineno-55-27" id="__codelineno-55-27" name="__codelineno-55-27"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-55-28" id="__codelineno-55-28" name="__codelineno-55-28"></a>
<a href="#__codelineno-55-29" id="__codelineno-55-29" name="__codelineno-55-29"></a>rule multiqc:
<a href="#__codelineno-55-30" id="__codelineno-55-30" name="__codelineno-55-30"></a><span class="w"> </span>   input:
<a href="#__codelineno-55-31" id="__codelineno-55-31" name="__codelineno-55-31"></a><span class="w"> </span>       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-55-32" id="__codelineno-55-32" name="__codelineno-55-32"></a><span class="w"> </span>   output:
<a href="#__codelineno-55-33" id="__codelineno-55-33" name="__codelineno-55-33"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-55-34" id="__codelineno-55-34" name="__codelineno-55-34"></a><span class="w"> </span>   log:
<a href="#__codelineno-55-35" id="__codelineno-55-35" name="__codelineno-55-35"></a><span class="w"> </span>       "logs/multiqc/multiqc.log"
<a href="#__codelineno-55-36" id="__codelineno-55-36" name="__codelineno-55-36"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-55-37" id="__codelineno-55-37" name="__codelineno-55-37"></a><span class="w"> </span>       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-55-38" id="__codelineno-55-38" name="__codelineno-55-38"></a><span class="w"> </span>   shell:
<a href="#__codelineno-55-39" id="__codelineno-55-39" name="__codelineno-55-39"></a><span class="w"> </span>       "multiqc {input} -o ../results/ &amp;&gt; {log}"
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e3dot26 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-56-1" id="__codelineno-56-1" name="__codelineno-56-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-56-2" id="__codelineno-56-2" name="__codelineno-56-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-56-3" id="__codelineno-56-3" name="__codelineno-56-3"></a>
<a href="#__codelineno-56-4" id="__codelineno-56-4" name="__codelineno-56-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-56-5" id="__codelineno-56-5" name="__codelineno-56-5"></a>rule all:
<a href="#__codelineno-56-6" id="__codelineno-56-6" name="__codelineno-56-6"></a>    input:
<a href="#__codelineno-56-7" id="__codelineno-56-7" name="__codelineno-56-7"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-56-8" id="__codelineno-56-8" name="__codelineno-56-8"></a>
<a href="#__codelineno-56-9" id="__codelineno-56-9" name="__codelineno-56-9"></a># workflow
<a href="#__codelineno-56-10" id="__codelineno-56-10" name="__codelineno-56-10"></a>rule fastqc:
<a href="#__codelineno-56-11" id="__codelineno-56-11" name="__codelineno-56-11"></a>    input:
<a href="#__codelineno-56-12" id="__codelineno-56-12" name="__codelineno-56-12"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-56-13" id="__codelineno-56-13" name="__codelineno-56-13"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-56-14" id="__codelineno-56-14" name="__codelineno-56-14"></a>    output:
<a href="#__codelineno-56-15" id="__codelineno-56-15" name="__codelineno-56-15"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-56-16" id="__codelineno-56-16" name="__codelineno-56-16"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-56-17" id="__codelineno-56-17" name="__codelineno-56-17"></a>    log:
<a href="#__codelineno-56-18" id="__codelineno-56-18" name="__codelineno-56-18"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-56-19" id="__codelineno-56-19" name="__codelineno-56-19"></a>    threads: 2
<a href="#__codelineno-56-20" id="__codelineno-56-20" name="__codelineno-56-20"></a>    envmodules:
<a href="#__codelineno-56-21" id="__codelineno-56-21" name="__codelineno-56-21"></a>        "FastQC/0.11.9"
<a href="#__codelineno-56-22" id="__codelineno-56-22" name="__codelineno-56-22"></a>    shell:
<a href="#__codelineno-56-23" id="__codelineno-56-23" name="__codelineno-56-23"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-56-24" id="__codelineno-56-24" name="__codelineno-56-24"></a>
<a href="#__codelineno-56-25" id="__codelineno-56-25" name="__codelineno-56-25"></a>rule multiqc:
<a href="#__codelineno-56-26" id="__codelineno-56-26" name="__codelineno-56-26"></a>    input:
<a href="#__codelineno-56-27" id="__codelineno-56-27" name="__codelineno-56-27"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-56-28" id="__codelineno-56-28" name="__codelineno-56-28"></a>    output:
<a href="#__codelineno-56-29" id="__codelineno-56-29" name="__codelineno-56-29"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-56-30" id="__codelineno-56-30" name="__codelineno-56-30"></a>    log:
<a href="#__codelineno-56-31" id="__codelineno-56-31" name="__codelineno-56-31"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-56-32" id="__codelineno-56-32" name="__codelineno-56-32"></a>    envmodules:
<a href="#__codelineno-56-33" id="__codelineno-56-33" name="__codelineno-56-33"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-56-34" id="__codelineno-56-34" name="__codelineno-56-34"></a>    shell:
<a href="#__codelineno-56-35" id="__codelineno-56-35" name="__codelineno-56-35"></a>        "multiqc {input} -o ../results/ &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot26" content=e3dot26%}
<br/></p>
<p>Run workflow again</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-57-1" id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-57-2" id="__codelineno-57-2" name="__codelineno-57-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-57-3" id="__codelineno-57-3" name="__codelineno-57-3"></a>
<a href="#__codelineno-57-4" id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="c1"># run dryrun again</span>
<a href="#__codelineno-57-5" id="__codelineno-57-5" name="__codelineno-57-5"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>It still works because it is the last file in the workflow sequence, Snakemake will do all the steps necessary to get to this target file (therefore it runs both fastqc and multiqc)</p>
<p>Visualise workflow</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-58-1" id="__codelineno-58-1" name="__codelineno-58-1"></a>snakemake<span class="w"> </span>--dag<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>dag_5.png
</code></pre></div>
<p>Although the workflow ran the same, the DAG actually changed slightly, now there is only one file target and only the output of multiqc goes to <code>rule all</code></p>
<p>My DAG:</p>
<p>{% capture e3dot27 %}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/dag_5.png"><img alt="DAG_5" src="../images/dag_5.png"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot27" content=e3dot27%}
<br/></p>
<p align="center"><b>Beware: Snakemake will also NOT run rules that it doesn't need to run in order to get the target files defined in rule: all</b><br/></p>
<p>For example if only our fastqc outputs are defined as the target in <code>rule: all</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-59-1" id="__codelineno-59-1" name="__codelineno-59-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-59-2" id="__codelineno-59-2" name="__codelineno-59-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-59-3" id="__codelineno-59-3" name="__codelineno-59-3"></a>
<a href="#__codelineno-59-4" id="__codelineno-59-4" name="__codelineno-59-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-59-5" id="__codelineno-59-5" name="__codelineno-59-5"></a>rule all:
<a href="#__codelineno-59-6" id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="w"> </span>   input:
<a href="#__codelineno-59-7" id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="gi">+       expand("../results/fastqc/{sample}_1_fastqc.html", sample = SAMPLES),</span>
<a href="#__codelineno-59-8" id="__codelineno-59-8" name="__codelineno-59-8"></a><span class="gi">+       expand("../results/fastqc/{sample}_2_fastqc.html", sample = SAMPLES),</span>
<a href="#__codelineno-59-9" id="__codelineno-59-9" name="__codelineno-59-9"></a><span class="gi">+       expand("../results/fastqc/{sample}_1_fastqc.zip", sample = SAMPLES),</span>
<a href="#__codelineno-59-10" id="__codelineno-59-10" name="__codelineno-59-10"></a><span class="gi">+       expand("../results/fastqc/{sample}_2_fastqc.zip", sample = SAMPLES)</span>
<a href="#__codelineno-59-11" id="__codelineno-59-11" name="__codelineno-59-11"></a><span class="gd">-       "../results/multiqc_report.html"</span>
<a href="#__codelineno-59-12" id="__codelineno-59-12" name="__codelineno-59-12"></a>
<a href="#__codelineno-59-13" id="__codelineno-59-13" name="__codelineno-59-13"></a># workflow
<a href="#__codelineno-59-14" id="__codelineno-59-14" name="__codelineno-59-14"></a>rule fastqc:
<a href="#__codelineno-59-15" id="__codelineno-59-15" name="__codelineno-59-15"></a><span class="w"> </span>   input:
<a href="#__codelineno-59-16" id="__codelineno-59-16" name="__codelineno-59-16"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-59-17" id="__codelineno-59-17" name="__codelineno-59-17"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-59-18" id="__codelineno-59-18" name="__codelineno-59-18"></a><span class="w"> </span>   output:
<a href="#__codelineno-59-19" id="__codelineno-59-19" name="__codelineno-59-19"></a><span class="w"> </span>       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-59-20" id="__codelineno-59-20" name="__codelineno-59-20"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-59-21" id="__codelineno-59-21" name="__codelineno-59-21"></a><span class="w"> </span>   log:
<a href="#__codelineno-59-22" id="__codelineno-59-22" name="__codelineno-59-22"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-59-23" id="__codelineno-59-23" name="__codelineno-59-23"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-59-24" id="__codelineno-59-24" name="__codelineno-59-24"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-59-25" id="__codelineno-59-25" name="__codelineno-59-25"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-59-26" id="__codelineno-59-26" name="__codelineno-59-26"></a><span class="w"> </span>   shell:
<a href="#__codelineno-59-27" id="__codelineno-59-27" name="__codelineno-59-27"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-59-28" id="__codelineno-59-28" name="__codelineno-59-28"></a>
<a href="#__codelineno-59-29" id="__codelineno-59-29" name="__codelineno-59-29"></a>rule multiqc:
<a href="#__codelineno-59-30" id="__codelineno-59-30" name="__codelineno-59-30"></a><span class="w"> </span>   input:
<a href="#__codelineno-59-31" id="__codelineno-59-31" name="__codelineno-59-31"></a><span class="w"> </span>       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-59-32" id="__codelineno-59-32" name="__codelineno-59-32"></a><span class="w"> </span>   output:
<a href="#__codelineno-59-33" id="__codelineno-59-33" name="__codelineno-59-33"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-59-34" id="__codelineno-59-34" name="__codelineno-59-34"></a><span class="w"> </span>   log:
<a href="#__codelineno-59-35" id="__codelineno-59-35" name="__codelineno-59-35"></a><span class="w"> </span>       "logs/multiqc/multiqc.log"
<a href="#__codelineno-59-36" id="__codelineno-59-36" name="__codelineno-59-36"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-59-37" id="__codelineno-59-37" name="__codelineno-59-37"></a><span class="w"> </span>       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-59-38" id="__codelineno-59-38" name="__codelineno-59-38"></a><span class="w"> </span>   shell:
<a href="#__codelineno-59-39" id="__codelineno-59-39" name="__codelineno-59-39"></a><span class="w"> </span>       "multiqc {input} -o ../results/ &amp;&gt; {log}"
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e3dot28 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-60-1" id="__codelineno-60-1" name="__codelineno-60-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-60-2" id="__codelineno-60-2" name="__codelineno-60-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-60-3" id="__codelineno-60-3" name="__codelineno-60-3"></a>
<a href="#__codelineno-60-4" id="__codelineno-60-4" name="__codelineno-60-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-60-5" id="__codelineno-60-5" name="__codelineno-60-5"></a>rule all:
<a href="#__codelineno-60-6" id="__codelineno-60-6" name="__codelineno-60-6"></a>    input:
<a href="#__codelineno-60-7" id="__codelineno-60-7" name="__codelineno-60-7"></a>        expand("../results/fastqc/{sample}_1_fastqc.html", sample = SAMPLES),
<a href="#__codelineno-60-8" id="__codelineno-60-8" name="__codelineno-60-8"></a>        expand("../results/fastqc/{sample}_2_fastqc.html", sample = SAMPLES),
<a href="#__codelineno-60-9" id="__codelineno-60-9" name="__codelineno-60-9"></a>        expand("../results/fastqc/{sample}_1_fastqc.zip", sample = SAMPLES),
<a href="#__codelineno-60-10" id="__codelineno-60-10" name="__codelineno-60-10"></a>        expand("../results/fastqc/{sample}_2_fastqc.zip", sample = SAMPLES)
<a href="#__codelineno-60-11" id="__codelineno-60-11" name="__codelineno-60-11"></a>
<a href="#__codelineno-60-12" id="__codelineno-60-12" name="__codelineno-60-12"></a># workflow
<a href="#__codelineno-60-13" id="__codelineno-60-13" name="__codelineno-60-13"></a>rule fastqc:
<a href="#__codelineno-60-14" id="__codelineno-60-14" name="__codelineno-60-14"></a>    input:
<a href="#__codelineno-60-15" id="__codelineno-60-15" name="__codelineno-60-15"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-60-16" id="__codelineno-60-16" name="__codelineno-60-16"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-60-17" id="__codelineno-60-17" name="__codelineno-60-17"></a>    output:
<a href="#__codelineno-60-18" id="__codelineno-60-18" name="__codelineno-60-18"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-60-19" id="__codelineno-60-19" name="__codelineno-60-19"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-60-20" id="__codelineno-60-20" name="__codelineno-60-20"></a>    log:
<a href="#__codelineno-60-21" id="__codelineno-60-21" name="__codelineno-60-21"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-60-22" id="__codelineno-60-22" name="__codelineno-60-22"></a>    threads: 2
<a href="#__codelineno-60-23" id="__codelineno-60-23" name="__codelineno-60-23"></a>    envmodules:
<a href="#__codelineno-60-24" id="__codelineno-60-24" name="__codelineno-60-24"></a>        "FastQC/0.11.9"
<a href="#__codelineno-60-25" id="__codelineno-60-25" name="__codelineno-60-25"></a>    shell:
<a href="#__codelineno-60-26" id="__codelineno-60-26" name="__codelineno-60-26"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-60-27" id="__codelineno-60-27" name="__codelineno-60-27"></a>
<a href="#__codelineno-60-28" id="__codelineno-60-28" name="__codelineno-60-28"></a>rule multiqc:
<a href="#__codelineno-60-29" id="__codelineno-60-29" name="__codelineno-60-29"></a>    input:
<a href="#__codelineno-60-30" id="__codelineno-60-30" name="__codelineno-60-30"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-60-31" id="__codelineno-60-31" name="__codelineno-60-31"></a>    output:
<a href="#__codelineno-60-32" id="__codelineno-60-32" name="__codelineno-60-32"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-60-33" id="__codelineno-60-33" name="__codelineno-60-33"></a>    log:
<a href="#__codelineno-60-34" id="__codelineno-60-34" name="__codelineno-60-34"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-60-35" id="__codelineno-60-35" name="__codelineno-60-35"></a>    envmodules:
<a href="#__codelineno-60-36" id="__codelineno-60-36" name="__codelineno-60-36"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-60-37" id="__codelineno-60-37" name="__codelineno-60-37"></a>    shell:
<a href="#__codelineno-60-38" id="__codelineno-60-38" name="__codelineno-60-38"></a>        "multiqc {input} -o ../results/ &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot28" content=e3dot28%}
<br/></p>
<p>Run again</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-61-1" id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="c1"># run dryrun again</span>
<a href="#__codelineno-61-2" id="__codelineno-61-2" name="__codelineno-61-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>My partial output:</p>
<p>{% capture e3dot29 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-62-1" id="__codelineno-62-1" name="__codelineno-62-1"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-62-2" id="__codelineno-62-2" name="__codelineno-62-2"></a>job<span class="w">       </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-62-3" id="__codelineno-62-3" name="__codelineno-62-3"></a>------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-62-4" id="__codelineno-62-4" name="__codelineno-62-4"></a>all<span class="w">           </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-62-5" id="__codelineno-62-5" name="__codelineno-62-5"></a>fastqc<span class="w">        </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-62-6" id="__codelineno-62-6" name="__codelineno-62-6"></a>total<span class="w">         </span><span class="m">4</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot29" content=e3dot29%}
<br/></p>
<p>Our multiqc rule won't be run/evaluated</p>
<p>Visualise workflow</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-63-1" id="__codelineno-63-1" name="__codelineno-63-1"></a>snakemake<span class="w"> </span>--dag<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>dag_6.png
</code></pre></div>
<p>Now we are back to only running fastqc in our workflow, despite having our second rule (multiqc) in our workflow</p>
<p>My DAG:</p>
<p>{% capture e3dot30 %}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/dag_6.png"><img alt="DAG_6" src="../images/dag_6.png"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot30" content=e3dot30%}
<br/></p>
<p align="center"><b>Snakemake is lazy.</b><br/></p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="https://64.media.tumblr.com/0492923adeb79cb841e29968135305d5/tumblr_nzdagaL6EH1uavdlbo7_1280.png"><img alt="Snakemake is lazy." src="https://64.media.tumblr.com/0492923adeb79cb841e29968135305d5/tumblr_nzdagaL6EH1uavdlbo7_1280.png"/></a></p>
<h2 id="314-add-even-more-rules">3.14 Add even more rules<a class="headerlink" href="#314-add-even-more-rules" title="Permanent link">¶</a></h2>
<p>Let's add the rest of the rules. We want to get to:</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/rulegraph_1.png"><img alt="rulegraph_1" src="../images/rulegraph_1.png"/></a></p>
<p>We currently have fastqc and multiqc, so we still need to add trim_galore</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-64-1" id="__codelineno-64-1" name="__codelineno-64-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-64-2" id="__codelineno-64-2" name="__codelineno-64-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-64-3" id="__codelineno-64-3" name="__codelineno-64-3"></a>
<a href="#__codelineno-64-4" id="__codelineno-64-4" name="__codelineno-64-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-64-5" id="__codelineno-64-5" name="__codelineno-64-5"></a>rule all:
<a href="#__codelineno-64-6" id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="w"> </span>   input:
<a href="#__codelineno-64-7" id="__codelineno-64-7" name="__codelineno-64-7"></a><span class="gd">-       expand("../results/fastqc/{sample}_1_fastqc.html", sample = SAMPLES),</span>
<a href="#__codelineno-64-8" id="__codelineno-64-8" name="__codelineno-64-8"></a><span class="gd">-       expand("../results/fastqc/{sample}_2_fastqc.html", sample = SAMPLES),</span>
<a href="#__codelineno-64-9" id="__codelineno-64-9" name="__codelineno-64-9"></a><span class="gd">-       expand("../results/fastqc/{sample}_1_fastqc.zip", sample = SAMPLES),</span>
<a href="#__codelineno-64-10" id="__codelineno-64-10" name="__codelineno-64-10"></a><span class="gd">-       expand("../results/fastqc/{sample}_2_fastqc.zip", sample = SAMPLES)</span>
<a href="#__codelineno-64-11" id="__codelineno-64-11" name="__codelineno-64-11"></a><span class="gi">+       "../results/multiqc_report.html",</span>
<a href="#__codelineno-64-12" id="__codelineno-64-12" name="__codelineno-64-12"></a><span class="gi">+       expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)</span>
<a href="#__codelineno-64-13" id="__codelineno-64-13" name="__codelineno-64-13"></a>
<a href="#__codelineno-64-14" id="__codelineno-64-14" name="__codelineno-64-14"></a># workflow
<a href="#__codelineno-64-15" id="__codelineno-64-15" name="__codelineno-64-15"></a>rule fastqc:
<a href="#__codelineno-64-16" id="__codelineno-64-16" name="__codelineno-64-16"></a><span class="w"> </span>   input:
<a href="#__codelineno-64-17" id="__codelineno-64-17" name="__codelineno-64-17"></a><span class="w"> </span>       R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-64-18" id="__codelineno-64-18" name="__codelineno-64-18"></a><span class="w"> </span>       R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-64-19" id="__codelineno-64-19" name="__codelineno-64-19"></a><span class="w"> </span>   output:
<a href="#__codelineno-64-20" id="__codelineno-64-20" name="__codelineno-64-20"></a><span class="w"> </span>       html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-64-21" id="__codelineno-64-21" name="__codelineno-64-21"></a><span class="w"> </span>       zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-64-22" id="__codelineno-64-22" name="__codelineno-64-22"></a><span class="w"> </span>   log:
<a href="#__codelineno-64-23" id="__codelineno-64-23" name="__codelineno-64-23"></a><span class="w"> </span>       "logs/fastqc/{sample}.log"
<a href="#__codelineno-64-24" id="__codelineno-64-24" name="__codelineno-64-24"></a><span class="w"> </span>   threads: 2
<a href="#__codelineno-64-25" id="__codelineno-64-25" name="__codelineno-64-25"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-64-26" id="__codelineno-64-26" name="__codelineno-64-26"></a><span class="w"> </span>       "FastQC/0.11.9"
<a href="#__codelineno-64-27" id="__codelineno-64-27" name="__codelineno-64-27"></a><span class="w"> </span>   shell:
<a href="#__codelineno-64-28" id="__codelineno-64-28" name="__codelineno-64-28"></a><span class="w"> </span>       "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-64-29" id="__codelineno-64-29" name="__codelineno-64-29"></a>
<a href="#__codelineno-64-30" id="__codelineno-64-30" name="__codelineno-64-30"></a>rule multiqc:
<a href="#__codelineno-64-31" id="__codelineno-64-31" name="__codelineno-64-31"></a><span class="w"> </span>   input:
<a href="#__codelineno-64-32" id="__codelineno-64-32" name="__codelineno-64-32"></a><span class="w"> </span>       expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-64-33" id="__codelineno-64-33" name="__codelineno-64-33"></a><span class="w"> </span>   output:
<a href="#__codelineno-64-34" id="__codelineno-64-34" name="__codelineno-64-34"></a><span class="w"> </span>       "../results/multiqc_report.html"
<a href="#__codelineno-64-35" id="__codelineno-64-35" name="__codelineno-64-35"></a><span class="w"> </span>   log:
<a href="#__codelineno-64-36" id="__codelineno-64-36" name="__codelineno-64-36"></a><span class="w"> </span>       "logs/multiqc/multiqc.log"
<a href="#__codelineno-64-37" id="__codelineno-64-37" name="__codelineno-64-37"></a><span class="w"> </span>   envmodules:
<a href="#__codelineno-64-38" id="__codelineno-64-38" name="__codelineno-64-38"></a><span class="w"> </span>       "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-64-39" id="__codelineno-64-39" name="__codelineno-64-39"></a><span class="w"> </span>   shell:
<a href="#__codelineno-64-40" id="__codelineno-64-40" name="__codelineno-64-40"></a><span class="w"> </span>       "multiqc {input} -o ../results/ &amp;&gt; {log}"
<a href="#__codelineno-64-41" id="__codelineno-64-41" name="__codelineno-64-41"></a>
<a href="#__codelineno-64-42" id="__codelineno-64-42" name="__codelineno-64-42"></a><span class="gi">+ rule trim_galore:</span>
<a href="#__codelineno-64-43" id="__codelineno-64-43" name="__codelineno-64-43"></a><span class="gi">+   input:</span>
<a href="#__codelineno-64-44" id="__codelineno-64-44" name="__codelineno-64-44"></a><span class="gi">+       ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]</span>
<a href="#__codelineno-64-45" id="__codelineno-64-45" name="__codelineno-64-45"></a><span class="gi">+   output:</span>
<a href="#__codelineno-64-46" id="__codelineno-64-46" name="__codelineno-64-46"></a><span class="gi">+       ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]</span>
<a href="#__codelineno-64-47" id="__codelineno-64-47" name="__codelineno-64-47"></a><span class="gi">+   log:</span>
<a href="#__codelineno-64-48" id="__codelineno-64-48" name="__codelineno-64-48"></a><span class="gi">+       "logs/trim_galore/{sample}.log"</span>
<a href="#__codelineno-64-49" id="__codelineno-64-49" name="__codelineno-64-49"></a><span class="gi">+   envmodules:</span>
<a href="#__codelineno-64-50" id="__codelineno-64-50" name="__codelineno-64-50"></a><span class="gi">+       "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"</span>
<a href="#__codelineno-64-51" id="__codelineno-64-51" name="__codelineno-64-51"></a><span class="gi">+   threads: 2</span>
<a href="#__codelineno-64-52" id="__codelineno-64-52" name="__codelineno-64-52"></a><span class="gi">+   shell:</span>
<a href="#__codelineno-64-53" id="__codelineno-64-53" name="__codelineno-64-53"></a><span class="gi">+       "trim_galore {input} -o ../results/trimmed/ --paired --cores {threads} &amp;&gt; {log}"</span>
</code></pre></div>
<p>Current snakefile:</p>
<p>{% capture e3dot31 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-65-1" id="__codelineno-65-1" name="__codelineno-65-1"></a># define samples from data directory using wildcards
<a href="#__codelineno-65-2" id="__codelineno-65-2" name="__codelineno-65-2"></a>SAMPLES, = glob_wildcards("../../data/{sample}_1.fastq.gz")
<a href="#__codelineno-65-3" id="__codelineno-65-3" name="__codelineno-65-3"></a>
<a href="#__codelineno-65-4" id="__codelineno-65-4" name="__codelineno-65-4"></a># target OUTPUT files for the whole workflow
<a href="#__codelineno-65-5" id="__codelineno-65-5" name="__codelineno-65-5"></a>rule all:
<a href="#__codelineno-65-6" id="__codelineno-65-6" name="__codelineno-65-6"></a>    input:
<a href="#__codelineno-65-7" id="__codelineno-65-7" name="__codelineno-65-7"></a>        "../results/multiqc_report.html",
<a href="#__codelineno-65-8" id="__codelineno-65-8" name="__codelineno-65-8"></a>        expand(["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"], sample = SAMPLES)
<a href="#__codelineno-65-9" id="__codelineno-65-9" name="__codelineno-65-9"></a>
<a href="#__codelineno-65-10" id="__codelineno-65-10" name="__codelineno-65-10"></a># workflow
<a href="#__codelineno-65-11" id="__codelineno-65-11" name="__codelineno-65-11"></a>rule fastqc:
<a href="#__codelineno-65-12" id="__codelineno-65-12" name="__codelineno-65-12"></a>    input:
<a href="#__codelineno-65-13" id="__codelineno-65-13" name="__codelineno-65-13"></a>        R1 = "../../data/{sample}_1.fastq.gz",
<a href="#__codelineno-65-14" id="__codelineno-65-14" name="__codelineno-65-14"></a>        R2 = "../../data/{sample}_2.fastq.gz"
<a href="#__codelineno-65-15" id="__codelineno-65-15" name="__codelineno-65-15"></a>    output:
<a href="#__codelineno-65-16" id="__codelineno-65-16" name="__codelineno-65-16"></a>        html = ["../results/fastqc/{sample}_1_fastqc.html", "../results/fastqc/{sample}_2_fastqc.html"],
<a href="#__codelineno-65-17" id="__codelineno-65-17" name="__codelineno-65-17"></a>        zip = ["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"]
<a href="#__codelineno-65-18" id="__codelineno-65-18" name="__codelineno-65-18"></a>    log:
<a href="#__codelineno-65-19" id="__codelineno-65-19" name="__codelineno-65-19"></a>        "logs/fastqc/{sample}.log"
<a href="#__codelineno-65-20" id="__codelineno-65-20" name="__codelineno-65-20"></a>    threads: 2
<a href="#__codelineno-65-21" id="__codelineno-65-21" name="__codelineno-65-21"></a>    envmodules:
<a href="#__codelineno-65-22" id="__codelineno-65-22" name="__codelineno-65-22"></a>        "FastQC/0.11.9"
<a href="#__codelineno-65-23" id="__codelineno-65-23" name="__codelineno-65-23"></a>    shell:
<a href="#__codelineno-65-24" id="__codelineno-65-24" name="__codelineno-65-24"></a>        "fastqc {input.R1} {input.R2} -o ../results/fastqc/ -t {threads} &amp;&gt; {log}"
<a href="#__codelineno-65-25" id="__codelineno-65-25" name="__codelineno-65-25"></a>
<a href="#__codelineno-65-26" id="__codelineno-65-26" name="__codelineno-65-26"></a>rule multiqc:
<a href="#__codelineno-65-27" id="__codelineno-65-27" name="__codelineno-65-27"></a>    input:
<a href="#__codelineno-65-28" id="__codelineno-65-28" name="__codelineno-65-28"></a>        expand(["../results/fastqc/{sample}_1_fastqc.zip", "../results/fastqc/{sample}_2_fastqc.zip"], sample = SAMPLES)
<a href="#__codelineno-65-29" id="__codelineno-65-29" name="__codelineno-65-29"></a>    output:
<a href="#__codelineno-65-30" id="__codelineno-65-30" name="__codelineno-65-30"></a>        "../results/multiqc_report.html"
<a href="#__codelineno-65-31" id="__codelineno-65-31" name="__codelineno-65-31"></a>    log:
<a href="#__codelineno-65-32" id="__codelineno-65-32" name="__codelineno-65-32"></a>        "logs/multiqc/multiqc.log"
<a href="#__codelineno-65-33" id="__codelineno-65-33" name="__codelineno-65-33"></a>    envmodules:
<a href="#__codelineno-65-34" id="__codelineno-65-34" name="__codelineno-65-34"></a>        "MultiQC/1.9-gimkl-2020a-Python-3.8.2"
<a href="#__codelineno-65-35" id="__codelineno-65-35" name="__codelineno-65-35"></a>    shell:
<a href="#__codelineno-65-36" id="__codelineno-65-36" name="__codelineno-65-36"></a>        "multiqc {input} -o ../results/ &amp;&gt; {log}"
<a href="#__codelineno-65-37" id="__codelineno-65-37" name="__codelineno-65-37"></a>
<a href="#__codelineno-65-38" id="__codelineno-65-38" name="__codelineno-65-38"></a>rule trim_galore:
<a href="#__codelineno-65-39" id="__codelineno-65-39" name="__codelineno-65-39"></a>    input:
<a href="#__codelineno-65-40" id="__codelineno-65-40" name="__codelineno-65-40"></a>        ["../../data/{sample}_1.fastq.gz", "../../data/{sample}_2.fastq.gz"]
<a href="#__codelineno-65-41" id="__codelineno-65-41" name="__codelineno-65-41"></a>    output:
<a href="#__codelineno-65-42" id="__codelineno-65-42" name="__codelineno-65-42"></a>        ["../results/trimmed/{sample}_1_val_1.fq.gz", "../results/trimmed/{sample}_2_val_2.fq.gz"]
<a href="#__codelineno-65-43" id="__codelineno-65-43" name="__codelineno-65-43"></a>    log:
<a href="#__codelineno-65-44" id="__codelineno-65-44" name="__codelineno-65-44"></a>        "logs/trim_galore/{sample}.log"
<a href="#__codelineno-65-45" id="__codelineno-65-45" name="__codelineno-65-45"></a>    envmodules:
<a href="#__codelineno-65-46" id="__codelineno-65-46" name="__codelineno-65-46"></a>        "TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1"
<a href="#__codelineno-65-47" id="__codelineno-65-47" name="__codelineno-65-47"></a>    threads: 2
<a href="#__codelineno-65-48" id="__codelineno-65-48" name="__codelineno-65-48"></a>    shell:
<a href="#__codelineno-65-49" id="__codelineno-65-49" name="__codelineno-65-49"></a>        "trim_galore {input} -o ../results/trimmed/ --paired --cores {threads} &amp;&gt; {log}"
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot31" content=e3dot31%}
<br/></p>
<p>Visualise workflow</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-66-1" id="__codelineno-66-1" name="__codelineno-66-1"></a>snakemake<span class="w"> </span>--dag<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>dag_7.png
</code></pre></div>
<p>Fantastic, we are starting to build a workflow!</p>
<p>My DAG:</p>
<p>{% capture e3dot32 %}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/dag_7.png"><img alt="DAG_7" src="../images/dag_7.png"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot32" content=e3dot32%}
<br/></p>
<p>However, when analysing many samples, our DAG can become messy and complicated. Instead, we can create a rulegraph that will let us visualise our workflow without showing every single sample that will run through it</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-67-1" id="__codelineno-67-1" name="__codelineno-67-1"></a>snakemake<span class="w"> </span>--rulegraph<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>rulegraph_1.png
</code></pre></div>
<p>My rulegraph:</p>
<p>{% capture e3dot33 %}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/rulegraph_1.png"><img alt="rulegraph_1" src="../images/rulegraph_1.png"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot33" content=e3dot33%}
<br/></p>
<p>An aside: another option that will show all your input and output files at each step:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-68-1" id="__codelineno-68-1" name="__codelineno-68-1"></a>snakemake<span class="w"> </span>--filegraph<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>filegraph.png
</code></pre></div>
<p>My filegraph:</p>
<p>{% capture e3dot34%}</p>
<p><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="../images/filegraph.png"><img alt="filegraph" src="../images/filegraph.png"/></a></p>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot34" content=e3dot34%}
<br/></p>
<p>Run the rest of the workflow</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-69-1" id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="c1"># run dryrun/run again</span>
<a href="#__codelineno-69-2" id="__codelineno-69-2" name="__codelineno-69-2"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
<a href="#__codelineno-69-3" id="__codelineno-69-3" name="__codelineno-69-3"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>Notice it will run only one rule/sample/file at a time...why is that?</p>
<h2 id="315-throw-it-more-cores">3.15 Throw it more cores<a class="headerlink" href="#315-throw-it-more-cores" title="Permanent link">¶</a></h2>
<p>Run again allowing Snakemake to use more cores overall <code>--cores 4</code> rather than <code>--cores 2</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-70-1" id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-70-2" id="__codelineno-70-2" name="__codelineno-70-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-70-3" id="__codelineno-70-3" name="__codelineno-70-3"></a>
<a href="#__codelineno-70-4" id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="c1"># run dryrun/run again</span>
<a href="#__codelineno-70-5" id="__codelineno-70-5" name="__codelineno-70-5"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--cores<span class="w"> </span><span class="m">4</span><span class="w"> </span>--use-envmodules
<a href="#__codelineno-70-6" id="__codelineno-70-6" name="__codelineno-70-6"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">4</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>Notice the whole workflow ran much faster and several samples/files/rules were running at one time. This is because we set each rule to run with 2 threads. Initially we specified that the <em>maximum</em> number of cores to be used by the workflow was 2 with the <code>--cores 2</code> flag, meaning only one rule and sample can be run at one time. When we increased the <em>maximum</em> number of cores to be used by the workflow to 4 with <code>--cores 4</code>, up to 2 samples could be run through at one time.</p>
<h2 id="316-throw-it-even-more-cores">3.16 Throw it even more cores<a class="headerlink" href="#316-throw-it-even-more-cores" title="Permanent link">¶</a></h2>
<p>With a high performance cluster such as <a href="https://www.nesi.org.nz/">NeSi</a>, you can start to REALLY scale up, particularly when you have many samples to analyse or files to process. This is because the number of cores available in a HPC is HUGE compared to a laptop or even an high end server.</p>
<p align="center"><b>Boom! Scalability here we come!</b><br/></p>
<p align="center"><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="100%" href="nesi_images/mahuika_maui_real.png"><img alt="drawing" src="nesi_images/mahuika_maui_real.png" width="800"/></a></p>
<p>To run the workflow on the cluster, we need to ensure that each step is run as a dedicated job in the queuing system of the HPC. On NeSI, the queuing system is managed by <a href="https://slurm.schedmd.com/documentation.html">Slurm</a>.</p>
<p>Use the <code>--cluster</code> option to specify the job submission command, using <code>sbatch</code> on NeSI.
This command defines resources used for each job (maximum time, memory, number of cores...).
In addition, you need to specify a maximum number of concurrent jobs using <code>--jobs</code>.</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-71-1" id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="c1"># remove output of last run</span>
<a href="#__codelineno-71-2" id="__codelineno-71-2" name="__codelineno-71-2"></a>rm<span class="w"> </span>-r<span class="w"> </span>../results/*
<a href="#__codelineno-71-3" id="__codelineno-71-3" name="__codelineno-71-3"></a>
<a href="#__codelineno-71-4" id="__codelineno-71-4" name="__codelineno-71-4"></a><span class="c1"># run again on the cluster</span>
<a href="#__codelineno-71-5" id="__codelineno-71-5" name="__codelineno-71-5"></a>snakemake<span class="w"> </span>--cluster<span class="w"> </span><span class="s2">"sbatch --time 00:10:00 --mem 512MB --cpus-per-task 8 --account nesi99991"</span><span class="w"> </span>--jobs<span class="w"> </span><span class="m">10</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot35 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-72-1" id="__codelineno-72-1" name="__codelineno-72-1"></a>Building<span class="w"> </span>DAG<span class="w"> </span>of<span class="w"> </span>jobs...
<a href="#__codelineno-72-2" id="__codelineno-72-2" name="__codelineno-72-2"></a>Using<span class="w"> </span>shell:<span class="w"> </span>/usr/bin/bash
<a href="#__codelineno-72-3" id="__codelineno-72-3" name="__codelineno-72-3"></a>Provided<span class="w"> </span>cores:<span class="w"> </span><span class="m">4</span>
<a href="#__codelineno-72-4" id="__codelineno-72-4" name="__codelineno-72-4"></a>Rules<span class="w"> </span>claiming<span class="w"> </span>more<span class="w"> </span>threads<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>scaled<span class="w"> </span>down.
<a href="#__codelineno-72-5" id="__codelineno-72-5" name="__codelineno-72-5"></a>Job<span class="w"> </span>stats:
<a href="#__codelineno-72-6" id="__codelineno-72-6" name="__codelineno-72-6"></a>job<span class="w">            </span>count<span class="w">    </span>min<span class="w"> </span>threads<span class="w">    </span>max<span class="w"> </span>threads
<a href="#__codelineno-72-7" id="__codelineno-72-7" name="__codelineno-72-7"></a>-----------<span class="w">  </span>-------<span class="w">  </span>-------------<span class="w">  </span>-------------
<a href="#__codelineno-72-8" id="__codelineno-72-8" name="__codelineno-72-8"></a>all<span class="w">                </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-72-9" id="__codelineno-72-9" name="__codelineno-72-9"></a>fastqc<span class="w">             </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-72-10" id="__codelineno-72-10" name="__codelineno-72-10"></a>multiqc<span class="w">            </span><span class="m">1</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">1</span>
<a href="#__codelineno-72-11" id="__codelineno-72-11" name="__codelineno-72-11"></a>trim_galore<span class="w">        </span><span class="m">3</span><span class="w">              </span><span class="m">2</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-72-12" id="__codelineno-72-12" name="__codelineno-72-12"></a>total<span class="w">              </span><span class="m">8</span><span class="w">              </span><span class="m">1</span><span class="w">              </span><span class="m">2</span>
<a href="#__codelineno-72-13" id="__codelineno-72-13" name="__codelineno-72-13"></a>
<a href="#__codelineno-72-14" id="__codelineno-72-14" name="__codelineno-72-14"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-72-15" id="__codelineno-72-15" name="__codelineno-72-15"></a>
<a href="#__codelineno-72-16" id="__codelineno-72-16" name="__codelineno-72-16"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:39<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-17" id="__codelineno-72-17" name="__codelineno-72-17"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-72-18" id="__codelineno-72-18" name="__codelineno-72-18"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24694_1.fastq.gz,<span class="w"> </span>../../data/NA24694_2.fastq.gz
<a href="#__codelineno-72-19" id="__codelineno-72-19" name="__codelineno-72-19"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24694_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24694_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24694_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24694_2_fastqc.zip
<a href="#__codelineno-72-20" id="__codelineno-72-20" name="__codelineno-72-20"></a><span class="w">    </span>log:<span class="w"> </span>logs/fastqc/NA24694.log
<a href="#__codelineno-72-21" id="__codelineno-72-21" name="__codelineno-72-21"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">4</span>
<a href="#__codelineno-72-22" id="__codelineno-72-22" name="__codelineno-72-22"></a><span class="w">    </span>wildcards:<span class="w"> </span><span class="nv">sample</span><span class="o">=</span>NA24694
<a href="#__codelineno-72-23" id="__codelineno-72-23" name="__codelineno-72-23"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-72-24" id="__codelineno-72-24" name="__codelineno-72-24"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-72-25" id="__codelineno-72-25" name="__codelineno-72-25"></a>
<a href="#__codelineno-72-26" id="__codelineno-72-26" name="__codelineno-72-26"></a>Activating<span class="w"> </span>environment<span class="w"> </span>modules:<span class="w"> </span>FastQC/0.11.9
<a href="#__codelineno-72-27" id="__codelineno-72-27" name="__codelineno-72-27"></a>
<a href="#__codelineno-72-28" id="__codelineno-72-28" name="__codelineno-72-28"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:39<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-29" id="__codelineno-72-29" name="__codelineno-72-29"></a>rule<span class="w"> </span>trim_galore:
<a href="#__codelineno-72-30" id="__codelineno-72-30" name="__codelineno-72-30"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24694_1.fastq.gz,<span class="w"> </span>../../data/NA24694_2.fastq.gz
<a href="#__codelineno-72-31" id="__codelineno-72-31" name="__codelineno-72-31"></a><span class="w">    </span>output:<span class="w"> </span>../results/trimmed/NA24694_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24694_2_val_2.fq.gz
<a href="#__codelineno-72-32" id="__codelineno-72-32" name="__codelineno-72-32"></a><span class="w">    </span>log:<span class="w"> </span>logs/trim_galore/NA24694.log
<a href="#__codelineno-72-33" id="__codelineno-72-33" name="__codelineno-72-33"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">7</span>
<a href="#__codelineno-72-34" id="__codelineno-72-34" name="__codelineno-72-34"></a><span class="w">    </span>wildcards:<span class="w"> </span><span class="nv">sample</span><span class="o">=</span>NA24694
<a href="#__codelineno-72-35" id="__codelineno-72-35" name="__codelineno-72-35"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-72-36" id="__codelineno-72-36" name="__codelineno-72-36"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-72-37" id="__codelineno-72-37" name="__codelineno-72-37"></a>
<a href="#__codelineno-72-38" id="__codelineno-72-38" name="__codelineno-72-38"></a>Activating<span class="w"> </span>environment<span class="w"> </span>modules:<span class="w"> </span>TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1
<a href="#__codelineno-72-39" id="__codelineno-72-39" name="__codelineno-72-39"></a>
<a href="#__codelineno-72-40" id="__codelineno-72-40" name="__codelineno-72-40"></a>The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<a href="#__codelineno-72-41" id="__codelineno-72-41" name="__codelineno-72-41"></a><span class="w">   </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">"module --force purge"</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:
<a href="#__codelineno-72-42" id="__codelineno-72-42" name="__codelineno-72-42"></a>
<a href="#__codelineno-72-43" id="__codelineno-72-43" name="__codelineno-72-43"></a><span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>XALT/minimal<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>slurm<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>NeSI
<a href="#__codelineno-72-44" id="__codelineno-72-44" name="__codelineno-72-44"></a>
<a href="#__codelineno-72-45" id="__codelineno-72-45" name="__codelineno-72-45"></a>The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<a href="#__codelineno-72-46" id="__codelineno-72-46" name="__codelineno-72-46"></a><span class="w">   </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">"module --force purge"</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:
<a href="#__codelineno-72-47" id="__codelineno-72-47" name="__codelineno-72-47"></a>
<a href="#__codelineno-72-48" id="__codelineno-72-48" name="__codelineno-72-48"></a><span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>XALT/minimal<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>slurm<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>NeSI
<a href="#__codelineno-72-49" id="__codelineno-72-49" name="__codelineno-72-49"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:44<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-50" id="__codelineno-72-50" name="__codelineno-72-50"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">4</span>.
<a href="#__codelineno-72-51" id="__codelineno-72-51" name="__codelineno-72-51"></a><span class="m">1</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">12</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-72-52" id="__codelineno-72-52" name="__codelineno-72-52"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-72-53" id="__codelineno-72-53" name="__codelineno-72-53"></a>
<a href="#__codelineno-72-54" id="__codelineno-72-54" name="__codelineno-72-54"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:44<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-55" id="__codelineno-72-55" name="__codelineno-72-55"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-72-56" id="__codelineno-72-56" name="__codelineno-72-56"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24631_1.fastq.gz,<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a href="#__codelineno-72-57" id="__codelineno-72-57" name="__codelineno-72-57"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip
<a href="#__codelineno-72-58" id="__codelineno-72-58" name="__codelineno-72-58"></a><span class="w">    </span>log:<span class="w"> </span>logs/fastqc/NA24631.log
<a href="#__codelineno-72-59" id="__codelineno-72-59" name="__codelineno-72-59"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-72-60" id="__codelineno-72-60" name="__codelineno-72-60"></a><span class="w">    </span>wildcards:<span class="w"> </span><span class="nv">sample</span><span class="o">=</span>NA24631
<a href="#__codelineno-72-61" id="__codelineno-72-61" name="__codelineno-72-61"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-72-62" id="__codelineno-72-62" name="__codelineno-72-62"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-72-63" id="__codelineno-72-63" name="__codelineno-72-63"></a>
<a href="#__codelineno-72-64" id="__codelineno-72-64" name="__codelineno-72-64"></a>Activating<span class="w"> </span>environment<span class="w"> </span>modules:<span class="w"> </span>FastQC/0.11.9
<a href="#__codelineno-72-65" id="__codelineno-72-65" name="__codelineno-72-65"></a>
<a href="#__codelineno-72-66" id="__codelineno-72-66" name="__codelineno-72-66"></a>The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<a href="#__codelineno-72-67" id="__codelineno-72-67" name="__codelineno-72-67"></a><span class="w">   </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">"module --force purge"</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:
<a href="#__codelineno-72-68" id="__codelineno-72-68" name="__codelineno-72-68"></a>
<a href="#__codelineno-72-69" id="__codelineno-72-69" name="__codelineno-72-69"></a><span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>XALT/minimal<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>slurm<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>NeSI
<a href="#__codelineno-72-70" id="__codelineno-72-70" name="__codelineno-72-70"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:47<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-71" id="__codelineno-72-71" name="__codelineno-72-71"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">7</span>.
<a href="#__codelineno-72-72" id="__codelineno-72-72" name="__codelineno-72-72"></a><span class="m">2</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">25</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-72-73" id="__codelineno-72-73" name="__codelineno-72-73"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-72-74" id="__codelineno-72-74" name="__codelineno-72-74"></a>
<a href="#__codelineno-72-75" id="__codelineno-72-75" name="__codelineno-72-75"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:47<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-76" id="__codelineno-72-76" name="__codelineno-72-76"></a>rule<span class="w"> </span>trim_galore:
<a href="#__codelineno-72-77" id="__codelineno-72-77" name="__codelineno-72-77"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24631_1.fastq.gz,<span class="w"> </span>../../data/NA24631_2.fastq.gz
<a href="#__codelineno-72-78" id="__codelineno-72-78" name="__codelineno-72-78"></a><span class="w">    </span>output:<span class="w"> </span>../results/trimmed/NA24631_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24631_2_val_2.fq.gz
<a href="#__codelineno-72-79" id="__codelineno-72-79" name="__codelineno-72-79"></a><span class="w">    </span>log:<span class="w"> </span>logs/trim_galore/NA24631.log
<a href="#__codelineno-72-80" id="__codelineno-72-80" name="__codelineno-72-80"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">5</span>
<a href="#__codelineno-72-81" id="__codelineno-72-81" name="__codelineno-72-81"></a><span class="w">    </span>wildcards:<span class="w"> </span><span class="nv">sample</span><span class="o">=</span>NA24631
<a href="#__codelineno-72-82" id="__codelineno-72-82" name="__codelineno-72-82"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-72-83" id="__codelineno-72-83" name="__codelineno-72-83"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-72-84" id="__codelineno-72-84" name="__codelineno-72-84"></a>
<a href="#__codelineno-72-85" id="__codelineno-72-85" name="__codelineno-72-85"></a>Activating<span class="w"> </span>environment<span class="w"> </span>modules:<span class="w"> </span>TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1
<a href="#__codelineno-72-86" id="__codelineno-72-86" name="__codelineno-72-86"></a>
<a href="#__codelineno-72-87" id="__codelineno-72-87" name="__codelineno-72-87"></a>The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<a href="#__codelineno-72-88" id="__codelineno-72-88" name="__codelineno-72-88"></a><span class="w">   </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">"module --force purge"</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:
<a href="#__codelineno-72-89" id="__codelineno-72-89" name="__codelineno-72-89"></a>
<a href="#__codelineno-72-90" id="__codelineno-72-90" name="__codelineno-72-90"></a><span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>XALT/minimal<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>slurm<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>NeSI
<a href="#__codelineno-72-91" id="__codelineno-72-91" name="__codelineno-72-91"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:50<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-92" id="__codelineno-72-92" name="__codelineno-72-92"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">2</span>.
<a href="#__codelineno-72-93" id="__codelineno-72-93" name="__codelineno-72-93"></a><span class="m">3</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">38</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-72-94" id="__codelineno-72-94" name="__codelineno-72-94"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-72-95" id="__codelineno-72-95" name="__codelineno-72-95"></a>
<a href="#__codelineno-72-96" id="__codelineno-72-96" name="__codelineno-72-96"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:50<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-97" id="__codelineno-72-97" name="__codelineno-72-97"></a>rule<span class="w"> </span>fastqc:
<a href="#__codelineno-72-98" id="__codelineno-72-98" name="__codelineno-72-98"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24695_1.fastq.gz,<span class="w"> </span>../../data/NA24695_2.fastq.gz
<a href="#__codelineno-72-99" id="__codelineno-72-99" name="__codelineno-72-99"></a><span class="w">    </span>output:<span class="w"> </span>../results/fastqc/NA24695_1_fastqc.html,<span class="w"> </span>../results/fastqc/NA24695_2_fastqc.html,<span class="w"> </span>../results/fastqc/NA24695_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24695_2_fastqc.zip
<a href="#__codelineno-72-100" id="__codelineno-72-100" name="__codelineno-72-100"></a><span class="w">    </span>log:<span class="w"> </span>logs/fastqc/NA24695.log
<a href="#__codelineno-72-101" id="__codelineno-72-101" name="__codelineno-72-101"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">3</span>
<a href="#__codelineno-72-102" id="__codelineno-72-102" name="__codelineno-72-102"></a><span class="w">    </span>wildcards:<span class="w"> </span><span class="nv">sample</span><span class="o">=</span>NA24695
<a href="#__codelineno-72-103" id="__codelineno-72-103" name="__codelineno-72-103"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-72-104" id="__codelineno-72-104" name="__codelineno-72-104"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-72-105" id="__codelineno-72-105" name="__codelineno-72-105"></a>
<a href="#__codelineno-72-106" id="__codelineno-72-106" name="__codelineno-72-106"></a>Activating<span class="w"> </span>environment<span class="w"> </span>modules:<span class="w"> </span>FastQC/0.11.9
<a href="#__codelineno-72-107" id="__codelineno-72-107" name="__codelineno-72-107"></a>
<a href="#__codelineno-72-108" id="__codelineno-72-108" name="__codelineno-72-108"></a>The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<a href="#__codelineno-72-109" id="__codelineno-72-109" name="__codelineno-72-109"></a><span class="w">   </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">"module --force purge"</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:
<a href="#__codelineno-72-110" id="__codelineno-72-110" name="__codelineno-72-110"></a>
<a href="#__codelineno-72-111" id="__codelineno-72-111" name="__codelineno-72-111"></a><span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>XALT/minimal<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>slurm<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>NeSI
<a href="#__codelineno-72-112" id="__codelineno-72-112" name="__codelineno-72-112"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:54<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-113" id="__codelineno-72-113" name="__codelineno-72-113"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">3</span>.
<a href="#__codelineno-72-114" id="__codelineno-72-114" name="__codelineno-72-114"></a><span class="m">4</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">50</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-72-115" id="__codelineno-72-115" name="__codelineno-72-115"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-72-116" id="__codelineno-72-116" name="__codelineno-72-116"></a>
<a href="#__codelineno-72-117" id="__codelineno-72-117" name="__codelineno-72-117"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:54<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-118" id="__codelineno-72-118" name="__codelineno-72-118"></a>rule<span class="w"> </span>trim_galore:
<a href="#__codelineno-72-119" id="__codelineno-72-119" name="__codelineno-72-119"></a><span class="w">    </span>input:<span class="w"> </span>../../data/NA24695_1.fastq.gz,<span class="w"> </span>../../data/NA24695_2.fastq.gz
<a href="#__codelineno-72-120" id="__codelineno-72-120" name="__codelineno-72-120"></a><span class="w">    </span>output:<span class="w"> </span>../results/trimmed/NA24695_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24695_2_val_2.fq.gz
<a href="#__codelineno-72-121" id="__codelineno-72-121" name="__codelineno-72-121"></a><span class="w">    </span>log:<span class="w"> </span>logs/trim_galore/NA24695.log
<a href="#__codelineno-72-122" id="__codelineno-72-122" name="__codelineno-72-122"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">6</span>
<a href="#__codelineno-72-123" id="__codelineno-72-123" name="__codelineno-72-123"></a><span class="w">    </span>wildcards:<span class="w"> </span><span class="nv">sample</span><span class="o">=</span>NA24695
<a href="#__codelineno-72-124" id="__codelineno-72-124" name="__codelineno-72-124"></a><span class="w">    </span>threads:<span class="w"> </span><span class="m">2</span>
<a href="#__codelineno-72-125" id="__codelineno-72-125" name="__codelineno-72-125"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-72-126" id="__codelineno-72-126" name="__codelineno-72-126"></a>
<a href="#__codelineno-72-127" id="__codelineno-72-127" name="__codelineno-72-127"></a>Activating<span class="w"> </span>environment<span class="w"> </span>modules:<span class="w"> </span>TrimGalore/0.6.7-gimkl-2020a-Python-3.8.2-Perl-5.30.1
<a href="#__codelineno-72-128" id="__codelineno-72-128" name="__codelineno-72-128"></a>
<a href="#__codelineno-72-129" id="__codelineno-72-129" name="__codelineno-72-129"></a>The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<a href="#__codelineno-72-130" id="__codelineno-72-130" name="__codelineno-72-130"></a><span class="w">   </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">"module --force purge"</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:
<a href="#__codelineno-72-131" id="__codelineno-72-131" name="__codelineno-72-131"></a>
<a href="#__codelineno-72-132" id="__codelineno-72-132" name="__codelineno-72-132"></a><span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>XALT/minimal<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>slurm<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>NeSI
<a href="#__codelineno-72-133" id="__codelineno-72-133" name="__codelineno-72-133"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:56<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-134" id="__codelineno-72-134" name="__codelineno-72-134"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">5</span>.
<a href="#__codelineno-72-135" id="__codelineno-72-135" name="__codelineno-72-135"></a><span class="m">5</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">62</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-72-136" id="__codelineno-72-136" name="__codelineno-72-136"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-72-137" id="__codelineno-72-137" name="__codelineno-72-137"></a>
<a href="#__codelineno-72-138" id="__codelineno-72-138" name="__codelineno-72-138"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:26:56<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-139" id="__codelineno-72-139" name="__codelineno-72-139"></a>rule<span class="w"> </span>multiqc:
<a href="#__codelineno-72-140" id="__codelineno-72-140" name="__codelineno-72-140"></a><span class="w">    </span>input:<span class="w"> </span>../results/fastqc/NA24631_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24695_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24694_1_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24631_2_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24695_2_fastqc.zip,<span class="w"> </span>../results/fastqc/NA24694_2_fastqc.zip
<a href="#__codelineno-72-141" id="__codelineno-72-141" name="__codelineno-72-141"></a><span class="w">    </span>output:<span class="w"> </span>../results/multiqc_report.html
<a href="#__codelineno-72-142" id="__codelineno-72-142" name="__codelineno-72-142"></a><span class="w">    </span>log:<span class="w"> </span>logs/multiqc/multiqc.log
<a href="#__codelineno-72-143" id="__codelineno-72-143" name="__codelineno-72-143"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">1</span>
<a href="#__codelineno-72-144" id="__codelineno-72-144" name="__codelineno-72-144"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-72-145" id="__codelineno-72-145" name="__codelineno-72-145"></a>
<a href="#__codelineno-72-146" id="__codelineno-72-146" name="__codelineno-72-146"></a>Activating<span class="w"> </span>environment<span class="w"> </span>modules:<span class="w"> </span>MultiQC/1.9-gimkl-2020a-Python-3.8.2
<a href="#__codelineno-72-147" id="__codelineno-72-147" name="__codelineno-72-147"></a>
<a href="#__codelineno-72-148" id="__codelineno-72-148" name="__codelineno-72-148"></a>The<span class="w"> </span>following<span class="w"> </span>modules<span class="w"> </span>were<span class="w"> </span>not<span class="w"> </span>unloaded:
<a href="#__codelineno-72-149" id="__codelineno-72-149" name="__codelineno-72-149"></a><span class="w">   </span><span class="o">(</span>Use<span class="w"> </span><span class="s2">"module --force purge"</span><span class="w"> </span>to<span class="w"> </span>unload<span class="w"> </span>all<span class="o">)</span>:
<a href="#__codelineno-72-150" id="__codelineno-72-150" name="__codelineno-72-150"></a>
<a href="#__codelineno-72-151" id="__codelineno-72-151" name="__codelineno-72-151"></a><span class="w">  </span><span class="m">1</span><span class="o">)</span><span class="w"> </span>XALT/minimal<span class="w">   </span><span class="m">2</span><span class="o">)</span><span class="w"> </span>slurm<span class="w">   </span><span class="m">3</span><span class="o">)</span><span class="w"> </span>NeSI
<a href="#__codelineno-72-152" id="__codelineno-72-152" name="__codelineno-72-152"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27:01<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-153" id="__codelineno-72-153" name="__codelineno-72-153"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">6</span>.
<a href="#__codelineno-72-154" id="__codelineno-72-154" name="__codelineno-72-154"></a><span class="m">6</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">75</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-72-155" id="__codelineno-72-155" name="__codelineno-72-155"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27:03<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-156" id="__codelineno-72-156" name="__codelineno-72-156"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">1</span>.
<a href="#__codelineno-72-157" id="__codelineno-72-157" name="__codelineno-72-157"></a><span class="m">7</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">88</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-72-158" id="__codelineno-72-158" name="__codelineno-72-158"></a>Select<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>to<span class="w"> </span>execute...
<a href="#__codelineno-72-159" id="__codelineno-72-159" name="__codelineno-72-159"></a>
<a href="#__codelineno-72-160" id="__codelineno-72-160" name="__codelineno-72-160"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27:03<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-161" id="__codelineno-72-161" name="__codelineno-72-161"></a>localrule<span class="w"> </span>all:
<a href="#__codelineno-72-162" id="__codelineno-72-162" name="__codelineno-72-162"></a><span class="w">    </span>input:<span class="w"> </span>../results/multiqc_report.html,<span class="w"> </span>../results/trimmed/NA24631_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24695_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24694_1_val_1.fq.gz,<span class="w"> </span>../results/trimmed/NA24631_2_val_2.fq.gz,<span class="w"> </span>../results/trimmed/NA24695_2_val_2.fq.gz,<span class="w"> </span>../results/trimmed/NA24694_2_val_2.fq.gz
<a href="#__codelineno-72-163" id="__codelineno-72-163" name="__codelineno-72-163"></a><span class="w">    </span>jobid:<span class="w"> </span><span class="m">0</span>
<a href="#__codelineno-72-164" id="__codelineno-72-164" name="__codelineno-72-164"></a><span class="w">    </span>resources:<span class="w"> </span><span class="nv">tmpdir</span><span class="o">=</span>/dev/shm/jobs/26763281
<a href="#__codelineno-72-165" id="__codelineno-72-165" name="__codelineno-72-165"></a>
<a href="#__codelineno-72-166" id="__codelineno-72-166" name="__codelineno-72-166"></a><span class="o">[</span>Wed<span class="w"> </span>May<span class="w"> </span><span class="m">11</span><span class="w"> </span><span class="m">12</span>:27:03<span class="w"> </span><span class="m">2022</span><span class="o">]</span>
<a href="#__codelineno-72-167" id="__codelineno-72-167" name="__codelineno-72-167"></a>Finished<span class="w"> </span>job<span class="w"> </span><span class="m">0</span>.
<a href="#__codelineno-72-168" id="__codelineno-72-168" name="__codelineno-72-168"></a><span class="m">8</span><span class="w"> </span>of<span class="w"> </span><span class="m">8</span><span class="w"> </span>steps<span class="w"> </span><span class="o">(</span><span class="m">100</span>%<span class="o">)</span><span class="w"> </span><span class="k">done</span>
<a href="#__codelineno-72-169" id="__codelineno-72-169" name="__codelineno-72-169"></a>Complete<span class="w"> </span>log:<span class="w"> </span>.snakemake/log/2022-05-11T122639.019945.snakemake.log
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot35" content=e3dot35%}
<br/></p>
<p>If you open another terminal on the HPC, you can use the <code>squeue</code> command to list of your jobs and their state (pending, running, etc.):</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-73-1" id="__codelineno-73-1" name="__codelineno-73-1"></a>squeue<span class="w"> </span>--me
</code></pre></div>
<p>My output:</p>
<p>{% capture e3dot36 %}</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-74-1" id="__codelineno-74-1" name="__codelineno-74-1"></a>JOBID<span class="w">         </span>USER<span class="w">     </span>ACCOUNT<span class="w">   </span>NAME<span class="w">        </span>CPUS<span class="w"> </span>MIN_MEM<span class="w"> </span>PARTITI<span class="w"> </span>START_TIME<span class="w">     </span>TIME_LEFT<span class="w"> </span>STATE<span class="w">    </span>NODELIST<span class="o">(</span>REASON<span class="o">)</span><span class="w">    </span>
<a href="#__codelineno-74-2" id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="m">26763281</span><span class="w">      </span>lkemp<span class="w">    </span>nesi99991<span class="w"> </span>spawner-jupy<span class="w">   </span><span class="m">4</span><span class="w">      </span>4G<span class="w"> </span>interac<span class="w"> </span><span class="m">2022</span>-05-11T1<span class="w">     </span><span class="m">7</span>:30:33<span class="w"> </span>RUNNING<span class="w">  </span>wbn003<span class="w">              </span>
<a href="#__codelineno-74-3" id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="m">26763418</span><span class="w">      </span>lkemp<span class="w">    </span>nesi99991<span class="w"> </span>snakejob.fas<span class="w">   </span><span class="m">8</span><span class="w">    </span>512M<span class="w"> </span>large<span class="w">   </span><span class="m">2022</span>-05-11T1<span class="w">        </span><span class="m">9</span>:59<span class="w"> </span>RUNNING<span class="w">  </span>wbn096<span class="w">              </span>
<a href="#__codelineno-74-4" id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="m">26763419</span><span class="w">      </span>lkemp<span class="w">    </span>nesi99991<span class="w"> </span>snakejob.tri<span class="w">   </span><span class="m">8</span><span class="w">    </span>512M<span class="w"> </span>large<span class="w">   </span><span class="m">2022</span>-05-11T1<span class="w">        </span><span class="m">9</span>:59<span class="w"> </span>RUNNING<span class="w">  </span>wbn096<span class="w">              </span>
<a href="#__codelineno-74-5" id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="m">26763420</span><span class="w">      </span>lkemp<span class="w">    </span>nesi99991<span class="w"> </span>snakejob.fas<span class="w">   </span><span class="m">8</span><span class="w">    </span>512M<span class="w"> </span>large<span class="w">   </span><span class="m">2022</span>-05-11T1<span class="w">        </span><span class="m">9</span>:59<span class="w"> </span>RUNNING<span class="w">  </span>wbn110<span class="w">              </span>
<a href="#__codelineno-74-6" id="__codelineno-74-6" name="__codelineno-74-6"></a><span class="m">26763421</span><span class="w">      </span>lkemp<span class="w">    </span>nesi99991<span class="w"> </span>snakejob.fas<span class="w">   </span><span class="m">8</span><span class="w">    </span>512M<span class="w"> </span>large<span class="w">   </span><span class="m">2022</span>-05-11T1<span class="w">        </span><span class="m">9</span>:59<span class="w"> </span>RUNNING<span class="w">  </span>wbn069<span class="w">              </span>
<a href="#__codelineno-74-7" id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="m">26763422</span><span class="w">      </span>lkemp<span class="w">    </span>nesi99991<span class="w"> </span>snakejob.tri<span class="w">   </span><span class="m">8</span><span class="w">    </span>512M<span class="w"> </span>large<span class="w">   </span><span class="m">2022</span>-05-11T1<span class="w">        </span><span class="m">9</span>:59<span class="w"> </span>RUNNING<span class="w">  </span>wbn070<span class="w">              </span>
<a href="#__codelineno-74-8" id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="m">26763423</span><span class="w">      </span>lkemp<span class="w">    </span>nesi99991<span class="w"> </span>snakejob.tri<span class="w">   </span><span class="m">8</span><span class="w">    </span>512M<span class="w"> </span>large<span class="w">   </span><span class="m">2022</span>-05-11T1<span class="w">        </span><span class="m">9</span>:59<span class="w"> </span>RUNNING<span class="w">  </span>wbn090<span class="w">  </span>
</code></pre></div>
<p>{% endcapture %}</p>
<p>{% include exercise.html title="e3dot36" content=e3dot36%}
<br/></p>
<p>An additional trick is to use the <code>watch</code> command to repeatedly call any command in the terminal, giving you a lightweight monitoring tool ;-).
Here we will use it to see your jobs gets queued and executed in real time:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-75-1" id="__codelineno-75-1" name="__codelineno-75-1"></a>watch<span class="w"> </span>squeue<span class="w"> </span>--me
</code></pre></div>
<p>You can exit the view create by <code>watch</code> by pressing CTRL+C.</p>
<h1 id="takeaways">Takeaways<a class="headerlink" href="#takeaways" title="Permanent link">¶</a></h1>
<hr/>
<ul>
<li>Once familiar with environment modules, the software are very straightforward to integrate in your snakemake workflow</li>
<li>Run your commands directly on the command line before wrapping it up in a Snakemake rule</li>
<li>First do a dryrun to check the Snakemake structure is set up correctly</li>
<li>Work iteratively (get each rule working before moving onto the next)</li>
<li>File paths are relative to the Snakefile</li>
<li>Run your workflow from where your Snakefile is</li>
<li>Visualise your workflow by creating a DAG (directed acyclic graph), a rulegraph or filegraph</li>
<li>Use environment modules to load software in your workflow - this improves reproducibility</li>
<li>Snakemake is lazy...</li>
<li>It will only do something if it hasn't already done it</li>
<li>It will pick up where it left off, rather than run the whole workflow again</li>
<li>It <em>won't</em> do any steps that aren't necessary to get to the target files defined in <code>rule: all</code></li>
<li><code>input:</code> <code>output:</code> <code>log:</code> and <code>threads:</code> directives need to be called in the <code>shell</code> directive</li>
<li>Capture your log files</li>
<li>Organise your log files by naming them after the rule that was run and sample that was analysed</li>
<li>You don't need to specify all the target files in <code>rule all:</code>, the final file in a given chain of tasks will suffice</li>
<li>We can massively speed up our analyses by running our samples in parallel</li>
</ul>
<hr/>
<h1 id="summary-commands">Summary commands<a class="headerlink" href="#summary-commands" title="Permanent link">¶</a></h1>
<p>Create a directed acyclic graph (DAG) with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-76-1" id="__codelineno-76-1" name="__codelineno-76-1"></a>snakemake<span class="w"> </span>--dag<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>dag.png
</code></pre></div>
<p>Create a rulegraph with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-77-1" id="__codelineno-77-1" name="__codelineno-77-1"></a>snakemake<span class="w"> </span>--rulegraph<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>rulegraph.png
</code></pre></div>
<p>Create a filegraph with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-78-1" id="__codelineno-78-1" name="__codelineno-78-1"></a>snakemake<span class="w"> </span>--filegraph<span class="w"> </span><span class="p">|</span><span class="w"> </span>dot<span class="w"> </span>-Tpng<span class="w"> </span>&gt;<span class="w"> </span>filegraph.png
</code></pre></div>
<p>Run a dryrun of your snakemake workflow with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-79-1" id="__codelineno-79-1" name="__codelineno-79-1"></a>snakemake<span class="w"> </span>--dryrun
</code></pre></div>
<p>Run your snakemake workflow with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-80-1" id="__codelineno-80-1" name="__codelineno-80-1"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span>
</code></pre></div>
<p>Run a dryrun of your snakemake workflow (using environment modules to load your software) with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-81-1" id="__codelineno-81-1" name="__codelineno-81-1"></a>snakemake<span class="w"> </span>--dryrun<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>Run your snakemake workflow (using environment modules to load your software) with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-82-1" id="__codelineno-82-1" name="__codelineno-82-1"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">2</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>Run your snakemake workflow using multiple jobs on NeSI:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-83-1" id="__codelineno-83-1" name="__codelineno-83-1"></a>snakemake<span class="w"> </span>--cluster<span class="w"> </span><span class="s2">"sbatch --time 00:10:00 --mem=512MB --cpus-per-task 8"</span><span class="w"> </span>--jobs<span class="w"> </span><span class="m">10</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<p>Create a global wildcard to get process all your samples in a directory with:</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-84-1" id="__codelineno-84-1" name="__codelineno-84-1"></a>SAMPLES,<span class="w"> </span><span class="o">=</span><span class="w"> </span>glob_wildcards<span class="o">(</span><span class="s2">"../relative/path/to/samples/{sample}_1.fastq.gz"</span><span class="o">)</span>
</code></pre></div>
<p>Combine this with the expand function to tell Snakemake to look at your global wildcard to figure out what you refer to as <code>{sample}</code> in your workflow</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-85-1" id="__codelineno-85-1" name="__codelineno-85-1"></a>expand<span class="o">(</span><span class="s2">"../results/{sample}_1.fastq.gz"</span>,<span class="w"> </span><span class="nv">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>SAMPLES<span class="o">)</span>
</code></pre></div>
<p>Increase the number of samples that can be analysed at one time in your workflow by increasing the maximum number of cores to be used at one time with the <code>--cores</code> command</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-86-1" id="__codelineno-86-1" name="__codelineno-86-1"></a>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">4</span><span class="w"> </span>--use-envmodules
</code></pre></div>
<h1 id="our-final-snakemake-workflow">Our final snakemake workflow!<a class="headerlink" href="#our-final-snakemake-workflow" title="Permanent link">¶</a></h1>
<p>See <a href="https://github.com/nesi/snakemake_workshop/tree/main/basic_demo_workflow">basic_demo_workflow</a> for the final Snakemake workflow we've created up to this point</p>
<hr/>
<p style="text-align:left;">
<b><a class="btn" href="https://nesi.github.io/snakemake_workshop/workshop_material/02_setup.html" style="background: var(--bs-green);font-weight:bold">« 2 - Setup</a></b>
<span style="float:right;">
<b><a class="btn" href="https://nesi.github.io/snakemake_workshop/workshop_material/04_leveling_up_your_workflow.html" style="background: var(--bs-green);font-weight:bold">4 - Leveling up your WF »</a></b>
</span>
</p>
<p align="center"><b><a class="btn" href="https://nesi.github.io/snakemake_workshop/" style="background: var(--bs-dark);font-weight:bold">Back to homepage</a></b></p>
</article>
</div>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
            Back to top
          </button>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: 02 - Setup" class="md-footer__link md-footer__link--prev" href="../02_setup/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<span class="md-footer__direction">
                Previous
              </span>
<div class="md-ellipsis">
                02 - Setup
              </div>
</div>
</a>
<a aria-label="Next: 04 - Leveling up your workflow!" class="md-footer__link md-footer__link--next" href="../04_leveling_up_your_workflow/" rel="next">
<div class="md-footer__title">
<span class="md-footer__direction">
                Next
              </span>
<div class="md-ellipsis">
                04 - Leveling up your workflow!
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Snakemake workshop material is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/" rel="noopener" target="_blank">Creative Commons Attribution license</a>
</div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "navigation.footer", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.b4d07000.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>